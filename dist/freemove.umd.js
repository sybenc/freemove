(function(T,b){typeof exports=="object"&&typeof module<"u"?module.exports=b():typeof define=="function"&&define.amd?define(b):(T=typeof globalThis<"u"?globalThis:T||self,T.FreeMove=b())})(this,function(){"use strict";var Lt=Object.defineProperty;var Mt=(T,b,W)=>b in T?Lt(T,b,{enumerable:!0,configurable:!0,writable:!0,value:W}):T[b]=W;var v=(T,b,W)=>Mt(T,typeof b!="symbol"?b+"":b,W);const b="__freemove";class E{constructor({x:s,y:t,h:e,w:i,node:c}){v(this,"x");v(this,"y");v(this,"w");v(this,"h");v(this,"id");v(this,"node");this.x=s,this.y=t,this.h=e,this.w=i,this.node=c,this.id=c.dataset.id}isInSide(s){return s.x>=this.x&&s.x<=this.x+this.w&&s.y>=this.y&&s.y<=this.y+this.h}isIntersect(s){const t=this.x+3,e=this.y+3,i=this.x+this.w-3,c=this.y+this.h-3,a=s.x,y=s.y,u=s.x+s.w,o=s.y+s.h;return!(i<a||t>u||c<y||e>o)}getAlignLinePostion(){return{vl:this.x,vc:this.x+this.w/2,vr:this.x+this.w,ht:this.y,hc:this.y+this.h/2,hb:this.y+this.h}}static from(s){return new E({x:parseFloat(s.style.left),y:parseFloat(s.style.top),w:parseFloat(s.style.width),h:parseFloat(s.style.height),node:s})}static error(s,t){}}function w(n){return typeof n=="number"?`${n}px`:String(n)}function K(n,s,t=.1){return Math.abs(n-s)<=t}function p(n,s){return n.getElementsByClassName(s)[0]}function m(n){return document.createElementNS("http://www.w3.org/2000/svg",n)}function H(n,s=!1){return s?Math.round(parseFloat(n.toFixed(1))):Number.isInteger(n)?n.toFixed(0):n.toFixed(1)}function tt(n,s){if(!n.selected)return;const t=n.container.getBoundingClientRect();n.align.reRender(n),n.border.reRender(n),n.gap.reRender(n),n.distance.reRender(n);const e=n.selected.getBoundingClientRect();let i=s.clientX-e.left,c=s.clientY-e.top,a=null;function y(o){a||(a=requestAnimationFrame(()=>{if(!n.selected)return;let h=o.clientX-t.left-i,l=o.clientY-t.top-c;const r=n.container.clientWidth-n.selected.offsetWidth,g=n.container.clientHeight-n.selected.offsetHeight;h=Math.max(0,Math.min(h,r)),l=Math.max(0,Math.min(l,g)),n.selected.style.left=w(h),n.selected.style.top=w(l),n.align.reRender(n),n.border.reRender(n),n.gap.reRender(n),n.distance.reRender(n),a=null}))}function u(){document.removeEventListener("pointermove",y),document.removeEventListener("pointerup",u),n.align.hidden(),n.distance.hidden(),a!==null&&(cancelAnimationFrame(a),a=null)}document.addEventListener("pointermove",y),document.addEventListener("pointerup",u)}function et(n,s){if(!n.selected)return;const t=n.container.getBoundingClientRect(),i=s.target.dataset.direction;if(!i)return;const c=E.from(n.selected);let a=s.clientX,y=s.clientY,u=c.w,o=c.h,h=c.x,l=c.y;const r=t.width,g=t.height;function f(d){let S=d.clientX-a,k=d.clientY-y,A=u,L=o,I=h,B=l;i.includes("right")&&(A=u+S),i.includes("left")&&(A=u-S,I=h+S),i.includes("bottom")&&(L=o+k),i.includes("top")&&(L=o-k,B=l+k),I<0&&(A+=I,I=0),B<0&&(L+=B,B=0),I+A>r&&(A=r-I),B+L>g&&(L=g-B),A=Math.max(A,10),L=Math.max(L,10),n.resize.reRender(n,A,L,i,h,l,u,o),n.border.reRender(n)}function x(){n.resize.hidden(),document.removeEventListener("pointermove",f),document.removeEventListener("pointerup",x)}document.addEventListener("pointermove",f),document.addEventListener("pointerup",x)}function it(n,s){const t=n.container.getBoundingClientRect(),e=s.clientX-t.left,i=s.clientY-t.top;function c(y){const u=y.clientX-t.left,o=y.clientY-t.top;n.selector.reRender(n,e,i,u,o)}function a(){n.selector.hiddenSelector(),n.selector.showPreview(),document.removeEventListener("pointermove",c),document.removeEventListener("pointerup",a)}document.addEventListener("pointermove",c),document.addEventListener("pointerup",a)}function st(n){n.svg.addEventListener("pointerdown",s=>{s.preventDefault();const t=s.target;if(t.classList[0].includes(`${b}-border-point-`)){const e=t.dataset.ownerId;for(let i=0;i<n.nodes.length;i++)e===n.nodes[i].dataset.ownerId&&n.setSelected(n.nodes[i]);n.selected&&et(n,s);return}if(t.classList.contains(`${b}-svg`)){let e=null;for(const i of n.nodes){const c=E.from(i);if(c.isInSide({x:s.offsetX,y:s.offsetY})){e=c;break}}e&&e.node.classList.contains(`${b}-movable-node`)&&(n.selector.hiddenPreview(),n.setSelected(e.node),tt(n,s)),e||(n.border.hidden(),it(n,s))}})}function rt(n){const s=new Map;function t(u){var h;const o=[];u.toSorted((l,r)=>l.x-r.x).forEach(l=>{o.push({value:l.x,type:"min",nodeRect:l}),o.push({value:l.x+l.w,type:"max",nodeRect:l})}),o.sort((l,r)=>l.value-r.value);for(let l=0;l<o.length-1;l++){const r=[],g=[];if(o[l].type==="max"&&o[l+1].type==="min"){for(let d=0;d<=l&&o[l].value===o[l-d].value;d++)r.push(o[l-d]);for(let d=l+1;d<=o.length&&o[l+1].value===o[d].value;d++)g.push(o[d]);const f=g[0].value-r[0].value,x=r[0].nodeRect.x;if(f>0){const d=Math.min(...r.map(A=>A.nodeRect.y),...g.map(A=>A.nodeRect.y)),S=Math.max(...r.map(A=>A.nodeRect.y+A.nodeRect.h),...g.map(A=>A.nodeRect.y+A.nodeRect.h)),k={x,y:d,w:f,h:S-d,rect1:r.map(A=>A.nodeRect),rect2:g.map(A=>A.nodeRect)};s.has(f)?(h=s.get(f))==null||h.push(k):s.set(f,[k])}}}}function e(){s.forEach((u,o)=>{const h=new Map;u.forEach(l=>{h.has(l.x)?h.get(l.x).push(l):h.set(l.x,[l])}),h.forEach((l,r)=>{const g=[],f=[],x=new Set,d=new Set;l==null||l.forEach(A=>{g.push(A.y),f.push(A.y+A.h),A.rect1.forEach(L=>x.add(L)),A.rect2.forEach(L=>d.add(L))});const S=Math.min(...g),k=Math.max(...f);h.set(r,[{x:r,y:S,h:k-S,w:o,rect1:Array.from(x),rect2:Array.from(d)}])}),s.set(o,Array.from(h.values()).flat())})}const i=[],c=E.from(n.selected);n.nodes.forEach(u=>{const o=E.from(u);i.push(o)}),i.sort((u,o)=>u.x-o.x);const a=[],y=[];return i.forEach(u=>{u.y<=c.y&&u.y+u.h>=c.y||u.y<=c.y+c.h/2&&u.y+u.h>=c.y+c.h/2||u.y<=c.y+c.h&&u.y+u.h>=c.y+c.h?a.push(u):y.push(u)}),t(a),y.forEach(u=>{a.push(u),t(a)}),e(),s}function nt(n){const s=new Map;function t(u){var h;const o=[];u.toSorted((l,r)=>l.y-r.y).forEach(l=>{o.push({value:l.y,type:"min",nodeRect:l}),o.push({value:l.y+l.h,type:"max",nodeRect:l})}),o.sort((l,r)=>l.value-r.value);for(let l=0;l<o.length-1;l++){const r=[],g=[];if(o[l].type==="max"&&o[l+1].type==="min"){for(let d=0;d<=l&&o[l].value===o[l-d].value;d++)r.push(o[l-d]);for(let d=l+1;d<=o.length&&o[l+1].value===o[d].value;d++)g.push(o[d]);const f=g[0].value-r[0].value,x=r[0].nodeRect.y;if(f>0){const d=Math.min(...r.map(A=>A.nodeRect.x),...g.map(A=>A.nodeRect.x)),S=Math.max(...r.map(A=>A.nodeRect.x+A.nodeRect.w),...g.map(A=>A.nodeRect.x+A.nodeRect.w)),k={x:d,y:x,w:S-d,h:f,rect1:r.map(A=>A.nodeRect),rect2:g.map(A=>A.nodeRect)};s.has(f)?(h=s.get(f))==null||h.push(k):s.set(f,[k])}}}}function e(){s.forEach((u,o)=>{const h=new Map;u.forEach(l=>{h.has(l.y)?h.get(l.y).push(l):h.set(l.y,[l])}),h.forEach((l,r)=>{const g=[],f=[],x=new Set,d=new Set;l==null||l.forEach(A=>{g.push(A.x),f.push(A.x+A.w),A.rect1.forEach(L=>x.add(L)),A.rect2.forEach(L=>d.add(L))});const S=Math.min(...g),k=Math.max(...f);h.set(r,[{x:S,y:r,h:o,w:k-S,rect1:Array.from(x),rect2:Array.from(d)}])}),s.set(o,Array.from(h.values()).flat())})}const i=[],c=E.from(n.selected);n.nodes.forEach(u=>{const o=E.from(u);i.push(o)}),i.sort((u,o)=>u.y-o.y);const a=[],y=[];return i.forEach(u=>{u.x<=c.x&&u.x+u.w>=c.x||u.x<=c.x+c.w/2&&u.x+u.w>=c.x+c.w/2||u.x<=c.x+c.w&&u.x+u.w>=c.x+c.w?a.push(u):y.push(u)}),t(a),y.forEach(u=>{a.push(u),t(a)}),e(),s}class lt{constructor(s){v(this,"g");this.g=m("g"),this.g.setAttribute("class",`${b}-gap`),s.append(this.g)}clear(){this.g.innerHTML=""}reRender(s){rt(s),nt(s)}}const ht="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let ct=(n=21)=>{let s="",t=crypto.getRandomValues(new Uint8Array(n|=0));for(;n--;)s+=ht[t[n]&63];return s};const at=1,ot="red",G=["vl","vc","vr","ht","hc","hb"];function ut(n,s){const t=n.container.getBoundingClientRect(),e={ht:[],hc:[],hb:[],vl:[],vc:[],vr:[]};let i=!1;function c(){const h=E.from(n.selected),l=n.nodes.filter(r=>r!==n.selected).map(r=>E.from(r));G.forEach(r=>e[r]=[]),l.forEach(r=>{if(h.isIntersect(r))return;const g=h.getAlignLinePostion();G.forEach(f=>{let x=1e4,d=1e4,S;/^h/.test(f)&&(h.x>r.x+r.w?(x=h.x+h.w,d=r.x):h.x+h.w<r.x?(x=h.x,d=r.x+r.w):(x=Math.min(h.x,r.x),d=Math.max(h.x+h.w,r.x+r.w)),[r.y,r.y+r.h/2,r.y+r.h].forEach(k=>{S=Math.abs(g[f]-k),S<=3&&e[f].push({type:f,source:x,target:d,absorbDistance:S,absorbPosition:k,nodeRects:[r]})})),/^v/.test(f)&&(h.y>r.y+r.h?(x=h.y+h.h,d=r.y):h.y+h.h<r.y?(x=h.y,d=r.y+r.h):(x=Math.min(h.y,r.y),d=Math.max(h.y+h.h,r.y+r.h)),[r.x,r.x+r.w/2,r.x+r.w].forEach(k=>{S=Math.abs(g[f]-k),S<=3&&e[f].push({type:f,source:x,target:d,absorbDistance:S,absorbPosition:k,nodeRects:[r]})}))})}),G.forEach(r=>{const g=new Map;e[r].forEach(d=>{const S=g.get(d.absorbDistance)||[];S.push(d),g.set(d.absorbDistance,S)});let f=1/0,x=0;g.forEach(d=>{d.forEach(S=>{f=Math.min(f,S.source,S.target),x=Math.max(x,S.source,S.target)})}),g.forEach(d=>{d.forEach(S=>{S.source=f,S.target=x})}),e[r]=Array.from(g.values()).flat()})}function a(h){const{absorbPosition:l,type:r}=h,g=n.selected;switch(r){case"ht":g.style.top=w(l);break;case"hc":g.style.top=w(l-parseFloat(g.style.height)/2);break;case"hb":g.style.top=w(l-parseFloat(g.style.height));break;case"vl":g.style.left=w(l);break;case"vc":g.style.left=w(l-parseFloat(g.style.width)/2);break;case"vr":g.style.left=w(l-parseFloat(g.style.width));break}c(),n.border.reRender(n)}function y(){if(!n.selected)return;const h=E.from(n.selected),l=t.width/2;Math.abs(h.x+h.w/2-l)<=3&&(n.selected.style.left=w(l-h.w/2),i=!0),c(),n.border.reRender(n)}function u(){if(!n.selected)return;const h=E.from(n.selected),l=Object.values(e).flat();if([...e.hb,...e.hc,...e.ht].length===0?s.isHAlign=!1:s.isHAlign=!0,[...e.vc,...e.vl,...e.vr].length===0?s.isVAlign=!1:s.isVAlign=!0,l.forEach(r=>{const{source:g,target:f,type:x}=r,d=s.lines[x];if(/^h/.test(x))switch(d==null||d.setAttribute("x1",String(g)),d==null||d.setAttribute("x2",String(f)),x){case"ht":d.setAttribute("y1",String(h.y)),d.setAttribute("y2",String(h.y));break;case"hc":d.setAttribute("y1",String(h.y+h.h/2)),d.setAttribute("y2",String(h.y+h.h/2));break;case"hb":d.setAttribute("y1",String(h.y+h.h)),d.setAttribute("y2",String(h.y+h.h));break}if(/^v/.test(x))switch(d==null||d.setAttribute("y1",String(g)),d==null||d.setAttribute("y2",String(f)),x){case"vl":d.setAttribute("x1",String(h.x)),d.setAttribute("x2",String(h.x));break;case"vc":d.setAttribute("x1",String(h.x+h.w/2)),d.setAttribute("x2",String(h.x+h.w/2));break;case"vr":d.setAttribute("x1",String(h.x+h.w)),d.setAttribute("x2",String(h.x+h.w));break}d==null||d.setAttribute("style","display: 'block")}),i){const r=s.lines.vertical;r.setAttribute("x1",String(t.width/2)),r.setAttribute("y1",String(0)),r.setAttribute("x2",String(t.width/2)),r.setAttribute("y2",String(t.height)),r==null||r.setAttribute("style","display: 'block")}}c(),Object.values(e).flat().forEach(h=>{a(h)}),y();let o=1/0;G.forEach(h=>{e[h].forEach(l=>{l.absorbDistance<o&&(o=l.absorbDistance)})}),G.forEach(h=>{e[h]=e[h].filter(l=>K(l.absorbDistance,o,.01))}),u()}class dt{constructor(s){v(this,"g");v(this,"lines");v(this,"isHAlign",!1);v(this,"isVAlign",!1);this.g=m("g"),this.g.setAttribute("class",`${b}-align`),this.lines={},[...G,"vertical"].forEach(t=>{const e=m("line");e.setAttribute("class",`${b}-align-${t}`),e.setAttribute("stroke",ot),e.setAttribute("stroke-width",String(at)),e.style.display="none",this.g.append(e),this.lines[t]=e}),s.append(this.g)}hidden(){Object.values(this.lines).forEach(s=>{s.style.display="none"})}reRender(s){s.selected&&(this.hidden(),ut(s,this))}}const R=1,Y="#000",j=6,q=["left","top","right","bottom"],Z=["left-top","top","right-top","right","right-bottom","bottom","left-bottom","left"],bt=["nwse-resize","ns-resize","nesw-resize","ew-resize","nwse-resize","ns-resize","nesw-resize","ew-resize"];function gt(){const n=[],s=[];return q.forEach(t=>{const e=m("line");e.setAttribute("class",`${b}-border-line-${t}`),e.setAttribute("stroke",Y),e.setAttribute("stroke-width",w(R)),s.push(e)}),Z.forEach((t,e)=>{const i=m("rect");i.setAttribute("class",`${b}-border-point-${t}`),i.setAttribute("fill","white"),i.setAttribute("stroke",Y),i.setAttribute("stroke-width",w(R)),i.setAttribute("width",w(j)),i.setAttribute("height",w(j)),i.setAttribute("style",`cursor: ${bt[e]}`),i.setAttribute("data-direction",t),n.push(i)}),[n,s]}function yt(n,s){const t=E.from(s);q.forEach(e=>{const i=p(n,`${b}-border-line-${e}`);switch(e){case"left":i.setAttribute("x1",String(t.x)),i.setAttribute("y1",String(t.y-R/2)),i.setAttribute("x2",String(t.x)),i.setAttribute("y2",String(t.y+t.h+R/2));break;case"right":i.setAttribute("x1",String(t.x+t.w)),i.setAttribute("y1",String(t.y-R/2)),i.setAttribute("x2",String(t.x+t.w)),i.setAttribute("y2",String(t.y+t.h+R/2));break;case"top":i.setAttribute("x1",String(t.x-R/2)),i.setAttribute("y1",String(t.y)),i.setAttribute("x2",String(t.x+t.w+R/2)),i.setAttribute("y2",String(t.y));break;case"bottom":i.setAttribute("x1",String(t.x-R/2)),i.setAttribute("y1",String(t.y+t.h)),i.setAttribute("x2",String(t.x+t.w+R/2)),i.setAttribute("y2",String(t.y+t.h));break}}),Z.forEach((e,i)=>{const c=p(n,`${b}-border-point-${e}`);c.setAttribute("data-owner-id",s.dataset.id);const a=j/2;switch(e){case"left-top":c.setAttribute("x",String(t.x-a)),c.setAttribute("y",String(t.y-a));break;case"top":c.setAttribute("x",String(t.x+t.w/2-a)),c.setAttribute("y",String(t.y-a));break;case"right-top":c.setAttribute("x",String(t.x+t.w-a)),c.setAttribute("y",String(t.y-a));break;case"right":c.setAttribute("x",String(t.x+t.w-a)),c.setAttribute("y",String(t.y+t.h/2-a));break;case"right-bottom":c.setAttribute("x",String(t.x+t.w-a)),c.setAttribute("y",String(t.y+t.h-a));break;case"bottom":c.setAttribute("x",String(t.x+t.w/2-a)),c.setAttribute("y",String(t.y+t.h-a));break;case"left-bottom":c.setAttribute("x",String(t.x-a)),c.setAttribute("y",String(t.y+t.h-a));break;case"left":c.setAttribute("x",String(t.x-a)),c.setAttribute("y",String(t.y+t.h/2-a));break}})}class At{constructor(s){v(this,"g");v(this,"points");v(this,"lines");this.g=m("g"),this.g.setAttribute("class",`${b}-border`),s.append(this.g);const[t,e]=gt();this.points=t,this.lines=e,this.g.append(...e,...t),this.g.style.display="none"}hidden(){this.g.style.display="none"}reRender(s){s.selected&&(this.g.style.display="block",yt(this.g,s.selected))}}const z=1,O="#2A63F4",F=8,C=10,U=10;function Q(n){const s=n.nodes.map(i=>E.from(i)),t=new Map,e=new Map;return s.forEach(i=>{var y,u;const c={type:"width",nodeRect:i},a={type:"height",nodeRect:i};t.has(i.w)?(y=t.get(i.w))==null||y.push(c):t.set(i.w,[c]),e.has(i.h)?(u=e.get(i.h))==null||u.push(a):e.set(i.h,[a])}),{widthMap:t,heightMap:e}}function ft(n){n.nodes.forEach(s=>{const t=E.from(s),e=n.resize.g.querySelector(`[data-ower-id="${t.id}"]`),i=p(e,`${b}-resize-line-group-width-line`),c=p(e,`${b}-resize-line-group-width-line-start`),a=p(e,`${b}-resize-line-group-width-line-end`),y=p(e,`${b}-resize-line-group-width-text`),u=p(e,`${b}-resize-line-group-height-line`),o=p(e,`${b}-resize-line-group-height-text`),h=p(e,`${b}-resize-line-group-height-line-start`),l=p(e,`${b}-resize-line-group-height-line-end`);i.setAttribute("x1",String(t.x)),i.setAttribute("y1",String(t.y-F)),i.setAttribute("x2",String(t.x+t.w)),i.setAttribute("y2",String(t.y-F)),c.setAttribute("x",String(t.x-z/2)),c.setAttribute("y",String(t.y-F-C/2)),c.setAttribute("width",String(z)),c.setAttribute("height",String(C)),c.setAttribute("fill",String(O)),a.setAttribute("x",String(t.x+t.w-z/2)),a.setAttribute("y",String(t.y-F-C/2)),a.setAttribute("width",String(z)),a.setAttribute("height",String(C)),a.setAttribute("fill",String(O)),y.textContent=`${H(t.w)}`,y.setAttribute("x",String(t.x+t.w/2)),y.setAttribute("y",String(t.y-F-8)),y.setAttribute("fill",String(O)),y.setAttribute("font-size",String(U)),y.setAttribute("text-anchor","middle"),y.setAttribute("alignment-baseline","middle"),u.setAttribute("x1",String(t.x-F)),u.setAttribute("y1",String(t.y)),u.setAttribute("x2",String(t.x-F)),u.setAttribute("y2",String(t.y+t.h)),h.setAttribute("x",String(t.x-F-C/2)),h.setAttribute("y",String(t.y-z/2)),h.setAttribute("width",String(C)),h.setAttribute("height",String(z)),h.setAttribute("fill",String(O)),l.setAttribute("x",String(t.x-F-C/2)),l.setAttribute("y",String(t.y+t.h-z/2)),l.setAttribute("width",String(C)),l.setAttribute("height",String(z)),l.setAttribute("fill",String(O)),o.textContent=`${H(t.h)}`,o.setAttribute("x",String(t.x-F-8)),o.setAttribute("y",String(t.y+t.h/2)),o.setAttribute("fill",String(O)),o.setAttribute("font-size",String(U)),o.setAttribute("text-anchor","middle"),o.setAttribute("alignment-baseline","middle"),o.setAttribute("transform",`rotate(-90 ${t.x-F-8} ${t.y+t.h/2})`),[i,u].forEach(r=>{r.setAttribute("stroke",O),r.setAttribute("stroke-width",String(z))})})}class xt{constructor(s,t){v(this,"g");v(this,"lines");this.g=m("g"),this.g.setAttribute("class",`${b}-resize`);const e=[];t.forEach(i=>{const c=E.from(i),a=m("g");a.setAttribute("class",`${b}-resize-line`),a.setAttribute("data-ower-id",c.id);const y=m("g");y.setAttribute("class",`${b}-resize-line-group-width`);const u=m("line");u.setAttribute("class",`${b}-resize-line-group-width-line`);const o=m("text");o.setAttribute("class",`${b}-resize-line-group-width-text`);const h=m("rect");h.setAttribute("class",`${b}-resize-line-group-width-line-start`);const l=m("rect");l.setAttribute("class",`${b}-resize-line-group-width-line-end`),y.append(u,o,h,l);const r=m("g");r.setAttribute("class",`${b}-resize-line-group-height`);const g=m("line");g.setAttribute("class",`${b}-resize-line-group-height-line`);const f=m("text");f.setAttribute("class",`${b}-resize-line-group-height-text`);const x=m("rect");x.setAttribute("class",`${b}-resize-line-group-height-line-start`);const d=m("rect");d.setAttribute("class",`${b}-resize-line-group-height-line-end`),r.append(g,f,x,d),a.append(y,r),e.push(a)}),this.lines=e,this.g.append(...this.lines),s.append(this.g),this.hidden()}hidden(){this.lines.forEach(s=>{Array.from(s.children).forEach(t=>{t.style.display="none"})})}reRender(s,t,e,i,c,a,y,u){var J,V;if(!s.selected)return;this.hidden();const{widthMap:o,heightMap:h}=Q(s),l=[],r=[];o.forEach((M,N)=>{var _;M.length===1&&M[0].nodeRect.id===((_=s.selected)==null?void 0:_.dataset.id)||Math.abs(t-N)<=3&&l.push(N)}),h.forEach((M,N)=>{var _;M.length===1&&M[0].nodeRect.id===((_=s.selected)==null?void 0:_.dataset.id)||Math.abs(e-N)<=3&&r.push(N)});const g=l.length===0?t:Math.max(...l),f=r.length===0?e:Math.max(...r),x=Math.max(g,10),d=Math.max(f,10);if(i.includes("left")){const M=c+y;s.selected.style.left=w(M-x)}else s.selected.style.left=w(c);if(s.selected.style.width=w(x),i.includes("top")){const M=a+u;s.selected.style.top=w(M-d)}else s.selected.style.top=w(a);s.selected.style.height=w(d);const S=parseFloat(s.selected.style.width),k=parseFloat(s.selected.style.height),{widthMap:A,heightMap:L}=Q(s);(J=A.get(S))==null||J.forEach(M=>{const N=this.g.querySelector(`[data-ower-id="${M.nodeRect.id}"]`),_=p(N,`${b}-resize-line-group-width`);_.style.display="block"}),(V=L.get(k))==null||V.forEach(M=>{const N=this.g.querySelector(`[data-ower-id="${M.nodeRect.id}"]`),_=p(N,`${b}-resize-line-group-height`);_.style.display="block"});const I=this.g.querySelector(`[data-ower-id="${s.selected.dataset.id}"]`),B=p(I,`${b}-resize-line-group-width`),kt=p(I,`${b}-resize-line-group-height`);kt.style.display="block",B.style.display="block",ft(s),s.border.reRender(s)}}function pt(n,s,t,e){return t-n>0&&e-s>0?"4":t-n<0&&e-s>0?"3":t-n<0&&e-s<0?"2":t-n>0&&e-s<0?"1":"0"}class St{constructor(s){v(this,"g");v(this,"selectorRect");v(this,"previewRect");v(this,"selectedGroup",[]);this.g=m("g"),this.g.setAttribute("class",`${b}-selector`),this.selectorRect=m("rect"),this.selectorRect.setAttribute("class",`${b}-selector-rect`),this.selectorRect.setAttribute("stroke","#919191"),this.selectorRect.setAttribute("stroke-width","1px"),this.selectorRect.setAttribute("fill","rgba(255,255,255,0.3)"),this.selectorRect.style.display="none",this.previewRect=m("rect"),this.previewRect.setAttribute("class",`${b}-selector-preview`),this.previewRect.setAttribute("stroke","#000"),this.previewRect.setAttribute("stroke-width","1px"),this.previewRect.setAttribute("fill","transparent"),this.previewRect.style.display="none",this.g.append(this.selectorRect,this.previewRect),s.append(this.g)}hiddenSelector(){this.selectorRect.style.display="none"}showSelector(){this.selectorRect.style.display="block"}hiddenPreview(){this.previewRect.style.display="none"}showPreview(){this.previewRect.style.display="block"}reRender(s,t,e,i,c){this.showSelector(),this.hiddenPreview(),this.selectedGroup=[];const a=pt(t,e,i,c),y=Math.abs(t-i),u=Math.abs(e-c);this.selectorRect.setAttribute("width",String(y)),this.selectorRect.setAttribute("height",String(u));let o=t,h=e;switch(a){case"3":{o=o-y;break}case"2":{o=o-y,h=h-u;break}case"1":{h=h-u;break}}this.selectorRect.setAttribute("x",String(o)),this.selectorRect.setAttribute("y",String(h)),s.nodes.forEach(S=>{E.from(S).isIntersect({x:o,y:h,w:y,h:u})&&this.selectedGroup.push(S)});const l=[],r=[],g=[],f=[];this.selectedGroup.forEach(S=>{const{x:k,y:A,w:L,h:I}=E.from(S);l.push(k),r.push(A),g.push(k+L),f.push(A+I)});const x=Math.min(...l),d=Math.min(...r);this.previewRect.setAttribute("x",String(l.length?x:0)),this.previewRect.setAttribute("y",String(r.length?d:0)),this.previewRect.setAttribute("width",String(g.length?Math.max(...g)-x:0)),this.previewRect.setAttribute("height",String(f.length?Math.max(...f)-d:0))}}const $="#3875F6",P=1,D=10,wt=["left","right","top","bottom"];function mt(n){const s=[],t=E.from(n.selected);n.nodes.forEach(e=>{const i=E.from(e);s.push(i)}),s.forEach(e=>{if(e.y<=t.y&&e.y+e.h>=t.y||e.y<=t.y+t.h/2&&e.y+e.h>=t.y+t.h/2||e.y<=t.y+t.h&&e.y+e.h>=t.y+t.h){if(t.x+t.w<e.x){const c=Math.abs(t.x+t.w-e.x);n.distance.x.length>c&&(n.distance.x.length=c,n.distance.x.type="right",n.distance.x.node=e.node)}if(t.x>e.x+e.w){const c=Math.abs(t.x-e.x-e.w);n.distance.x.length>c&&(n.distance.x.length=c,n.distance.x.type="left",n.distance.x.node=e.node)}}}),s.forEach(e=>{if(e.x<=t.x&&e.x+e.w>=t.x||e.x<=t.x+t.w/2&&e.x+e.w>=t.x+t.w/2||e.x<=t.x+t.w&&e.x+e.w>=t.x+t.w){if(t.y+t.h<e.y){const c=Math.abs(t.y+t.h-e.y);n.distance.y.length>c&&(n.distance.y.length=c,n.distance.y.type="bottom",n.distance.y.node=e.node)}if(t.y>e.y+e.h){const c=Math.abs(t.y-e.y-e.h);n.distance.y.length>c&&(n.distance.y.length=c,n.distance.y.type="top",n.distance.y.node=e.node)}}})}function X(n){const s=[0,4,8,12,16];for(const t of s)if(t-2<=n&&t+2>=n)return t;return n}class Et{constructor(s){v(this,"g");v(this,"lines");v(this,"x");v(this,"y");this.g=m("g"),this.g.setAttribute("class",`${b}-distance`),this.lines={};const t=e=>{const i=m("g");i.setAttribute("class",`${b}-distance-${e}`);const c=m("line");c.setAttribute("class",`${b}-distance-${e}-line`);const a=m("line");a.setAttribute("class",`${b}-distance-${e}-dash-line`);const y=m("text");y.setAttribute("class",`${b}-distance-${e}-text`);const u=m("rect");u.setAttribute("class",`${b}-distance-${e}-text-bg`);const o=m("rect");o.setAttribute("class",`${b}-distance-${e}-line-start`);const h=m("rect");return h.setAttribute("class",`${b}-distance-${e}-line-end`),i.appendChild(c),i.appendChild(a),i.appendChild(u),i.appendChild(y),i.appendChild(o),i.appendChild(h),i};this.x={type:"left",length:1/0,node:null},this.y={type:"top",length:1/0,node:null},wt.forEach(e=>{const i=t(e);this.lines[e]=i}),this.g.append(...Object.values(this.lines)),s.append(this.g)}hidden(){Object.values(this.lines).forEach(s=>{s.setAttribute("style","display: none;")}),this.x={type:"left",length:1/0,node:null},this.y={type:"top",length:1/0,node:null}}reRender(s){if(s.selected){if(this.hidden(),mt(s),this.x.node&&this.x.node.id!==s.selected.dataset.id){if(this.x.type==="left"){const t=X(this.x.length);t!==this.x.length&&(s.selected.style.left=w(parseFloat(s.selected.style.left)-this.x.length+t),this.x.length=t,s.align.reRender(s),s.border.reRender(s));const e=E.from(this.x.node),i=E.from(s.selected),c=p(this.lines.left,`${b}-distance-left-line`);c.setAttribute("x1",String(e.x+e.w)),c.setAttribute("x2",String(i.x)),c.setAttribute("y1",String(i.y+i.h/2)),c.setAttribute("y2",String(i.y+i.h/2)),c.setAttribute("stroke",$),c.setAttribute("stroke-width",String(P));const a=p(this.lines.left,`${b}-distance-left-text`);a.textContent=`${H(this.x.length,!0)}`,a.setAttribute("x",String((e.x+e.w+i.x)/2)),a.setAttribute("y",String(i.y+i.h/2-9)),a.setAttribute("fill","#FFFFFF"),a.setAttribute("font-size",String(D)),a.setAttribute("text-anchor","middle"),a.setAttribute("alignment-baseline","middle");const y=p(this.lines.left,`${b}-distance-left-text-bg`);y.setAttribute("x",String((e.x+e.w+i.x)/2-(a.getComputedTextLength()+10)/2)),y.setAttribute("y",String(i.y+i.h/2-D/2-12)),y.setAttribute("width",String(a.getComputedTextLength()+10)),y.setAttribute("height",String(D+4)),y.setAttribute("fill",$),y.setAttribute("rx","4"),y.setAttribute("ry","4");const u=1,o=8,h=p(this.lines.left,`${b}-distance-left-line-start`);h.setAttribute("x",String(e.x+e.w-u/2)),h.setAttribute("y",String(i.y+i.h/2-o/2)),h.setAttribute("width",String(u)),h.setAttribute("height",String(o)),h.setAttribute("fill",$);const l=p(this.lines.left,`${b}-distance-left-line-end`);l.setAttribute("x",String(i.x-u/2)),l.setAttribute("y",String(i.y+i.h/2-o/2)),l.setAttribute("width",String(u)),l.setAttribute("height",String(o)),l.setAttribute("fill",$);const r=p(this.lines.left,`${b}-distance-left-dash-line`);i.y<e.y?(r.setAttribute("x1",String(e.x+e.w)),r.setAttribute("x2",String(e.x+e.w)),r.setAttribute("y1",String(i.y)),r.setAttribute("y2",String(e.y)),r.setAttribute("stroke",$),r.setAttribute("stroke-width","1"),r.setAttribute("stroke-dasharray","4 4"),r.setAttribute("style","display: block;")):i.y+i.h>e.y+e.h?(r.setAttribute("x1",String(e.x+e.w)),r.setAttribute("x2",String(e.x+e.w)),r.setAttribute("y1",String(e.y+e.h)),r.setAttribute("y2",String(i.y+i.h)),r.setAttribute("stroke",$),r.setAttribute("stroke-width","1"),r.setAttribute("stroke-dasharray","4 4"),r.setAttribute("style","display: block;")):r.setAttribute("style","display: none;"),s.align.isHAlign&&this.lines.left.setAttribute("style","display: block;")}else if(this.x.type==="right"){const t=X(this.x.length);t!==this.x.length&&(s.selected.style.left=w(parseFloat(s.selected.style.left)+this.x.length-t),this.x.length=t,s.align.reRender(s),s.border.reRender(s));const e=E.from(this.x.node),i=E.from(s.selected),c=p(this.lines.right,`${b}-distance-right-line`);c.setAttribute("x1",String(i.x+i.w)),c.setAttribute("x2",String(e.x)),c.setAttribute("y1",String(i.y+i.h/2)),c.setAttribute("y2",String(i.y+i.h/2)),c.setAttribute("stroke",$),c.setAttribute("stroke-width",String(P));const a=p(this.lines.right,`${b}-distance-right-text`);a.textContent=`${H(this.x.length,!0)}`,a.setAttribute("x",String((i.x+i.w+e.x)/2)),a.setAttribute("y",String(i.y+i.h/2-9)),a.setAttribute("fill","#FFFFFF"),a.setAttribute("font-size",String(D)),a.setAttribute("text-anchor","middle"),a.setAttribute("alignment-baseline","middle");const y=p(this.lines.right,`${b}-distance-right-text-bg`);y.setAttribute("x",String((i.x+i.w+e.x)/2-(a.getComputedTextLength()+10)/2)),y.setAttribute("y",String(i.y+i.h/2-D/2-12)),y.setAttribute("width",String(a.getComputedTextLength()+10)),y.setAttribute("height",String(D+4)),y.setAttribute("fill",$),y.setAttribute("rx","4"),y.setAttribute("ry","4");const u=1,o=8,h=p(this.lines.left,`${b}-distance-left-line-start`);h.setAttribute("x",String(i.x+i.w-u/2)),h.setAttribute("y",String(i.y+i.h/2-o/2)),h.setAttribute("width",String(u)),h.setAttribute("height",String(o)),h.setAttribute("fill",$);const l=p(this.lines.left,`${b}-distance-left-line-end`);l.setAttribute("x",String(e.x-u/2)),l.setAttribute("y",String(i.y+i.h/2-o/2)),l.setAttribute("width",String(u)),l.setAttribute("height",String(o)),l.setAttribute("fill",$);const r=p(this.lines.right,`${b}-distance-right-dash-line`);i.y<e.y?(r.setAttribute("x1",String(e.x)),r.setAttribute("x2",String(e.x)),r.setAttribute("y1",String(i.y)),r.setAttribute("y2",String(e.y)),r.setAttribute("stroke",$),r.setAttribute("stroke-width","1"),r.setAttribute("stroke-dasharray","4 4"),r.setAttribute("style","display: block;")):i.y+i.h>e.y+e.h?(r.setAttribute("x1",String(e.x)),r.setAttribute("x2",String(e.x)),r.setAttribute("y1",String(e.y+e.h)),r.setAttribute("y2",String(i.y+i.h)),r.setAttribute("stroke",$),r.setAttribute("stroke-width","1"),r.setAttribute("stroke-dasharray","4 4"),r.setAttribute("style","display: block;")):r.setAttribute("style","display: none;"),s.align.isHAlign&&this.lines.right.setAttribute("style","display: block;")}}if(this.y.node&&this.y.node.id!==s.selected.dataset.id){if(this.y.type==="top"){const t=X(this.y.length);t!==this.y.length&&(s.selected.style.top=w(parseFloat(s.selected.style.top)-this.y.length+t),this.y.length=t,s.border.reRender(s));const e=E.from(this.y.node),i=E.from(s.selected),c=p(this.lines.top,`${b}-distance-top-line`);c.setAttribute("x1",String(i.x+i.w/2)),c.setAttribute("x2",String(i.x+i.w/2)),c.setAttribute("y1",String(i.y)),c.setAttribute("y2",String(e.y+e.h)),c.setAttribute("stroke",$),c.setAttribute("stroke-width",String(P));const a=p(this.lines.top,`${b}-distance-top-text`);a.textContent=`${H(this.y.length,!0)}`,a.setAttribute("x",String(i.x+i.w/2+(a.getComputedTextLength()+10)/2+3)),a.setAttribute("y",String((i.y+e.y+e.h)/2+1)),a.setAttribute("fill","#FFFFFF"),a.setAttribute("font-size",String(D)),a.setAttribute("text-anchor","middle"),a.setAttribute("alignment-baseline","middle");const y=p(this.lines.top,`${b}-distance-top-text-bg`);y.setAttribute("x",String(i.x+i.w/2+3)),y.setAttribute("y",String((i.y+e.y+e.h)/2-(D+4)/2)),y.setAttribute("width",String(a.getComputedTextLength()+10)),y.setAttribute("height",String(D+4)),y.setAttribute("fill",$),y.setAttribute("rx","4"),y.setAttribute("ry","4");const u=8,o=1,h=p(this.lines.top,`${b}-distance-top-line-start`);h.setAttribute("x",String(i.x+i.w/2-u/2)),h.setAttribute("y",String(e.y+e.h-o/2)),h.setAttribute("width",String(u)),h.setAttribute("height",String(o)),h.setAttribute("fill",$);const l=p(this.lines.top,`${b}-distance-top-line-end`);l.setAttribute("x",String(i.x+i.w/2-u/2)),l.setAttribute("y",String(i.y-o/2)),l.setAttribute("width",String(u)),l.setAttribute("height",String(o)),l.setAttribute("fill",$);const r=p(this.lines.top,`${b}-distance-top-dash-line`);i.x<e.x?(r.setAttribute("x1",String(i.x)),r.setAttribute("x2",String(e.x)),r.setAttribute("y1",String(e.y+e.h)),r.setAttribute("y2",String(e.y+e.h)),r.setAttribute("stroke",$),r.setAttribute("stroke-width","1"),r.setAttribute("stroke-dasharray","4 4"),r.setAttribute("style","display: block;")):i.x+i.w>e.x+e.w?(r.setAttribute("x1",String(e.x+e.w)),r.setAttribute("x2",String(i.x+i.w)),r.setAttribute("y1",String(e.y+e.h)),r.setAttribute("y2",String(e.y+e.h)),r.setAttribute("stroke",$),r.setAttribute("stroke",$),r.setAttribute("stroke-width","1"),r.setAttribute("stroke-dasharray","4 4"),r.setAttribute("style","display: block;")):r.setAttribute("style","display: none;"),s.align.isVAlign&&this.lines.top.setAttribute("style","display: block;")}else if(this.y.type==="bottom"){const t=X(this.y.length);t!==this.y.length&&(s.selected.style.top=w(parseFloat(s.selected.style.top)+this.y.length-t),this.y.length=t,s.border.reRender(s));const e=E.from(this.y.node),i=E.from(s.selected),c=p(this.lines.bottom,`${b}-distance-bottom-line`);c.setAttribute("x1",String(i.x+i.w/2)),c.setAttribute("x2",String(i.x+i.w/2)),c.setAttribute("y1",String(i.y+i.h)),c.setAttribute("y2",String(e.y)),c.setAttribute("stroke",$),c.setAttribute("stroke-width",String(P));const a=p(this.lines.bottom,`${b}-distance-bottom-text`);a.textContent=`${H(this.y.length,!0)}`;const y=i.x+i.w/2+(a.getComputedTextLength()+10)/2+3;a.setAttribute("x",String(y)),a.setAttribute("y",String((i.y+i.h+e.y)/2+1)),a.setAttribute("fill","#FFFFFF"),a.setAttribute("font-size",String(D)),a.setAttribute("text-anchor","middle"),a.setAttribute("alignment-baseline","middle");const u=p(this.lines.bottom,`${b}-distance-bottom-text-bg`);u.setAttribute("x",String(i.x+i.w/2+3)),u.setAttribute("y",String((i.y+i.h+e.y)/2-(D+4)/2)),u.setAttribute("width",String(a.getComputedTextLength()+10)),u.setAttribute("height",String(D+4)),u.setAttribute("fill",$),u.setAttribute("rx","4"),u.setAttribute("ry","4");const o=8,h=1,l=p(this.lines.bottom,`${b}-distance-bottom-line-start`);l.setAttribute("x",String(i.x+i.w/2-o/2)),l.setAttribute("y",String(i.y+i.h-h/2)),l.setAttribute("width",String(o)),l.setAttribute("height",String(h)),l.setAttribute("fill",$);const r=p(this.lines.bottom,`${b}-distance-bottom-line-end`);r.setAttribute("x",String(i.x+i.w/2-o/2)),r.setAttribute("y",String(e.y-h/2)),r.setAttribute("width",String(o)),r.setAttribute("height",String(h)),r.setAttribute("fill",$);const g=p(this.lines.bottom,`${b}-distance-bottom-dash-line`);i.x<e.x?(g.setAttribute("x1",String(i.x)),g.setAttribute("x2",String(e.x)),g.setAttribute("y1",String(e.y)),g.setAttribute("y2",String(e.y)),g.setAttribute("stroke",$),g.setAttribute("stroke-width","1"),g.setAttribute("stroke-dasharray","4 4"),g.setAttribute("style","display: block;")):i.x+i.w>e.x+e.w?(g.setAttribute("x1",String(e.x+e.w)),g.setAttribute("x2",String(i.x+i.w)),g.setAttribute("y1",String(e.y)),g.setAttribute("y2",String(e.y)),g.setAttribute("stroke",$),g.setAttribute("stroke-width","1"),g.setAttribute("stroke-dasharray","4 4"),g.setAttribute("style","display: block;")):g.setAttribute("style","display: none;"),s.align.isVAlign&&this.lines.bottom.setAttribute("style","display: block;")}}}}}const vt=(n,s)=>{const t=m("svg");t.setAttribute("class",`${b}-svg`);const e=n.getBoundingClientRect();return t.setAttribute("width",w(e.width)),t.setAttribute("height",w(e.height)),t.style="position: absolute; inset: 0;",n.className+=` ${b}-container`,s.forEach(i=>{i.className+=` ${b}-movable-node`,i.setAttribute("data-id",ct()),/%$/.test(i.style.top)&&(i.style.top=w(e.width*parseFloat(i.style.top)/100)),/%$/.test(i.style.left)&&(i.style.left=w(e.height*parseFloat(i.style.left)/100)),/%$/.test(i.style.width)&&(i.style.width=w(e.width*parseFloat(i.style.width)/100)),/%$/.test(i.style.height)&&(i.style.height=w(e.height*parseFloat(i.style.height)/100))}),{container:n,nodes:s,svg:t,selected:null,setSelected(i){if(this.selected=i,!i){this.border.hidden();return}this.border.reRender(this)},align:new dt(t),distance:new Et(t),border:new At(t),resize:new xt(t,s),selector:new St(t),gap:new lt(t)}};class $t{constructor(s,t){v(this,"store");this.store=vt(s,t),st(this.store)}mount(){this.store.container.append(this.store.svg)}unmount(){this.store.svg.remove()}align(s){const{selected:t,container:e}=this.store;if(!t)return;const i=e.getBoundingClientRect(),c=E.from(t);switch(s){case"start":t.style.left=w(0);break;case"center":t.style.left=w(i.width/2-c.w/2);break;case"end":t.style.left=w(i.width-c.w);break}}}return $t});
