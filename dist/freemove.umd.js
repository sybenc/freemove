(function(z,g){typeof exports=="object"&&typeof module<"u"?module.exports=g():typeof define=="function"&&define.amd?define(g):(z=typeof globalThis<"u"?globalThis:z||self,z.FreeMove=g())})(this,function(){"use strict";var Ft=Object.defineProperty;var zt=(z,g,Y)=>g in z?Ft(z,g,{enumerable:!0,configurable:!0,writable:!0,value:Y}):z[g]=Y;var p=(z,g,Y)=>zt(z,typeof g!="symbol"?g+"":g,Y);const g="__freemove";class A{constructor({x:e,y:t,h:i,w:n,node:l}){p(this,"x");p(this,"y");p(this,"w");p(this,"h");p(this,"id");p(this,"node");this.x=e,this.y=t,this.h=i,this.w=n,this.node=l,this.id=l.dataset.id}sync(){this.x=parseFloat(this.node.style.left),this.y=parseFloat(this.node.style.top),this.w=parseFloat(this.node.style.width),this.h=parseFloat(this.node.style.height)}set error(e){this.node.setAttribute("data-error",String(e))}get error(){return!!this.node.getAttribute("data-error")}isInSide(e){return e.x>=this.x&&e.x<=this.x+this.w&&e.y>=this.y&&e.y<=this.y+this.h}isIntersect(e){const t=this.x+0,i=this.y+0,n=this.x+this.w-0,l=this.y+this.h-0,a=e.x,c=e.y,o=e.x+e.w,r=e.y+e.h;return!(n<a||t>o||l<c||i>r)}static from(e){return new A({x:parseFloat(e.style.left),y:parseFloat(e.style.top),w:parseFloat(e.style.width),h:parseFloat(e.style.height),node:e})}}function y(s){return typeof s=="number"?`${s}px`:String(s)}function j(s,e,t=.1){return Math.abs(s-e)<=t}function b(s,e){return s.getElementsByClassName(e)[0]}function x(s){return document.createElementNS("http://www.w3.org/2000/svg",s)}function P(s,e=!1){return e?Math.round(parseFloat(s.toFixed(1))):Number.isInteger(s)?s.toFixed(0):s.toFixed(1)}function it(s,e){if(!s.selected)return;const t=s.container.getBoundingClientRect();s.selected.dataset.error==="false"&&(s.align.reRender(s),s.distance.reRender(s),s.gap.reRender(s)),s.border.reRender(s);const i=s.selected.getBoundingClientRect();let n=(e.clientX-i.left)/s.scale,l=(e.clientY-i.top)/s.scale,a=null;function c(r){a||(a=requestAnimationFrame(()=>{if(!s.selected)return;let d=(r.clientX-t.left)/s.scale-n,h=(r.clientY-t.top)/s.scale-l;const u=s.container.clientWidth-s.selected.offsetWidth,f=s.container.clientHeight-s.selected.offsetHeight;d=Math.max(0,Math.min(d,u)),h=Math.max(0,Math.min(h,f)),s.selected.style.left=y(d),s.selected.style.top=y(h),s.searchError(),s.selected.dataset.error==="false"&&(s.align.reRender(s),s.distance.reRender(s),s.gap.reRender(s)),s.border.reRender(s),a=null}))}function o(){document.removeEventListener("pointermove",c),document.removeEventListener("pointerup",o),s.align.hidden(),s.distance.hidden(),s.gap.clear(),a!==null&&(cancelAnimationFrame(a),a=null)}document.addEventListener("pointermove",c),document.addEventListener("pointerup",o)}function st(s,e){if(!s.selected)return;const t=s.container.getBoundingClientRect(),n=e.target.dataset.direction;if(!n)return;const l=A.from(s.selected);let a=e.clientX,c=e.clientY,o=l.w,r=l.h,d=l.x,h=l.y;const u=t.width,f=t.height;function w(k){let m=(k.clientX-a)/s.scale,C=(k.clientY-c)/s.scale,E=o,L=r,F=d,T=h;n.includes("right")&&(E=o+m),n.includes("left")&&(E=o-m,F=d+m),n.includes("bottom")&&(L=r+C),n.includes("top")&&(L=r-C,T=h+C),F<0&&(E+=F,F=0),T<0&&(L+=T,T=0),F+E>u/s.scale&&(E=u/s.scale-F),T+L>f/s.scale&&(L=f/s.scale-T),E=Math.max(E,10),L=Math.max(L,10),s.resize.reRender(s,E,L,n,d,h,o,r),s.border.reRender(s)}function $(){s.resize.hidden(),document.removeEventListener("pointermove",w),document.removeEventListener("pointerup",$)}document.addEventListener("pointermove",w),document.addEventListener("pointerup",$)}function nt(s,e){const t=s.container.getBoundingClientRect(),i=(e.clientX-t.left)/s.scale,n=(e.clientY-t.top)/s.scale;function l(c){const o=(c.clientX-t.left)/s.scale,r=(c.clientY-t.top)/s.scale;s.selector.reRender(s,i,n,o,r),s.selector.showPreview()}function a(){s.selector.hiddenSelector(),document.removeEventListener("pointermove",l),document.removeEventListener("pointerup",a)}document.addEventListener("pointermove",l),document.addEventListener("pointerup",a)}function rt(s){s.svg.addEventListener("pointerdown",e=>{e.preventDefault();const t=e.target;if(t.classList[0].includes(`${g}-border-point-`)){const i=t.dataset.ownerId;for(let n=0;n<s.nodes.length;n++)i===s.nodes[n].dataset.ownerId&&s.setSelected(s.nodes[n]);s.selected&&st(s,e);return}if(t.classList.contains(`${g}-svg`)){let i=null;for(const n of s.nodes){const l=A.from(n);if(l.isInSide({x:e.offsetX,y:e.offsetY})){i=l;break}}i&&i.node.classList.contains(`${g}-movable-node`)&&(s.selector.hiddenPreview(),s.setSelected(i.node),s.searchError(),it(s,e)),i||(s.border.hidden(),nt(s,e))}}),document.body.addEventListener("wheel",e=>{const[t,i]=s.scaleRange;e.preventDefault();const n=s.container.getBoundingClientRect(),l=e.clientX-n.left,a=e.clientY-n.top;function c(){s.container.style.transform=`translate(${s.translateX}px, ${s.translateY}px) scale(${s.scale})`,s.container.style.transformOrigin="0 0",s.border.reRender(s)}if(e.ctrlKey){let o=e.deltaY*-.001*5,r=s.scale+o;r=Math.max(t,Math.min(i,r));const d=r/s.scale;s.translateX=l-(l-s.translateX)*d,s.translateY=a-(a-s.translateY)*d,s.scale=r,c()}else s.translateX-=e.deltaX,s.translateY-=e.deltaY,c()})}const lt="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let at=(s=21)=>{let e="",t=crypto.getRandomValues(new Uint8Array(s|=0));for(;s--;)e+=lt[t[s]&63];return e};const U=1,ct="red",X=["vl","vc","vr","ht","hc","hb"];function ht(s){return{vl:s.x,vc:s.x+s.w/2,vr:s.x+s.w,ht:s.y,hc:s.y+s.h/2,hb:s.y+s.h}}function q(s,e){const t=A.from(s.selected),i=s.nodes.filter(n=>n!==s.selected).map(n=>A.from(n));X.forEach(n=>e.alternateNodes[n]=[]),i.forEach(n=>{if(t.isIntersect(n))return;const l=ht(t);X.forEach(a=>{let c=1e4,o=1e4,r;/^h/.test(a)&&(t.x>n.x+n.w?(c=t.x+t.w,o=n.x):t.x+t.w<n.x?(c=t.x,o=n.x+n.w):(c=Math.min(t.x,n.x),o=Math.max(t.x+t.w,n.x+n.w)),[n.y,n.y+n.h/2,n.y+n.h].forEach(d=>{r=Math.abs(l[a]-d),r<=3&&e.alternateNodes[a].push({type:a,source:c,target:o,absorbDistance:r,absorbPosition:d,nodeRects:[n]})})),/^v/.test(a)&&(t.y>n.y+n.h?(c=t.y+t.h,o=n.y):t.y+t.h<n.y?(c=t.y,o=n.y+n.h):(c=Math.min(t.y,n.y),o=Math.max(t.y+t.h,n.y+n.h)),[n.x,n.x+n.w/2,n.x+n.w].forEach(d=>{r=Math.abs(l[a]-d),r<=3&&e.alternateNodes[a].push({type:a,source:c,target:o,absorbDistance:r,absorbPosition:d,nodeRects:[n]})}))})}),X.forEach(n=>{const l=new Map;e.alternateNodes[n].forEach(o=>{const r=l.get(o.absorbDistance)||[];r.push(o),l.set(o.absorbDistance,r)});let a=1/0,c=0;l.forEach(o=>{o.forEach(r=>{a=Math.min(a,r.source,r.target),c=Math.max(c,r.source,r.target)})}),l.forEach(o=>{o.forEach(r=>{r.source=a,r.target=c})}),e.alternateNodes[n]=Array.from(l.values()).flat()})}function ot(s,e,t){const{absorbPosition:i,type:n}=t,l=s.selected;switch(n){case"ht":l.style.top=y(i);break;case"hc":l.style.top=y(i-parseFloat(l.style.height)/2);break;case"hb":l.style.top=y(i-parseFloat(l.style.height));break;case"vl":l.style.left=y(i);break;case"vc":l.style.left=y(i-parseFloat(l.style.width)/2);break;case"vr":l.style.left=y(i-parseFloat(l.style.width));break}q(s,e),s.border.reRender(s)}function dt(s,e){if(!s.selected)return;const t=s.container.getBoundingClientRect(),i=A.from(s.selected),n=t.width/s.scale/2;Math.abs(i.x+i.w/2-n)<=3&&(s.selected.style.left=y(n-i.w/2),e.showContainerAlignLine=!0),q(s,e),s.border.reRender(s)}function gt(s,e){if(!s.selected)return;const t=s.container.getBoundingClientRect(),i=A.from(s.selected),n=Object.values(e.alternateNodes).flat();if([...e.alternateNodes.hb,...e.alternateNodes.hc,...e.alternateNodes.ht].length===0?e.isHAlign=!1:e.isHAlign=!0,[...e.alternateNodes.vc,...e.alternateNodes.vl,...e.alternateNodes.vr].length===0?e.isVAlign=!1:e.isVAlign=!0,n.forEach(l=>{const{source:a,target:c,type:o}=l,r=e.lines[o];if(/^h/.test(o))switch(r==null||r.setAttribute("x1",String(a)),r==null||r.setAttribute("x2",String(c)),o){case"ht":r.setAttribute("y1",String(i.y)),r.setAttribute("y2",String(i.y));break;case"hc":r.setAttribute("y1",String(i.y+i.h/2)),r.setAttribute("y2",String(i.y+i.h/2));break;case"hb":r.setAttribute("y1",String(i.y+i.h)),r.setAttribute("y2",String(i.y+i.h));break}if(/^v/.test(o))switch(r==null||r.setAttribute("y1",String(a)),r==null||r.setAttribute("y2",String(c)),o){case"vl":r.setAttribute("x1",String(i.x)),r.setAttribute("x2",String(i.x));break;case"vc":r.setAttribute("x1",String(i.x+i.w/2)),r.setAttribute("x2",String(i.x+i.w/2));break;case"vr":r.setAttribute("x1",String(i.x+i.w)),r.setAttribute("x2",String(i.x+i.w));break}r.setAttribute("stroke-width",String(U/s.scale)),r==null||r.setAttribute("style","display: 'block")}),e.showContainerAlignLine){const l=e.lines.vertical;l.setAttribute("x1",String(t.width/s.scale/2)),l.setAttribute("y1",String(0)),l.setAttribute("x2",String(t.width/s.scale/2)),l.setAttribute("y2",String(t.height/s.scale)),l.setAttribute("stroke-width",String(U/s.scale)),l==null||l.setAttribute("style","display: 'block")}}class ut{constructor(e){p(this,"g");p(this,"lines");p(this,"isHAlign",!1);p(this,"isVAlign",!1);p(this,"alternateNodes",{ht:[],hc:[],hb:[],vl:[],vc:[],vr:[]});p(this,"showContainerAlignLine",!1);this.g=x("g"),this.g.setAttribute("class",`${g}-align`),this.lines={},[...X,"vertical"].forEach(t=>{const i=x("line");i.setAttribute("class",`${g}-align-${t}`),i.setAttribute("stroke",ct),i.style.display="none",this.g.append(i),this.lines[t]=i}),e.append(this.g)}hidden(){Object.values(this.lines).forEach(e=>{e.style.display="none"})}reRender(e){if(!e.selected)return;this.hidden(),this.alternateNodes={ht:[],hc:[],hb:[],vl:[],vc:[],vr:[]},this.showContainerAlignLine=!1,q(e,this),Object.values(this.alternateNodes).flat().forEach(i=>{ot(e,this,i)}),dt(e,this);let t=1/0;X.forEach(i=>{this.alternateNodes[i].forEach(n=>{n.absorbDistance<t&&(t=n.absorbDistance)})}),X.forEach(i=>{this.alternateNodes[i]=this.alternateNodes[i].filter(n=>j(n.absorbDistance,t,.01))}),gt(e,this)}}const N=1,K="#000",O=6,Q=["left","top","right","bottom"],_=["left-top","top","right-top","right","right-bottom","bottom","left-bottom","left"],bt=["nwse-resize","ns-resize","nesw-resize","ew-resize","nwse-resize","ns-resize","nesw-resize","ew-resize"];function ft(){const s=[],e=[];return Q.forEach(t=>{const i=x("line");i.setAttribute("class",`${g}-border-line-${t}`),i.setAttribute("stroke",K),e.push(i)}),_.forEach((t,i)=>{const n=x("rect");n.setAttribute("class",`${g}-border-point-${t}`),n.setAttribute("fill","white"),n.setAttribute("stroke",K),n.setAttribute("style",`cursor: ${bt[i]}`),n.setAttribute("data-direction",t),s.push(n)}),[s,e]}function yt(s,e){const t=A.from(e.selected);Q.forEach(i=>{const n=b(s,`${g}-border-line-${i}`);switch(n.setAttribute("stroke-width",y(N/e.scale)),i){case"left":n.setAttribute("x1",String(t.x)),n.setAttribute("y1",String(t.y-N/e.scale/2)),n.setAttribute("x2",String(t.x)),n.setAttribute("y2",String(t.y+t.h+N/e.scale/2));break;case"right":n.setAttribute("x1",String(t.x+t.w)),n.setAttribute("y1",String(t.y-N/e.scale/2)),n.setAttribute("x2",String(t.x+t.w)),n.setAttribute("y2",String(t.y+t.h+N/e.scale/2));break;case"top":n.setAttribute("x1",String(t.x-N/e.scale/2)),n.setAttribute("y1",String(t.y)),n.setAttribute("x2",String(t.x+t.w+N/e.scale/2)),n.setAttribute("y2",String(t.y));break;case"bottom":n.setAttribute("x1",String(t.x-N/e.scale/2)),n.setAttribute("y1",String(t.y+t.h)),n.setAttribute("x2",String(t.x+t.w+N/e.scale/2)),n.setAttribute("y2",String(t.y+t.h));break}}),_.forEach((i,n)=>{const l=b(s,`${g}-border-point-${i}`);l.setAttribute("data-owner-id",e.selected.dataset.id),l.setAttribute("stroke-width",y(N/e.scale)),l.setAttribute("width",y(O/e.scale)),l.setAttribute("height",y(O/e.scale));const a=O/e.scale/2;switch(i){case"left-top":l.setAttribute("x",String(t.x-a)),l.setAttribute("y",String(t.y-a));break;case"top":l.setAttribute("x",String(t.x+t.w/2-a)),l.setAttribute("y",String(t.y-a));break;case"right-top":l.setAttribute("x",String(t.x+t.w-a)),l.setAttribute("y",String(t.y-a));break;case"right":l.setAttribute("x",String(t.x+t.w-a)),l.setAttribute("y",String(t.y+t.h/2-a));break;case"right-bottom":l.setAttribute("x",String(t.x+t.w-a)),l.setAttribute("y",String(t.y+t.h-a));break;case"bottom":l.setAttribute("x",String(t.x+t.w/2-a)),l.setAttribute("y",String(t.y+t.h-a));break;case"left-bottom":l.setAttribute("x",String(t.x-a)),l.setAttribute("y",String(t.y+t.h-a));break;case"left":l.setAttribute("x",String(t.x-a)),l.setAttribute("y",String(t.y+t.h/2-a));break}})}class At{constructor(e){p(this,"g");p(this,"points");p(this,"lines");this.g=x("g"),this.g.setAttribute("class",`${g}-border`),e.append(this.g);const[t,i]=ft();this.points=t,this.lines=i,this.g.append(...i,...t),this.g.style.display="none"}hidden(){this.g.style.display="none"}reRender(e){e.selected&&(this.g.style.display="block",yt(this.g,e))}}const D=1,W="#2A63F4",M=8,I=10,J=10;function Z(s){const e=s.nodes.map(n=>A.from(n)),t=new Map,i=new Map;return e.forEach(n=>{var c,o;const l={type:"width",nodeRect:n},a={type:"height",nodeRect:n};t.has(n.w)?(c=t.get(n.w))==null||c.push(l):t.set(n.w,[l]),i.has(n.h)?(o=i.get(n.h))==null||o.push(a):i.set(n.h,[a])}),{widthMap:t,heightMap:i}}function xt(s){s.nodes.forEach(e=>{const t=A.from(e),i=s.resize.g.querySelector(`[data-ower-id="${t.id}"]`),n=b(i,`${g}-resize-line-group-width-line`),l=b(i,`${g}-resize-line-group-width-line-start`),a=b(i,`${g}-resize-line-group-width-line-end`),c=b(i,`${g}-resize-line-group-width-text`),o=b(i,`${g}-resize-line-group-height-line`),r=b(i,`${g}-resize-line-group-height-text`),d=b(i,`${g}-resize-line-group-height-line-start`),h=b(i,`${g}-resize-line-group-height-line-end`);n.setAttribute("x1",String(t.x)),n.setAttribute("y1",String(t.y-M)),n.setAttribute("x2",String(t.x+t.w)),n.setAttribute("y2",String(t.y-M)),l.setAttribute("x",String(t.x-D/s.scale/2)),l.setAttribute("y",String(t.y-M-I/s.scale/2)),l.setAttribute("width",String(D/s.scale)),l.setAttribute("height",String(I)),l.setAttribute("fill",String(W)),a.setAttribute("x",String(t.x+t.w-D/s.scale/2)),a.setAttribute("y",String(t.y-M-I/s.scale/2)),a.setAttribute("width",String(D/s.scale)),a.setAttribute("height",String(I)),a.setAttribute("fill",String(W)),c.textContent=`${P(t.w)}`,c.setAttribute("x",String(t.x+t.w/2)),c.setAttribute("y",String(t.y-M-8)),c.setAttribute("fill",String(W)),c.setAttribute("font-size",String(J/s.scale)),c.setAttribute("text-anchor","middle"),c.setAttribute("alignment-baseline","middle"),o.setAttribute("x1",String(t.x-M)),o.setAttribute("y1",String(t.y)),o.setAttribute("x2",String(t.x-M)),o.setAttribute("y2",String(t.y+t.h)),d.setAttribute("x",String(t.x-M-I/s.scale/2)),d.setAttribute("y",String(t.y-D/s.scale/2)),d.setAttribute("width",String(I)),d.setAttribute("height",String(D/s.scale)),d.setAttribute("fill",String(W)),h.setAttribute("x",String(t.x-M-I/s.scale/2)),h.setAttribute("y",String(t.y+t.h-D/s.scale/2)),h.setAttribute("width",String(I)),h.setAttribute("height",String(D/s.scale)),h.setAttribute("fill",String(W)),r.textContent=`${P(t.h)}`,r.setAttribute("x",String(t.x-M-8)),r.setAttribute("y",String(t.y+t.h/2)),r.setAttribute("fill",String(W)),r.setAttribute("font-size",String(J/s.scale)),r.setAttribute("text-anchor","middle"),r.setAttribute("alignment-baseline","middle"),r.setAttribute("transform",`rotate(-90 ${t.x-M-8} ${t.y+t.h/2})`),[n,o].forEach(u=>{u.setAttribute("stroke",W),u.setAttribute("stroke-width",String(D/s.scale))})})}class pt{constructor(e,t){p(this,"g");p(this,"lines");this.g=x("g"),this.g.setAttribute("class",`${g}-resize`);const i=[];t.forEach(n=>{const l=A.from(n),a=x("g");a.setAttribute("class",`${g}-resize-line`),a.setAttribute("data-ower-id",l.id);const c=x("g");c.setAttribute("class",`${g}-resize-line-group-width`);const o=x("line");o.setAttribute("class",`${g}-resize-line-group-width-line`);const r=x("text");r.setAttribute("class",`${g}-resize-line-group-width-text`);const d=x("rect");d.setAttribute("class",`${g}-resize-line-group-width-line-start`);const h=x("rect");h.setAttribute("class",`${g}-resize-line-group-width-line-end`),c.append(o,r,d,h);const u=x("g");u.setAttribute("class",`${g}-resize-line-group-height`);const f=x("line");f.setAttribute("class",`${g}-resize-line-group-height-line`);const w=x("text");w.setAttribute("class",`${g}-resize-line-group-height-text`);const $=x("rect");$.setAttribute("class",`${g}-resize-line-group-height-line-start`);const k=x("rect");k.setAttribute("class",`${g}-resize-line-group-height-line-end`),u.append(f,w,$,k),a.append(c,u),i.push(a)}),this.lines=i,this.g.append(...this.lines),e.append(this.g),this.hidden()}hidden(){this.lines.forEach(e=>{Array.from(e.children).forEach(t=>{t.style.display="none"})})}reRender(e,t,i,n,l,a,c,o){var tt,et;if(!e.selected)return;this.hidden();const{widthMap:r,heightMap:d}=Z(e),h=[],u=[];r.forEach((R,H)=>{var B;R.length===1&&R[0].nodeRect.id===((B=e.selected)==null?void 0:B.dataset.id)||Math.abs(t-H)<=3&&h.push(H)}),d.forEach((R,H)=>{var B;R.length===1&&R[0].nodeRect.id===((B=e.selected)==null?void 0:B.dataset.id)||Math.abs(i-H)<=3&&u.push(H)});const f=h.length===0?t:Math.max(...h),w=u.length===0?i:Math.max(...u),$=Math.max(f,10),k=Math.max(w,10);if(n.includes("left")){const R=l+c;e.selected.style.left=y(R-$)}else e.selected.style.left=y(l);if(e.selected.style.width=y($),n.includes("top")){const R=a+o;e.selected.style.top=y(R-k)}else e.selected.style.top=y(a);e.selected.style.height=y(k);const m=parseFloat(e.selected.style.width),C=parseFloat(e.selected.style.height),{widthMap:E,heightMap:L}=Z(e);(tt=E.get(m))==null||tt.forEach(R=>{const H=this.g.querySelector(`[data-ower-id="${R.nodeRect.id}"]`),B=b(H,`${g}-resize-line-group-width`);B.style.display="block"}),(et=L.get(C))==null||et.forEach(R=>{const H=this.g.querySelector(`[data-ower-id="${R.nodeRect.id}"]`),B=b(H,`${g}-resize-line-group-height`);B.style.display="block"});const F=this.g.querySelector(`[data-ower-id="${e.selected.dataset.id}"]`),T=b(F,`${g}-resize-line-group-width`),Mt=b(F,`${g}-resize-line-group-height`);Mt.style.display="block",T.style.display="block",xt(e),e.border.reRender(e)}}function wt(s,e,t,i){return t-s>0&&i-e>0?"4":t-s<0&&i-e>0?"3":t-s<0&&i-e<0?"2":t-s>0&&i-e<0?"1":"0"}class St{constructor(e){p(this,"g");p(this,"selectorRect");p(this,"previewRect");p(this,"selectedGroup",[]);this.g=x("g"),this.g.setAttribute("class",`${g}-selector`),this.selectorRect=x("rect"),this.selectorRect.setAttribute("class",`${g}-selector-rect`),this.selectorRect.setAttribute("stroke","#919191"),this.selectorRect.setAttribute("stroke-width","1px"),this.selectorRect.setAttribute("fill","rgba(255,255,255,0.3)"),this.selectorRect.style.display="none",this.previewRect=x("rect"),this.previewRect.setAttribute("class",`${g}-selector-preview`),this.previewRect.setAttribute("stroke","#000"),this.previewRect.setAttribute("stroke-width","1px"),this.previewRect.setAttribute("fill","transparent"),this.previewRect.style.display="none",this.g.append(this.selectorRect,this.previewRect),e.append(this.g)}hiddenSelector(){this.selectorRect.style.display="none"}showSelector(){this.selectorRect.style.display="block"}hiddenPreview(){this.previewRect.style.display="none"}showPreview(){this.previewRect.style.display="block"}reRender(e,t,i,n,l){this.showSelector(),this.hiddenPreview(),this.selectedGroup=[];const a=wt(t,i,n,l),c=Math.abs(t-n),o=Math.abs(i-l);this.selectorRect.setAttribute("width",String(c)),this.selectorRect.setAttribute("height",String(o));let r=t,d=i;switch(a){case"3":{r=r-c;break}case"2":{r=r-c,d=d-o;break}case"1":{d=d-o;break}}this.selectorRect.setAttribute("x",String(r)),this.selectorRect.setAttribute("y",String(d)),e.nodes.forEach(m=>{A.from(m).isIntersect({x:r,y:d,w:c,h:o})&&this.selectedGroup.push(m)});const h=[],u=[],f=[],w=[];this.selectedGroup.forEach(m=>{const{x:C,y:E,w:L,h:F}=A.from(m);h.push(C),u.push(E),f.push(C+L),w.push(E+F)});const $=Math.min(...h),k=Math.min(...u);this.previewRect.setAttribute("x",String(h.length?$:0)),this.previewRect.setAttribute("y",String(u.length?k:0)),this.previewRect.setAttribute("width",String(f.length?Math.max(...f)-$:0)),this.previewRect.setAttribute("height",String(w.length?Math.max(...w)-k:0))}}const S="#3875F6",G=1,v=10,mt=["left","right","top","bottom"];function $t(s){if(!s.selected||!s.nodes||s.nodes.length===0)return;s.distance.left={length:1/0,node:null},s.distance.right={length:1/0,node:null},s.distance.top={length:1/0,node:null},s.distance.bottom={length:1/0,node:null};const e=[],t=A.from(s.selected);s.nodes.forEach(i=>{if(t.node===i)return;const n=A.from(i);e.push(n)}),e.forEach(i=>{if(i.isIntersect(t))return;if(i.y<=t.y+t.h&&i.y+i.h>=t.y){if(t.x+t.w<i.x){const a=Math.abs(t.x+t.w-i.x);s.distance.right.length>a&&(s.distance.right.length=a,s.distance.right.node=i.node)}if(t.x>i.x+i.w){const a=Math.abs(t.x-i.x-i.w);s.distance.left.length>a&&(s.distance.left.length=a,s.distance.left.node=i.node)}}if(i.x<=t.x+t.w&&i.x+i.w>=t.x){if(t.y+t.h<i.y){const a=Math.abs(t.y+t.h-i.y);s.distance.bottom.length>a&&(s.distance.bottom.length=a,s.distance.bottom.node=i.node)}if(t.y>i.y+i.h){const a=Math.abs(t.y-i.y-i.h);s.distance.top.length>a&&(s.distance.top.length=a,s.distance.top.node=i.node)}}})}function V(s){const e=[4,8,12,16];for(const t of e)if(t-2<=s&&t+2>=s)return t;return s}class kt{constructor(e){p(this,"g");p(this,"lines");p(this,"left");p(this,"right");p(this,"top");p(this,"bottom");this.g=x("g"),this.g.setAttribute("class",`${g}-distance`),this.lines={};const t=i=>{const n=x("g");n.setAttribute("class",`${g}-distance-${i}`);const l=x("line");l.setAttribute("class",`${g}-distance-${i}-line`);const a=x("line");a.setAttribute("class",`${g}-distance-${i}-dash-line`);const c=x("text");c.setAttribute("class",`${g}-distance-${i}-text`);const o=x("rect");o.setAttribute("class",`${g}-distance-${i}-text-bg`);const r=x("rect");r.setAttribute("class",`${g}-distance-${i}-line-start`);const d=x("rect");return d.setAttribute("class",`${g}-distance-${i}-line-end`),n.appendChild(l),n.appendChild(a),n.appendChild(o),n.appendChild(c),n.appendChild(r),n.appendChild(d),n};this.left={length:1/0,node:null},this.right={length:1/0,node:null},this.top={length:1/0,node:null},this.bottom={length:1/0,node:null},mt.forEach(i=>{const n=t(i);this.lines[i]=n}),this.g.append(...Object.values(this.lines)),e.append(this.g)}hidden(){Object.values(this.lines).forEach(e=>{e.setAttribute("style","display: none;")})}reRender(e){if(e.selected){if(this.hidden(),$t(e),this.left.node&&this.left.node.id!==e.selected.dataset.id){if(e.align.isHAlign&&!e.align.isVAlign){const u=V(this.left.length);u!==this.left.length&&(e.selected.style.left=y(parseFloat(e.selected.style.left)-this.left.length+u),this.left.length=u,e.align.reRender(e),e.border.reRender(e))}const t=A.from(this.left.node),i=A.from(e.selected),n=b(this.lines.left,`${g}-distance-left-line`);n.setAttribute("x1",String(t.x+t.w)),n.setAttribute("x2",String(i.x)),n.setAttribute("y1",String(i.y+i.h/2)),n.setAttribute("y2",String(i.y+i.h/2)),n.setAttribute("stroke",S),n.setAttribute("stroke-width",String(G/e.scale));const l=b(this.lines.left,`${g}-distance-left-text`);l.textContent=`${P(i.x-t.x-t.w,!0)}`,l.setAttribute("x",String((t.x+t.w+i.x)/2)),l.setAttribute("y",String(i.y+i.h/2-(v+4)/2/e.scale-2/e.scale)),l.setAttribute("fill","#FFFFFF"),l.setAttribute("font-size",String(v/e.scale)),l.setAttribute("text-anchor","middle"),l.setAttribute("alignment-baseline","middle");const a=b(this.lines.left,`${g}-distance-left-text-bg`);a.setAttribute("x",String((t.x+t.w+i.x)/2-(l.getComputedTextLength()+10)/2)),a.setAttribute("y",String(i.y+i.h/2-v/e.scale/2-12/e.scale)),a.setAttribute("width",String(l.getComputedTextLength()+10)),a.setAttribute("height",String((v+4)/e.scale)),a.setAttribute("fill",S),a.setAttribute("rx","4"),a.setAttribute("ry","4");const c=1,o=8,r=b(this.lines.left,`${g}-distance-left-line-start`);r.setAttribute("x",String(t.x+t.w-c/2)),r.setAttribute("y",String(i.y+i.h/2-o/2)),r.setAttribute("width",String(c)),r.setAttribute("height",String(o)),r.setAttribute("fill",S);const d=b(this.lines.left,`${g}-distance-left-line-end`);d.setAttribute("x",String(i.x-c/2)),d.setAttribute("y",String(i.y+i.h/2-o/2)),d.setAttribute("width",String(c)),d.setAttribute("height",String(o)),d.setAttribute("fill",S);const h=b(this.lines.left,`${g}-distance-left-dash-line`);i.y<t.y?(h.setAttribute("x1",String(t.x+t.w)),h.setAttribute("x2",String(t.x+t.w)),h.setAttribute("y1",String(i.y)),h.setAttribute("y2",String(t.y)),h.setAttribute("stroke",S),h.setAttribute("stroke-width","1"),h.setAttribute("stroke-dasharray","4 4"),h.setAttribute("style","display: block;")):i.y+i.h>t.y+t.h?(h.setAttribute("x1",String(t.x+t.w)),h.setAttribute("x2",String(t.x+t.w)),h.setAttribute("y1",String(t.y+t.h)),h.setAttribute("y2",String(i.y+i.h)),h.setAttribute("stroke",S),h.setAttribute("stroke-width","1"),h.setAttribute("stroke-dasharray","4 4"),h.setAttribute("style","display: block;")):h.setAttribute("style","display: none;")}if(this.right.node&&this.right.node.id!==e.selected.dataset.id){if(e.align.isHAlign&&!e.align.isVAlign){const u=V(this.right.length);u!==this.right.length&&(e.selected.style.left=y(parseFloat(e.selected.style.left)+this.right.length-u),this.right.length=u,e.align.reRender(e),e.border.reRender(e))}const t=A.from(this.right.node),i=A.from(e.selected),n=b(this.lines.right,`${g}-distance-right-line`);n.setAttribute("x1",String(i.x+i.w)),n.setAttribute("x2",String(t.x)),n.setAttribute("y1",String(i.y+i.h/2)),n.setAttribute("y2",String(i.y+i.h/2)),n.setAttribute("stroke",S),n.setAttribute("stroke-width",String(G/e.scale));const l=b(this.lines.right,`${g}-distance-right-text`);l.textContent=`${P(t.x-i.x-i.w,!0)}`,l.setAttribute("x",String((i.x+i.w+t.x)/2)),l.setAttribute("y",String(i.y+i.h/2-(v+4)/2/e.scale-2/e.scale)),l.setAttribute("fill","#FFFFFF"),l.setAttribute("font-size",String(v/e.scale)),l.setAttribute("text-anchor","middle"),l.setAttribute("alignment-baseline","middle");const a=b(this.lines.right,`${g}-distance-right-text-bg`);a.setAttribute("x",String((i.x+i.w+t.x)/2-(l.getComputedTextLength()+10)/2)),a.setAttribute("y",String(i.y+i.h/2-v/e.scale/2-12/e.scale)),a.setAttribute("width",String(l.getComputedTextLength()+10)),a.setAttribute("height",String((v+4)/e.scale)),a.setAttribute("fill",S),a.setAttribute("rx","4"),a.setAttribute("ry","4");const c=1,o=8,r=b(this.lines.right,`${g}-distance-right-line-start`);r.setAttribute("x",String(i.x+i.w-c/2)),r.setAttribute("y",String(i.y+i.h/2-o/2)),r.setAttribute("width",String(c)),r.setAttribute("height",String(o)),r.setAttribute("fill",S);const d=b(this.lines.right,`${g}-distance-right-line-end`);d.setAttribute("x",String(t.x-c/2)),d.setAttribute("y",String(i.y+i.h/2-o/2)),d.setAttribute("width",String(c)),d.setAttribute("height",String(o)),d.setAttribute("fill",S);const h=b(this.lines.right,`${g}-distance-right-dash-line`);i.y<t.y?(h.setAttribute("x1",String(t.x)),h.setAttribute("x2",String(t.x)),h.setAttribute("y1",String(i.y)),h.setAttribute("y2",String(t.y)),h.setAttribute("stroke",S),h.setAttribute("stroke-width","1"),h.setAttribute("stroke-dasharray","4 4"),h.setAttribute("style","display: block;")):i.y+i.h>t.y+t.h?(h.setAttribute("x1",String(t.x)),h.setAttribute("x2",String(t.x)),h.setAttribute("y1",String(t.y+t.h)),h.setAttribute("y2",String(i.y+i.h)),h.setAttribute("stroke",S),h.setAttribute("stroke-width","1"),h.setAttribute("stroke-dasharray","4 4"),h.setAttribute("style","display: block;")):h.setAttribute("style","display: none;")}if(this.top.node&&this.top.node.id!==e.selected.dataset.id){if(e.align.isVAlign&&!e.align.isHAlign){const u=V(this.top.length);u!==this.top.length&&(e.selected.style.top=y(parseFloat(e.selected.style.top)-this.top.length+u),this.top.length=u,e.align.reRender(e),e.border.reRender(e))}const t=A.from(this.top.node),i=A.from(e.selected),n=b(this.lines.top,`${g}-distance-top-line`);n.setAttribute("x1",String(i.x+i.w/2)),n.setAttribute("x2",String(i.x+i.w/2)),n.setAttribute("y1",String(i.y)),n.setAttribute("y2",String(t.y+t.h)),n.setAttribute("stroke",S),n.setAttribute("stroke-width",String(G/e.scale));const l=b(this.lines.top,`${g}-distance-top-text`);l.textContent=`${P(i.y-t.h-t.y,!0)}`,l.setAttribute("x",String(i.x+i.w/2+(l.getComputedTextLength()+10)/2+3/e.scale)),l.setAttribute("y",String((i.y+t.y+t.h)/2+1/e.scale)),l.setAttribute("fill","#FFFFFF"),l.setAttribute("font-size",String(v/e.scale)),l.setAttribute("text-anchor","middle"),l.setAttribute("alignment-baseline","middle");const a=b(this.lines.top,`${g}-distance-top-text-bg`);a.setAttribute("x",String(i.x+i.w/2+3/e.scale)),a.setAttribute("y",String((i.y+t.y+t.h)/2-(v/e.scale+4)/2)),a.setAttribute("width",String(l.getComputedTextLength()+10)),a.setAttribute("height",String(v/e.scale+4)),a.setAttribute("fill",S),a.setAttribute("rx","4"),a.setAttribute("ry","4");const c=8,o=1,r=b(this.lines.top,`${g}-distance-top-line-start`);r.setAttribute("x",String(i.x+i.w/2-c/2)),r.setAttribute("y",String(t.y+t.h-o/2)),r.setAttribute("width",String(c)),r.setAttribute("height",String(o)),r.setAttribute("fill",S);const d=b(this.lines.top,`${g}-distance-top-line-end`);d.setAttribute("x",String(i.x+i.w/2-c/2)),d.setAttribute("y",String(i.y-o/2)),d.setAttribute("width",String(c)),d.setAttribute("height",String(o)),d.setAttribute("fill",S);const h=b(this.lines.top,`${g}-distance-top-dash-line`);i.x<t.x?(h.setAttribute("x1",String(i.x)),h.setAttribute("x2",String(t.x)),h.setAttribute("y1",String(t.y+t.h)),h.setAttribute("y2",String(t.y+t.h)),h.setAttribute("stroke",S),h.setAttribute("stroke-width","1"),h.setAttribute("stroke-dasharray","4 4"),h.setAttribute("style","display: block;")):i.x+i.w>t.x+t.w?(h.setAttribute("x1",String(t.x+t.w)),h.setAttribute("x2",String(i.x+i.w)),h.setAttribute("y1",String(t.y+t.h)),h.setAttribute("y2",String(t.y+t.h)),h.setAttribute("stroke",S),h.setAttribute("stroke-width","1"),h.setAttribute("stroke-dasharray","4 4"),h.setAttribute("style","display: block;")):h.setAttribute("style","display: none;")}if(this.bottom.node&&this.bottom.node.id!==e.selected.dataset.id){if(e.align.isVAlign&&!e.align.isHAlign){const f=V(this.bottom.length);f!==this.bottom.length&&(e.selected.style.top=y(parseFloat(e.selected.style.top)+this.bottom.length-f),this.bottom.length=f,e.align.reRender(e),e.border.reRender(e))}const t=A.from(this.bottom.node),i=A.from(e.selected),n=b(this.lines.bottom,`${g}-distance-bottom-line`);n.setAttribute("x1",String(i.x+i.w/2)),n.setAttribute("x2",String(i.x+i.w/2)),n.setAttribute("y1",String(i.y+i.h)),n.setAttribute("y2",String(t.y)),n.setAttribute("stroke",S),n.setAttribute("stroke-width",String(G/e.scale));const l=b(this.lines.bottom,`${g}-distance-bottom-text`);l.textContent=`${P(t.y-i.y-i.h,!0)}`;const a=i.x+i.w/2+(l.getComputedTextLength()+10)/2+3/e.scale;l.setAttribute("x",String(a)),l.setAttribute("y",String((i.y+i.h+t.y)/2+1/e.scale)),l.setAttribute("fill","#FFFFFF"),l.setAttribute("font-size",String(v/e.scale)),l.setAttribute("text-anchor","middle"),l.setAttribute("alignment-baseline","middle");const c=b(this.lines.bottom,`${g}-distance-bottom-text-bg`);c.setAttribute("x",String(i.x+i.w/2+3/e.scale)),c.setAttribute("y",String((i.y+i.h+t.y)/2-(v/e.scale+4)/2)),c.setAttribute("width",String(l.getComputedTextLength()+10)),c.setAttribute("height",String(v/e.scale+4)),c.setAttribute("fill",S),c.setAttribute("rx","4"),c.setAttribute("ry","4");const o=8,r=1,d=b(this.lines.bottom,`${g}-distance-bottom-line-start`);d.setAttribute("x",String(i.x+i.w/2-o/2)),d.setAttribute("y",String(i.y+i.h-r/2)),d.setAttribute("width",String(o)),d.setAttribute("height",String(r)),d.setAttribute("fill",S);const h=b(this.lines.bottom,`${g}-distance-bottom-line-end`);h.setAttribute("x",String(i.x+i.w/2-o/2)),h.setAttribute("y",String(t.y-r/2)),h.setAttribute("width",String(o)),h.setAttribute("height",String(r)),h.setAttribute("fill",S);const u=b(this.lines.bottom,`${g}-distance-bottom-dash-line`);i.x<t.x?(u.setAttribute("x1",String(i.x)),u.setAttribute("x2",String(t.x)),u.setAttribute("y1",String(t.y)),u.setAttribute("y2",String(t.y)),u.setAttribute("stroke",S),u.setAttribute("stroke-width","1"),u.setAttribute("stroke-dasharray","4 4"),u.setAttribute("style","display: block;")):i.x+i.w>t.x+t.w?(u.setAttribute("x1",String(t.x+t.w)),u.setAttribute("x2",String(i.x+i.w)),u.setAttribute("y1",String(t.y)),u.setAttribute("y2",String(t.y)),u.setAttribute("stroke",S),u.setAttribute("stroke-width","1"),u.setAttribute("stroke-dasharray","4 4"),u.setAttribute("style","display: block;")):u.setAttribute("style","display: none;")}e.align.isHAlign&&(j(this.left.length,this.right.length)?(this.lines.left.style="display: block;",this.lines.right.style="display: block;"):this.left.length>this.right.length?this.lines.right.style="display: block;":this.lines.left.style="display: block;"),e.align.isVAlign&&(j(this.top.length,this.bottom.length)?(this.lines.top.style="display: block;",this.lines.bottom.style="display: block;"):this.top.length>this.bottom.length?this.lines.bottom.style="display: block;":this.lines.top.style="display: block;")}}}function vt(s){const e=new Map;function t(a){var o;const c=[];a.toSorted((r,d)=>r.x-d.x).forEach(r=>{c.push({value:r.x,type:"min",nodeRect:r}),c.push({value:r.x+r.w,type:"max",nodeRect:r})}),c.sort((r,d)=>r.value-d.value);for(let r=0;r<c.length-1;r++){const d=[],h=[];if(c[r].type==="max"&&c[r+1].type==="min"){for(let w=0;w<=r&&c[r].value===c[r-w].value;w++)d.push(c[r-w]);for(let w=r+1;w<=c.length&&c[r+1].value===c[w].value;w++)h.push(c[w]);const u=h[0].value-d[0].value,f=d[0].nodeRect.x+d[0].nodeRect.w;if(u>0){const w=Math.min(...d.map(m=>m.nodeRect.y),...h.map(m=>m.nodeRect.y)),$=Math.max(...d.map(m=>m.nodeRect.y+m.nodeRect.h),...h.map(m=>m.nodeRect.y+m.nodeRect.h)),k={x:f,y:w,w:u,h:$-w,rect1:d.map(m=>m.nodeRect),rect2:h.map(m=>m.nodeRect)};e.has(u)?(o=e.get(u))==null||o.push(k):e.set(u,[k])}}}}const i=[],n=A.from(s.selected);s.nodes.forEach(a=>{const c=A.from(a);i.push(c)}),i.sort((a,c)=>a.x-c.x);const l=[];return i.forEach(a=>{(a.y<=n.y&&a.y+a.h>=n.y||a.y<=n.y+n.h/2&&a.y+a.h>=n.y+n.h/2||a.y<=n.y+n.h&&a.y+a.h>=n.y+n.h)&&l.push(a)}),t(l),e}class Et{constructor(e){p(this,"g");this.g=x("g"),this.g.setAttribute("class",`${g}-gap`),e.append(this.g)}clear(){this.g.innerHTML=""}reRender(e){if(!e.selected)return;this.clear();const{left:t,right:i,top:n,bottom:l}=e.distance,a=A.from(e.selected),c=o=>o<0?0:o;if(t.node&&i.node&&e.align.isHAlign&&!e.align.isVAlign){const o=A.from(i.node),r=A.from(t.node),d=(o.x-r.x-r.w-a.w)/2;Math.abs(a.x-r.x-r.w-d)<=3&&(e.selected.style.left=y(r.x+r.w+d),a.sync())}if(n.node&&l.node&&!e.align.isHAlign&&e.align.isVAlign){const o=A.from(l.node),r=A.from(n.node),d=(o.y-r.y-r.h-a.h)/2;Math.abs(a.y-r.y-r.h-d)<=3&&(e.selected.style.top=y(r.y+r.h+d),a.sync())}if(e.align.reRender(e),e.distance.reRender(e),e.border.reRender(e),e.align.isHAlign){const o=[],r=vt(e),d=e.distance.left.length>e.distance.right.length?i:t;if(d.node){const h=A.from(d.node);r.forEach((u,f)=>{if(Math.abs(d.length-f)<=3||f<=20&&Math.abs(d.length-f)<=4){if([...u.map($=>$.rect1.concat($.rect2))].flat().some($=>{var k;return $.id===((k=e.selected)==null?void 0:k.dataset.id)})){o.push(...u);return}d.length===i.length?(e.selected.style.left=y(h.x-f-a.w),e.distance.left.length=f,o.push(...u),a.sync()):d.length===t.length&&(e.selected.style.left=y(h.x+h.w+f),e.distance.right.length=f,o.push(...u),a.sync()),e.align.reRender(e),e.distance.reRender(e),e.border.reRender(e)}}),o.length>1&&o.forEach(u=>{const f=x("rect");f.setAttribute("x",String(u.x)),f.setAttribute("y",String(u.y)),f.setAttribute("width",String(d.length===i.length?c(h.x-a.x-a.w):c(a.x-h.x-h.w))),f.setAttribute("height",String(u.h)),f.setAttribute("fill","red"),f.setAttribute("opacity","0.3"),d.length===i.length&&f.setAttribute("width",String(c(h.x-a.x-a.w))),d.length===t.length&&f.setAttribute("width",String(c(a.x-h.x-h.w))),this.g.append(f)})}}}}const Rt=(s,e)=>{const t=x("svg");t.setAttribute("class",`${g}-svg`);const i=s.getBoundingClientRect();return t.setAttribute("width",y(i.width)),t.setAttribute("height",y(i.height)),t.style="position: absolute; inset: 0;",s.className+=` ${g}-container`,e.forEach(n=>{n.className+=` ${g}-movable-node`,n.setAttribute("data-id",at()),/%$/.test(n.style.top)&&(n.style.top=y(i.width*parseFloat(n.style.top)/100)),/%$/.test(n.style.left)&&(n.style.left=y(i.height*parseFloat(n.style.left)/100)),/%$/.test(n.style.width)&&(n.style.width=y(i.width*parseFloat(n.style.width)/100)),/%$/.test(n.style.height)&&(n.style.height=y(i.height*parseFloat(n.style.height)/100))}),{container:s,nodes:e,svg:t,selected:null,scale:1,scaleRange:[.5,2],translateX:0,translateY:0,setSelected(n){if(this.selected=n,!n){this.border.hidden();return}this.border.reRender(this),this.searchError()},searchError(){if(!this.selected)return;const n=A.from(this.selected);n.error=!1;for(let l=0;l<this.nodes.length;l++){const a=this.nodes[l];if(a===this.selected)continue;const c=A.from(a);n.isIntersect(c)?(n.error=!0,c.error=!0,this.align.hidden(),this.distance.hidden()):c.error=!1}},gap:new Et(t),align:new ut(t),distance:new kt(t),border:new At(t),resize:new pt(t,e),selector:new St(t)}};class Lt{constructor(e,t){p(this,"store");this.store=Rt(e,t),rt(this.store)}mount(){this.store.container.append(this.store.svg)}unmount(){this.store.svg.remove()}align(e){const{selected:t,container:i}=this.store;if(!t)return;const n=i.getBoundingClientRect(),l=A.from(t);switch(e){case"start":t.style.left=y(0);break;case"center":t.style.left=y(n.width/2-l.w/2);break;case"end":t.style.left=y(n.width-l.w);break}}}return Lt});
