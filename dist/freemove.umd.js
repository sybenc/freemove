(function(y,h){typeof exports=="object"&&typeof module<"u"?module.exports=h():typeof define=="function"&&define.amd?define(h):(y=typeof globalThis<"u"?globalThis:y||self,y.createFreeMove=h())})(this,function(){"use strict";var H=Object.defineProperty;var X=(y,h,v)=>h in y?H(y,h,{enumerable:!0,configurable:!0,writable:!0,value:v}):y[h]=v;var S=(y,h,v)=>X(y,typeof h!="symbol"?h+"":h,v);const h="__freemove";class p{constructor({x:t,y:l,h:o,w:i,node:e}){S(this,"x");S(this,"y");S(this,"w");S(this,"h");S(this,"node");this.x=t,this.y=l,this.h=o,this.w=i,this.node=e}isInSide(t){return t.x>=this.x&&t.x<=this.x+this.w&&t.y>=this.y&&t.y<=this.y+this.h}isEquel(t){return this.h===t.h&&this.w===t.w&&this.x===t.x&&this.y===t.y&&this.node===t.node}isIntersect(t){const l=this.x+3,o=this.y+3,i=this.x+this.w-3,e=this.y+this.h-3,a=t.x,s=t.y,c=t.x+t.w,u=t.y+t.h;return!(i<a||l>c||e<s||o>u)}getAlignLinePostion(){return{vl:this.x,vc:this.x+this.w/2,vr:this.x+this.w,ht:this.y,hc:this.y+this.h/2,hb:this.y+this.h}}static from(t){return new p({x:t.offsetLeft,y:t.offsetTop,w:t.offsetWidth,h:t.offsetHeight,node:t})}}function f(r){return typeof r=="number"?`${r}px`:String(r)}const k=1.5,$="#EA3",L=["vl","vc","vr","ht","hc","hb"];function T(r){const t=[];return L.forEach(l=>{const o=document.createElementNS("http://www.w3.org/2000/svg","line");o.setAttribute("class",`${h}-alignLine-${l}`),o.setAttribute("stroke",$),o.setAttribute("stroke-width",String(k)),o.style.display="none",t.push(o)}),t}function D(r){const t={ht:[],hc:[],hb:[],vl:[],vc:[],vr:[]};function l(){let e=p.from(r.selected);t.hb=[],t.hc=[],t.ht=[],t.vc=[],t.vl=[],t.vr=[],r.nodes.forEach(a=>{const s=p.from(a);if(e.isIntersect(s))return;const c=e.getAlignLinePostion();L.forEach(u=>{let d=1e4,n=1e4,x;/^h/.test(u)&&(e.x>s.x+s.w?(d=e.x+e.w,n=s.x):e.x+e.w<s.x?(d=e.x,n=s.x+s.w):(d=Math.min(e.x,s.x),n=Math.max(e.x+e.w,s.x+s.w)),[s.y,s.y+s.h/2,s.y+s.h].forEach(w=>{x=Math.abs(c[u]-w),x<=3&&t[u].push({type:u,source:d,target:n,absorbDistance:x,absorbPosition:w,nodeRects:[s]})})),/^v/.test(u)&&(e.y>s.y+s.h?(d=e.y+e.h,n=s.y):e.y+e.h<s.y?(d=e.y,n=s.y+s.h):(d=Math.min(e.y,s.y),n=Math.max(e.y+e.h,s.y+s.h)),[s.x,s.x+s.w/2,s.x+s.w].forEach(w=>{x=Math.abs(c[u]-w),x<=3&&t[u].push({type:u,source:d,target:n,absorbDistance:x,absorbPosition:w,nodeRects:[s]})}))})})}function o(e){if(!r.selected||!e)return;const{absorbPosition:a,type:s}=e;switch(s){case"ht":r.selected.style.top=f(a);break;case"hc":r.selected.style.top=f(a-parseFloat(r.selected.style.height)/2);break;case"hb":r.selected.style.top=f(a-parseFloat(r.selected.style.height));break;case"vl":r.selected.style.left=f(a);break;case"vc":r.selected.style.left=f(a-parseFloat(r.selected.style.width)/2);break;case"vr":r.selected.style.left=f(a-parseFloat(r.selected.style.width));break}l()}function i(){if(!r.selected)return;const e=p.from(r.selected);Object.values(t).flat().forEach(s=>{const{source:c,target:u,type:d}=s,n=r.alignLine.g.getElementsByClassName(`${h}-alignLine-${d}`)[0];if(/^h/.test(d))switch(n==null||n.setAttribute("x1",String(c)),n==null||n.setAttribute("x2",String(u)),d){case"ht":n.setAttribute("y1",String(e.y)),n.setAttribute("y2",String(e.y));break;case"hc":n.setAttribute("y1",String(e.y+e.h/2)),n.setAttribute("y2",String(e.y+e.h/2));break;case"hb":n.setAttribute("y1",String(e.y+e.h)),n.setAttribute("y2",String(e.y+e.h));break}if(/^v/.test(d))switch(n==null||n.setAttribute("y1",String(c)),n==null||n.setAttribute("y2",String(u)),d){case"vl":n.setAttribute("x1",String(e.x)),n.setAttribute("x2",String(e.x));break;case"vc":n.setAttribute("x1",String(e.x+e.w/2)),n.setAttribute("x2",String(e.x+e.w/2));break;case"vr":n.setAttribute("x1",String(e.x+e.w)),n.setAttribute("x2",String(e.x+e.w));break}n==null||n.setAttribute("style","display: 'block")})}l(),[...t.ht,...t.hc,...t.hb].forEach(e=>{o(e)}),[...t.vl,...t.vc,...t.vr].forEach(e=>{o(e)}),i()}class N{constructor(t){S(this,"g");this.g=document.createElementNS("http://www.w3.org/2000/svg","g"),this.g.setAttribute("class",`${h}-alignLine`),t.append(this.g)}clear(){this.g.innerHTML=""}reRender(t){t.selected&&(this.clear(),this.g.append(...T()),D(t))}}const b=1.5,I="#000",M=["left","top","right","bottom"],R=["ew-resize","ns-resize","ew-resize","ns-resize"];function B(r){const t=p.from(r.selected),l=[];return M.forEach((o,i)=>{const e=document.createElementNS("http://www.w3.org/2000/svg","line");e.setAttribute("class",`${h}-selected-border-line-${o}`),e.setAttribute("stroke",I),e.setAttribute("stroke-width",f(b)),e.setAttribute("style",`cursor: ${R[i]}`);const a=document.createElementNS("http://www.w3.org/2000/svg","line");a.setAttribute("class",`${h}-selected-border-line-action-${o}`),a.setAttribute("stroke","transparent"),a.setAttribute("stroke-width","5px"),a.setAttribute("style",`cursor: ${R[i]}`);const s=[e,a];switch(o){case"left":s.forEach(c=>{c.setAttribute("x1",String(t.x)),c.setAttribute("y1",String(t.y-b/2)),c.setAttribute("x2",String(t.x)),c.setAttribute("y2",String(t.y+t.h+b/2))});break;case"right":s.forEach(c=>{c.setAttribute("x1",String(t.x+t.w)),c.setAttribute("y1",String(t.y-b/2)),c.setAttribute("x2",String(t.x+t.w)),c.setAttribute("y2",String(t.y+t.h+b/2))});break;case"top":s.forEach(c=>{c.setAttribute("x1",String(t.x-b/2)),c.setAttribute("y1",String(t.y)),c.setAttribute("x2",String(t.x+t.w+b/2)),c.setAttribute("y2",String(t.y))});break;case"bottom":s.forEach(c=>{c.setAttribute("x1",String(t.x-b/2)),c.setAttribute("y1",String(t.y+t.h)),c.setAttribute("x2",String(t.x+t.w+b/2)),c.setAttribute("y2",String(t.y+t.h))});break}l.push(e,a)}),l}class F{constructor(t){S(this,"g");this.g=document.createElementNS("http://www.w3.org/2000/svg","g"),this.g.setAttribute("class",`${h}-seleted-border`),t.append(this.g)}clear(){this.g.innerHTML=""}reRender(t){t.selected&&(this.clear(),this.g.append(...B(t)),B(t))}}const _=(r,t)=>{const l=document.createElementNS("http://www.w3.org/2000/svg","svg");l.setAttribute("class",`${h}-svg`);const o=r.getBoundingClientRect();return l.setAttribute("width",f(o.width)),l.setAttribute("height",f(o.height)),l.style="position: absolute; inset: 0;",r.className+=` ${h}-container`,t.forEach(i=>{i.className+=` ${h}-movable-node`,/%$/.test(i.style.x)&&(i.style.x=f(o.width*parseInt(i.style.x)/100)),/%$/.test(i.style.y)&&(i.style.y=f(o.height*parseInt(i.style.y)/100)),/%$/.test(i.style.width)&&(i.style.width=f(o.width*parseInt(i.style.width)/100)),/%$/.test(i.style.height)&&(i.style.height=f(o.height*parseInt(i.style.height)/100))}),{container:r,nodes:t,svg:l,selected:null,alignLine:new N(l),seletedBorder:new F(l),moveDelta:[0,0],setSelected(i){if(this.selected=i,!i){this.seletedBorder.clear();return}this.seletedBorder.reRender(this),console.log(this.seletedBorder)}}};let g;function C(r,t){return g=_(r,t),g.svg.addEventListener("pointerdown",l=>{const o=g.container.getBoundingClientRect();l.preventDefault();let i=null;for(const E of g.nodes){const A=p.from(E);if(A.isInSide({x:l.offsetX,y:l.offsetY})){i=A;break}}if(!i)return;const e=i.node;if(g.setSelected(i.node),g.alignLine.reRender(g),e.classList.contains(`${h}-container`)||!e.classList.contains(`${h}-movable-node`))return;const a=e.getBoundingClientRect();let s=l.clientX-a.left,c=l.clientY-a.top,u=null,d=null,n=null;function x(E){u||(u=requestAnimationFrame(()=>{let A=E.clientX-o.left-s,m=E.clientY-o.top-c;const O=g.container.clientWidth-e.offsetWidth,P=g.container.clientHeight-e.offsetHeight;A=Math.max(0,Math.min(A,O)),m=Math.max(0,Math.min(m,P)),g.moveDelta=[d!==null?A-d:0,n!==null?m-n:0],e.style.left=f(A),e.style.top=f(m),g.alignLine.reRender(g),g.seletedBorder.reRender(g),d=A,n=m,u=null}))}function w(){document.removeEventListener("pointermove",x),document.removeEventListener("pointerup",w),g.alignLine.clear(),u!==null&&(cancelAnimationFrame(u),u=null)}document.addEventListener("pointermove",x),document.addEventListener("pointerup",w)}),g.svg}return C});
