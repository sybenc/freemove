(function(N,c){typeof exports=="object"&&typeof module<"u"?module.exports=c():typeof define=="function"&&define.amd?define(c):(N=typeof globalThis<"u"?globalThis:N||self,N.FreeMove=c())})(this,function(){"use strict";var Rt=Object.defineProperty;var Dt=(N,c,P)=>c in N?Rt(N,c,{enumerable:!0,configurable:!0,writable:!0,value:P}):N[c]=P;var x=(N,c,P)=>Dt(N,typeof c!="symbol"?c+"":c,P);const c="__freemove";class y{constructor({x:i,y:t,h:e,w:s,node:r}){x(this,"x");x(this,"y");x(this,"w");x(this,"h");x(this,"id");x(this,"node");this.x=i,this.y=t,this.h=e,this.w=s,this.node=r,this.id=r.dataset.id}sync(){this.x=parseFloat(this.node.style.left),this.y=parseFloat(this.node.style.top),this.w=parseFloat(this.node.style.width),this.h=parseFloat(this.node.style.height)}set error(i){this.node.setAttribute("data-error",String(i))}get error(){return!!this.node.getAttribute("data-error")}isInSide(i){return i.x>=this.x&&i.x<=this.x+this.w&&i.y>=this.y&&i.y<=this.y+this.h}isIntersect(i){const t=this.x+.01,e=this.y+.01,s=this.x+this.w-.01,r=this.y+this.h-.01,h=i.x,d=i.y,o=i.x+i.w,l=i.y+i.h;return!(s<h||t>o||r<d||e>l)}getAlignLinePostion(){return{vl:this.x,vc:this.x+this.w/2,vr:this.x+this.w,ht:this.y,hc:this.y+this.h/2,hb:this.y+this.h}}static from(i){return new y({x:parseFloat(i.style.left),y:parseFloat(i.style.top),w:parseFloat(i.style.width),h:parseFloat(i.style.height),node:i})}}function A(n){return typeof n=="number"?`${n}px`:String(n)}function q(n,i,t=.1){return Math.abs(n-i)<=t}function b(n,i){return n.getElementsByClassName(i)[0]}function f(n){return document.createElementNS("http://www.w3.org/2000/svg",n)}function H(n,i=!1){return i?Math.round(parseFloat(n.toFixed(1))):Number.isInteger(n)?n.toFixed(0):n.toFixed(1)}function et(n,i){if(!n.selected)return;const t=n.container.getBoundingClientRect();n.selected.dataset.error==="false"&&(n.align.reRender(n),n.distance.reRender(n),n.gap.reRender(n)),n.border.reRender(n);const e=n.selected.getBoundingClientRect();let s=i.clientX-e.left,r=i.clientY-e.top,h=null;function d(l){h||(h=requestAnimationFrame(()=>{if(!n.selected)return;let u=l.clientX-t.left-s,a=l.clientY-t.top-r;const g=n.container.clientWidth-n.selected.offsetWidth,S=n.container.clientHeight-n.selected.offsetHeight;u=Math.max(0,Math.min(u,g)),a=Math.max(0,Math.min(a,S)),n.selected.style.left=A(u),n.selected.style.top=A(a),n.searchError(),n.selected.dataset.error==="false"&&(n.align.reRender(n),n.distance.reRender(n),n.gap.reRender(n)),n.border.reRender(n),h=null}))}function o(){document.removeEventListener("pointermove",d),document.removeEventListener("pointerup",o),n.align.hidden(),n.distance.hidden(),n.gap.clear(),h!==null&&(cancelAnimationFrame(h),h=null)}document.addEventListener("pointermove",d),document.addEventListener("pointerup",o)}function it(n,i){if(!n.selected)return;const t=n.container.getBoundingClientRect(),s=i.target.dataset.direction;if(!s)return;const r=y.from(n.selected);let h=i.clientX,d=i.clientY,o=r.w,l=r.h,u=r.x,a=r.y;const g=t.width,S=t.height;function L(R){let I=R.clientX-h,T=R.clientY-d,w=o,$=l,D=u,O=a;s.includes("right")&&(w=o+I),s.includes("left")&&(w=o-I,D=u+I),s.includes("bottom")&&($=l+T),s.includes("top")&&($=l-T,O=a+T),D<0&&(w+=D,D=0),O<0&&($+=O,O=0),D+w>g&&(w=g-D),O+$>S&&($=S-O),w=Math.max(w,10),$=Math.max($,10),n.resize.reRender(n,w,$,s,u,a,o,l),n.border.reRender(n)}function v(){n.resize.hidden(),document.removeEventListener("pointermove",L),document.removeEventListener("pointerup",v)}document.addEventListener("pointermove",L),document.addEventListener("pointerup",v)}function st(n,i){const t=n.container.getBoundingClientRect(),e=i.clientX-t.left,s=i.clientY-t.top;function r(d){const o=d.clientX-t.left,l=d.clientY-t.top;n.selector.reRender(n,e,s,o,l)}function h(){n.selector.hiddenSelector(),n.selector.showPreview(),document.removeEventListener("pointermove",r),document.removeEventListener("pointerup",h)}document.addEventListener("pointermove",r),document.addEventListener("pointerup",h)}function nt(n){n.svg.addEventListener("pointerdown",i=>{i.preventDefault();const t=i.target;if(t.classList[0].includes(`${c}-border-point-`)){const e=t.dataset.ownerId;for(let s=0;s<n.nodes.length;s++)e===n.nodes[s].dataset.ownerId&&n.setSelected(n.nodes[s]);n.selected&&it(n,i);return}if(t.classList.contains(`${c}-svg`)){let e=null;for(const s of n.nodes){const r=y.from(s);if(r.isInSide({x:i.offsetX,y:i.offsetY})){e=r;break}}e&&e.node.classList.contains(`${c}-movable-node`)&&(n.selector.hiddenPreview(),n.setSelected(e.node),n.searchError(),et(n,i)),e||(n.border.hidden(),st(n,i))}})}const rt="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let lt=(n=21)=>{let i="",t=crypto.getRandomValues(new Uint8Array(n|=0));for(;n--;)i+=rt[t[n]&63];return i};const ht=1,ot="red",W=["vl","vc","vr","ht","hc","hb"];function V(n,i){const t=y.from(n.selected),e=n.nodes.filter(s=>s!==n.selected).map(s=>y.from(s));W.forEach(s=>i.alternateNodes[s]=[]),e.forEach(s=>{if(t.isIntersect(s))return;const r=t.getAlignLinePostion();W.forEach(h=>{let d=1e4,o=1e4,l;/^h/.test(h)&&(t.x>s.x+s.w?(d=t.x+t.w,o=s.x):t.x+t.w<s.x?(d=t.x,o=s.x+s.w):(d=Math.min(t.x,s.x),o=Math.max(t.x+t.w,s.x+s.w)),[s.y,s.y+s.h/2,s.y+s.h].forEach(u=>{l=Math.abs(r[h]-u),l<=3&&i.alternateNodes[h].push({type:h,source:d,target:o,absorbDistance:l,absorbPosition:u,nodeRects:[s]})})),/^v/.test(h)&&(t.y>s.y+s.h?(d=t.y+t.h,o=s.y):t.y+t.h<s.y?(d=t.y,o=s.y+s.h):(d=Math.min(t.y,s.y),o=Math.max(t.y+t.h,s.y+s.h)),[s.x,s.x+s.w/2,s.x+s.w].forEach(u=>{l=Math.abs(r[h]-u),l<=3&&i.alternateNodes[h].push({type:h,source:d,target:o,absorbDistance:l,absorbPosition:u,nodeRects:[s]})}))})}),W.forEach(s=>{const r=new Map;i.alternateNodes[s].forEach(o=>{const l=r.get(o.absorbDistance)||[];l.push(o),r.set(o.absorbDistance,l)});let h=1/0,d=0;r.forEach(o=>{o.forEach(l=>{h=Math.min(h,l.source,l.target),d=Math.max(d,l.source,l.target)})}),r.forEach(o=>{o.forEach(l=>{l.source=h,l.target=d})}),i.alternateNodes[s]=Array.from(r.values()).flat()})}function ct(n,i,t){const{absorbPosition:e,type:s}=t,r=n.selected;switch(s){case"ht":r.style.top=A(e);break;case"hc":r.style.top=A(e-parseFloat(r.style.height)/2);break;case"hb":r.style.top=A(e-parseFloat(r.style.height));break;case"vl":r.style.left=A(e);break;case"vc":r.style.left=A(e-parseFloat(r.style.width)/2);break;case"vr":r.style.left=A(e-parseFloat(r.style.width));break}V(n,i),n.border.reRender(n)}function at(n,i){if(!n.selected)return;const t=n.container.getBoundingClientRect(),e=y.from(n.selected),s=t.width/2;Math.abs(e.x+e.w/2-s)<=3&&(n.selected.style.left=A(s-e.w/2),i.showContainerAlignLine=!0),V(n,i),n.border.reRender(n)}function dt(n,i){if(!n.selected)return;const t=n.container.getBoundingClientRect(),e=y.from(n.selected),s=Object.values(i.alternateNodes).flat();if([...i.alternateNodes.hb,...i.alternateNodes.hc,...i.alternateNodes.ht].length===0?i.isHAlign=!1:i.isHAlign=!0,[...i.alternateNodes.vc,...i.alternateNodes.vl,...i.alternateNodes.vr].length===0?i.isVAlign=!1:i.isVAlign=!0,s.forEach(r=>{const{source:h,target:d,type:o}=r,l=i.lines[o];if(/^h/.test(o))switch(l==null||l.setAttribute("x1",String(h)),l==null||l.setAttribute("x2",String(d)),o){case"ht":l.setAttribute("y1",String(e.y)),l.setAttribute("y2",String(e.y));break;case"hc":l.setAttribute("y1",String(e.y+e.h/2)),l.setAttribute("y2",String(e.y+e.h/2));break;case"hb":l.setAttribute("y1",String(e.y+e.h)),l.setAttribute("y2",String(e.y+e.h));break}if(/^v/.test(o))switch(l==null||l.setAttribute("y1",String(h)),l==null||l.setAttribute("y2",String(d)),o){case"vl":l.setAttribute("x1",String(e.x)),l.setAttribute("x2",String(e.x));break;case"vc":l.setAttribute("x1",String(e.x+e.w/2)),l.setAttribute("x2",String(e.x+e.w/2));break;case"vr":l.setAttribute("x1",String(e.x+e.w)),l.setAttribute("x2",String(e.x+e.w));break}l==null||l.setAttribute("style","display: 'block")}),i.showContainerAlignLine){const r=i.lines.vertical;r.setAttribute("x1",String(t.width/2)),r.setAttribute("y1",String(0)),r.setAttribute("x2",String(t.width/2)),r.setAttribute("y2",String(t.height)),r==null||r.setAttribute("style","display: 'block")}}class ut{constructor(i){x(this,"g");x(this,"lines");x(this,"isHAlign",!1);x(this,"isVAlign",!1);x(this,"alternateNodes",{ht:[],hc:[],hb:[],vl:[],vc:[],vr:[]});x(this,"showContainerAlignLine",!1);this.g=f("g"),this.g.setAttribute("class",`${c}-align`),this.lines={},[...W,"vertical"].forEach(t=>{const e=f("line");e.setAttribute("class",`${c}-align-${t}`),e.setAttribute("stroke",ot),e.setAttribute("stroke-width",String(ht)),e.style.display="none",this.g.append(e),this.lines[t]=e}),i.append(this.g)}hidden(){Object.values(this.lines).forEach(i=>{i.style.display="none"})}reRender(i){if(!i.selected)return;this.hidden(),this.alternateNodes={ht:[],hc:[],hb:[],vl:[],vc:[],vr:[]},this.showContainerAlignLine=!1,V(i,this),Object.values(this.alternateNodes).flat().forEach(e=>{ct(i,this,e)}),at(i,this);let t=1/0;W.forEach(e=>{this.alternateNodes[e].forEach(s=>{s.absorbDistance<t&&(t=s.absorbDistance)})}),W.forEach(e=>{this.alternateNodes[e]=this.alternateNodes[e].filter(s=>q(s.absorbDistance,t,.01))}),dt(i,this)}}const F=1,j="#000",Z=6,Y=["left","top","right","bottom"],U=["left-top","top","right-top","right","right-bottom","bottom","left-bottom","left"],gt=["nwse-resize","ns-resize","nesw-resize","ew-resize","nwse-resize","ns-resize","nesw-resize","ew-resize"];function bt(){const n=[],i=[];return Y.forEach(t=>{const e=f("line");e.setAttribute("class",`${c}-border-line-${t}`),e.setAttribute("stroke",j),e.setAttribute("stroke-width",A(F)),i.push(e)}),U.forEach((t,e)=>{const s=f("rect");s.setAttribute("class",`${c}-border-point-${t}`),s.setAttribute("fill","white"),s.setAttribute("stroke",j),s.setAttribute("stroke-width",A(F)),s.setAttribute("width",A(Z)),s.setAttribute("height",A(Z)),s.setAttribute("style",`cursor: ${gt[e]}`),s.setAttribute("data-direction",t),n.push(s)}),[n,i]}function At(n,i){const t=y.from(i);Y.forEach(e=>{const s=b(n,`${c}-border-line-${e}`);switch(e){case"left":s.setAttribute("x1",String(t.x)),s.setAttribute("y1",String(t.y-F/2)),s.setAttribute("x2",String(t.x)),s.setAttribute("y2",String(t.y+t.h+F/2));break;case"right":s.setAttribute("x1",String(t.x+t.w)),s.setAttribute("y1",String(t.y-F/2)),s.setAttribute("x2",String(t.x+t.w)),s.setAttribute("y2",String(t.y+t.h+F/2));break;case"top":s.setAttribute("x1",String(t.x-F/2)),s.setAttribute("y1",String(t.y)),s.setAttribute("x2",String(t.x+t.w+F/2)),s.setAttribute("y2",String(t.y));break;case"bottom":s.setAttribute("x1",String(t.x-F/2)),s.setAttribute("y1",String(t.y+t.h)),s.setAttribute("x2",String(t.x+t.w+F/2)),s.setAttribute("y2",String(t.y+t.h));break}}),U.forEach((e,s)=>{const r=b(n,`${c}-border-point-${e}`);r.setAttribute("data-owner-id",i.dataset.id);const h=Z/2;switch(e){case"left-top":r.setAttribute("x",String(t.x-h)),r.setAttribute("y",String(t.y-h));break;case"top":r.setAttribute("x",String(t.x+t.w/2-h)),r.setAttribute("y",String(t.y-h));break;case"right-top":r.setAttribute("x",String(t.x+t.w-h)),r.setAttribute("y",String(t.y-h));break;case"right":r.setAttribute("x",String(t.x+t.w-h)),r.setAttribute("y",String(t.y+t.h/2-h));break;case"right-bottom":r.setAttribute("x",String(t.x+t.w-h)),r.setAttribute("y",String(t.y+t.h-h));break;case"bottom":r.setAttribute("x",String(t.x+t.w/2-h)),r.setAttribute("y",String(t.y+t.h-h));break;case"left-bottom":r.setAttribute("x",String(t.x-h)),r.setAttribute("y",String(t.y+t.h-h));break;case"left":r.setAttribute("x",String(t.x-h)),r.setAttribute("y",String(t.y+t.h/2-h));break}})}class yt{constructor(i){x(this,"g");x(this,"points");x(this,"lines");this.g=f("g"),this.g.setAttribute("class",`${c}-border`),i.append(this.g);const[t,e]=bt();this.points=t,this.lines=e,this.g.append(...e,...t),this.g.style.display="none"}hidden(){this.g.style.display="none"}reRender(i){i.selected&&(this.g.style.display="block",At(this.g,i.selected))}}const M=1,C="#2A63F4",k=8,B=10,Q=10;function J(n){const i=n.nodes.map(s=>y.from(s)),t=new Map,e=new Map;return i.forEach(s=>{var d,o;const r={type:"width",nodeRect:s},h={type:"height",nodeRect:s};t.has(s.w)?(d=t.get(s.w))==null||d.push(r):t.set(s.w,[r]),e.has(s.h)?(o=e.get(s.h))==null||o.push(h):e.set(s.h,[h])}),{widthMap:t,heightMap:e}}function ft(n){n.nodes.forEach(i=>{const t=y.from(i),e=n.resize.g.querySelector(`[data-ower-id="${t.id}"]`),s=b(e,`${c}-resize-line-group-width-line`),r=b(e,`${c}-resize-line-group-width-line-start`),h=b(e,`${c}-resize-line-group-width-line-end`),d=b(e,`${c}-resize-line-group-width-text`),o=b(e,`${c}-resize-line-group-height-line`),l=b(e,`${c}-resize-line-group-height-text`),u=b(e,`${c}-resize-line-group-height-line-start`),a=b(e,`${c}-resize-line-group-height-line-end`);s.setAttribute("x1",String(t.x)),s.setAttribute("y1",String(t.y-k)),s.setAttribute("x2",String(t.x+t.w)),s.setAttribute("y2",String(t.y-k)),r.setAttribute("x",String(t.x-M/2)),r.setAttribute("y",String(t.y-k-B/2)),r.setAttribute("width",String(M)),r.setAttribute("height",String(B)),r.setAttribute("fill",String(C)),h.setAttribute("x",String(t.x+t.w-M/2)),h.setAttribute("y",String(t.y-k-B/2)),h.setAttribute("width",String(M)),h.setAttribute("height",String(B)),h.setAttribute("fill",String(C)),d.textContent=`${H(t.w)}`,d.setAttribute("x",String(t.x+t.w/2)),d.setAttribute("y",String(t.y-k-8)),d.setAttribute("fill",String(C)),d.setAttribute("font-size",String(Q)),d.setAttribute("text-anchor","middle"),d.setAttribute("alignment-baseline","middle"),o.setAttribute("x1",String(t.x-k)),o.setAttribute("y1",String(t.y)),o.setAttribute("x2",String(t.x-k)),o.setAttribute("y2",String(t.y+t.h)),u.setAttribute("x",String(t.x-k-B/2)),u.setAttribute("y",String(t.y-M/2)),u.setAttribute("width",String(B)),u.setAttribute("height",String(M)),u.setAttribute("fill",String(C)),a.setAttribute("x",String(t.x-k-B/2)),a.setAttribute("y",String(t.y+t.h-M/2)),a.setAttribute("width",String(B)),a.setAttribute("height",String(M)),a.setAttribute("fill",String(C)),l.textContent=`${H(t.h)}`,l.setAttribute("x",String(t.x-k-8)),l.setAttribute("y",String(t.y+t.h/2)),l.setAttribute("fill",String(C)),l.setAttribute("font-size",String(Q)),l.setAttribute("text-anchor","middle"),l.setAttribute("alignment-baseline","middle"),l.setAttribute("transform",`rotate(-90 ${t.x-k-8} ${t.y+t.h/2})`),[s,o].forEach(g=>{g.setAttribute("stroke",C),g.setAttribute("stroke-width",String(M))})})}class xt{constructor(i,t){x(this,"g");x(this,"lines");this.g=f("g"),this.g.setAttribute("class",`${c}-resize`);const e=[];t.forEach(s=>{const r=y.from(s),h=f("g");h.setAttribute("class",`${c}-resize-line`),h.setAttribute("data-ower-id",r.id);const d=f("g");d.setAttribute("class",`${c}-resize-line-group-width`);const o=f("line");o.setAttribute("class",`${c}-resize-line-group-width-line`);const l=f("text");l.setAttribute("class",`${c}-resize-line-group-width-text`);const u=f("rect");u.setAttribute("class",`${c}-resize-line-group-width-line-start`);const a=f("rect");a.setAttribute("class",`${c}-resize-line-group-width-line-end`),d.append(o,l,u,a);const g=f("g");g.setAttribute("class",`${c}-resize-line-group-height`);const S=f("line");S.setAttribute("class",`${c}-resize-line-group-height-line`);const L=f("text");L.setAttribute("class",`${c}-resize-line-group-height-text`);const v=f("rect");v.setAttribute("class",`${c}-resize-line-group-height-line-start`);const R=f("rect");R.setAttribute("class",`${c}-resize-line-group-height-line-end`),g.append(S,L,v,R),h.append(d,g),e.push(h)}),this.lines=e,this.g.append(...this.lines),i.append(this.g),this.hidden()}hidden(){this.lines.forEach(i=>{Array.from(i.children).forEach(t=>{t.style.display="none"})})}reRender(i,t,e,s,r,h,d,o){var K,tt;if(!i.selected)return;this.hidden();const{widthMap:l,heightMap:u}=J(i),a=[],g=[];l.forEach((m,_)=>{var z;m.length===1&&m[0].nodeRect.id===((z=i.selected)==null?void 0:z.dataset.id)||Math.abs(t-_)<=3&&a.push(_)}),u.forEach((m,_)=>{var z;m.length===1&&m[0].nodeRect.id===((z=i.selected)==null?void 0:z.dataset.id)||Math.abs(e-_)<=3&&g.push(_)});const S=a.length===0?t:Math.max(...a),L=g.length===0?e:Math.max(...g),v=Math.max(S,10),R=Math.max(L,10);if(s.includes("left")){const m=r+d;i.selected.style.left=A(m-v)}else i.selected.style.left=A(r);if(i.selected.style.width=A(v),s.includes("top")){const m=h+o;i.selected.style.top=A(m-R)}else i.selected.style.top=A(h);i.selected.style.height=A(R);const I=parseFloat(i.selected.style.width),T=parseFloat(i.selected.style.height),{widthMap:w,heightMap:$}=J(i);(K=w.get(I))==null||K.forEach(m=>{const _=this.g.querySelector(`[data-ower-id="${m.nodeRect.id}"]`),z=b(_,`${c}-resize-line-group-width`);z.style.display="block"}),(tt=$.get(T))==null||tt.forEach(m=>{const _=this.g.querySelector(`[data-ower-id="${m.nodeRect.id}"]`),z=b(_,`${c}-resize-line-group-height`);z.style.display="block"});const D=this.g.querySelector(`[data-ower-id="${i.selected.dataset.id}"]`),O=b(D,`${c}-resize-line-group-width`),vt=b(D,`${c}-resize-line-group-height`);vt.style.display="block",O.style.display="block",ft(i),i.border.reRender(i)}}function pt(n,i,t,e){return t-n>0&&e-i>0?"4":t-n<0&&e-i>0?"3":t-n<0&&e-i<0?"2":t-n>0&&e-i<0?"1":"0"}class St{constructor(i){x(this,"g");x(this,"selectorRect");x(this,"previewRect");x(this,"selectedGroup",[]);this.g=f("g"),this.g.setAttribute("class",`${c}-selector`),this.selectorRect=f("rect"),this.selectorRect.setAttribute("class",`${c}-selector-rect`),this.selectorRect.setAttribute("stroke","#919191"),this.selectorRect.setAttribute("stroke-width","1px"),this.selectorRect.setAttribute("fill","rgba(255,255,255,0.3)"),this.selectorRect.style.display="none",this.previewRect=f("rect"),this.previewRect.setAttribute("class",`${c}-selector-preview`),this.previewRect.setAttribute("stroke","#000"),this.previewRect.setAttribute("stroke-width","1px"),this.previewRect.setAttribute("fill","transparent"),this.previewRect.style.display="none",this.g.append(this.selectorRect,this.previewRect),i.append(this.g)}hiddenSelector(){this.selectorRect.style.display="none"}showSelector(){this.selectorRect.style.display="block"}hiddenPreview(){this.previewRect.style.display="none"}showPreview(){this.previewRect.style.display="block"}reRender(i,t,e,s,r){this.showSelector(),this.hiddenPreview(),this.selectedGroup=[];const h=pt(t,e,s,r),d=Math.abs(t-s),o=Math.abs(e-r);this.selectorRect.setAttribute("width",String(d)),this.selectorRect.setAttribute("height",String(o));let l=t,u=e;switch(h){case"3":{l=l-d;break}case"2":{l=l-d,u=u-o;break}case"1":{u=u-o;break}}this.selectorRect.setAttribute("x",String(l)),this.selectorRect.setAttribute("y",String(u)),i.nodes.forEach(I=>{y.from(I).isIntersect({x:l,y:u,w:d,h:o})&&this.selectedGroup.push(I)});const a=[],g=[],S=[],L=[];this.selectedGroup.forEach(I=>{const{x:T,y:w,w:$,h:D}=y.from(I);a.push(T),g.push(w),S.push(T+$),L.push(w+D)});const v=Math.min(...a),R=Math.min(...g);this.previewRect.setAttribute("x",String(a.length?v:0)),this.previewRect.setAttribute("y",String(g.length?R:0)),this.previewRect.setAttribute("width",String(S.length?Math.max(...S)-v:0)),this.previewRect.setAttribute("height",String(L.length?Math.max(...L)-R:0))}}const p="#3875F6",G=1,E=10,wt=["left","right","top","bottom"];function mt(n){const i=[],t=y.from(n.selected);n.nodes.forEach(e=>{if(t.node===e)return;const s=y.from(e);i.push(s)}),i.forEach(e=>{if(e.isIntersect(t))return;if(e.y<=t.y&&e.y+e.h>=t.y||e.y<=t.y+t.h/2&&e.y+e.h>=t.y+t.h/2||e.y<=t.y+t.h&&e.y+e.h>=t.y+t.h){if(t.x+t.w<e.x){const r=Math.abs(t.x+t.w-e.x);n.distance.right.length>r&&(n.distance.right.length=r,n.distance.right.node=e.node)}if(t.x>e.x+e.w){const r=Math.abs(t.x-e.x-e.w);n.distance.left.length>r&&(n.distance.left.length=r,n.distance.left.node=e.node)}}}),i.forEach(e=>{if(e.isIntersect(t))return;if(e.x<=t.x&&e.x+e.w>=t.x||e.x<=t.x+t.w/2&&e.x+e.w>=t.x+t.w/2||e.x<=t.x+t.w&&e.x+e.w>=t.x+t.w){if(t.y+t.h<e.y){const r=Math.abs(t.y+t.h-e.y);n.distance.bottom.length>r&&(n.distance.bottom.length=r,n.distance.bottom.node=e.node)}if(t.y>e.y+e.h){const r=Math.abs(t.y-e.y-e.h);n.distance.top.length>r&&(n.distance.top.length=r,n.distance.top.node=e.node)}}})}function X(n){const i=[0,4,8,12,16];for(const t of i)if(t-2<=n&&t+2>=n)return t;return n}class Et{constructor(i){x(this,"g");x(this,"lines");x(this,"left");x(this,"right");x(this,"top");x(this,"bottom");this.g=f("g"),this.g.setAttribute("class",`${c}-distance`),this.lines={};const t=e=>{const s=f("g");s.setAttribute("class",`${c}-distance-${e}`);const r=f("line");r.setAttribute("class",`${c}-distance-${e}-line`);const h=f("line");h.setAttribute("class",`${c}-distance-${e}-dash-line`);const d=f("text");d.setAttribute("class",`${c}-distance-${e}-text`);const o=f("rect");o.setAttribute("class",`${c}-distance-${e}-text-bg`);const l=f("rect");l.setAttribute("class",`${c}-distance-${e}-line-start`);const u=f("rect");return u.setAttribute("class",`${c}-distance-${e}-line-end`),s.appendChild(r),s.appendChild(h),s.appendChild(o),s.appendChild(d),s.appendChild(l),s.appendChild(u),s};this.left={length:1/0,node:null},this.right={length:1/0,node:null},this.top={length:1/0,node:null},this.bottom={length:1/0,node:null},wt.forEach(e=>{const s=t(e);this.lines[e]=s}),this.g.append(...Object.values(this.lines)),i.append(this.g)}hidden(){Object.values(this.lines).forEach(i=>{i.setAttribute("style","display: none;")}),this.left={length:1/0,node:null},this.right={length:1/0,node:null},this.top={length:1/0,node:null},this.bottom={length:1/0,node:null}}reRender(i){if(i.selected){if(this.hidden(),mt(i),this.left.node&&this.left.node.id!==i.selected.dataset.id){if(i.align.isHAlign){const g=X(this.left.length);g!==this.left.length&&(i.selected.style.left=A(parseFloat(i.selected.style.left)-this.left.length+g),this.left.length=g,i.align.reRender(i),i.border.reRender(i))}const t=y.from(this.left.node),e=y.from(i.selected),s=b(this.lines.left,`${c}-distance-left-line`);s.setAttribute("x1",String(t.x+t.w)),s.setAttribute("x2",String(e.x)),s.setAttribute("y1",String(e.y+e.h/2)),s.setAttribute("y2",String(e.y+e.h/2)),s.setAttribute("stroke",p),s.setAttribute("stroke-width",String(G));const r=b(this.lines.left,`${c}-distance-left-text`);r.textContent=`${H(this.left.length,!0)}`,r.setAttribute("x",String((t.x+t.w+e.x)/2)),r.setAttribute("y",String(e.y+e.h/2-9)),r.setAttribute("fill","#FFFFFF"),r.setAttribute("font-size",String(E)),r.setAttribute("text-anchor","middle"),r.setAttribute("alignment-baseline","middle");const h=b(this.lines.left,`${c}-distance-left-text-bg`);h.setAttribute("x",String((t.x+t.w+e.x)/2-(r.getComputedTextLength()+10)/2)),h.setAttribute("y",String(e.y+e.h/2-E/2-12)),h.setAttribute("width",String(r.getComputedTextLength()+10)),h.setAttribute("height",String(E+4)),h.setAttribute("fill",p),h.setAttribute("rx","4"),h.setAttribute("ry","4");const d=1,o=8,l=b(this.lines.left,`${c}-distance-left-line-start`);l.setAttribute("x",String(t.x+t.w-d/2)),l.setAttribute("y",String(e.y+e.h/2-o/2)),l.setAttribute("width",String(d)),l.setAttribute("height",String(o)),l.setAttribute("fill",p);const u=b(this.lines.left,`${c}-distance-left-line-end`);u.setAttribute("x",String(e.x-d/2)),u.setAttribute("y",String(e.y+e.h/2-o/2)),u.setAttribute("width",String(d)),u.setAttribute("height",String(o)),u.setAttribute("fill",p);const a=b(this.lines.left,`${c}-distance-left-dash-line`);e.y<t.y?(a.setAttribute("x1",String(t.x+t.w)),a.setAttribute("x2",String(t.x+t.w)),a.setAttribute("y1",String(e.y)),a.setAttribute("y2",String(t.y)),a.setAttribute("stroke",p),a.setAttribute("stroke-width","1"),a.setAttribute("stroke-dasharray","4 4"),a.setAttribute("style","display: block;")):e.y+e.h>t.y+t.h?(a.setAttribute("x1",String(t.x+t.w)),a.setAttribute("x2",String(t.x+t.w)),a.setAttribute("y1",String(t.y+t.h)),a.setAttribute("y2",String(e.y+e.h)),a.setAttribute("stroke",p),a.setAttribute("stroke-width","1"),a.setAttribute("stroke-dasharray","4 4"),a.setAttribute("style","display: block;")):a.setAttribute("style","display: none;")}if(this.right.node&&this.right.node.id!==i.selected.dataset.id){if(i.align.isHAlign){const g=X(this.right.length);g!==this.right.length&&(i.selected.style.left=A(parseFloat(i.selected.style.left)+this.right.length-g),this.right.length=g,i.align.reRender(i),i.border.reRender(i))}const t=y.from(this.right.node),e=y.from(i.selected),s=b(this.lines.right,`${c}-distance-right-line`);s.setAttribute("x1",String(e.x+e.w)),s.setAttribute("x2",String(t.x)),s.setAttribute("y1",String(e.y+e.h/2)),s.setAttribute("y2",String(e.y+e.h/2)),s.setAttribute("stroke",p),s.setAttribute("stroke-width",String(G));const r=b(this.lines.right,`${c}-distance-right-text`);r.textContent=`${H(this.right.length,!0)}`,r.setAttribute("x",String((e.x+e.w+t.x)/2)),r.setAttribute("y",String(e.y+e.h/2-9)),r.setAttribute("fill","#FFFFFF"),r.setAttribute("font-size",String(E)),r.setAttribute("text-anchor","middle"),r.setAttribute("alignment-baseline","middle");const h=b(this.lines.right,`${c}-distance-right-text-bg`);h.setAttribute("x",String((e.x+e.w+t.x)/2-(r.getComputedTextLength()+10)/2)),h.setAttribute("y",String(e.y+e.h/2-E/2-12)),h.setAttribute("width",String(r.getComputedTextLength()+10)),h.setAttribute("height",String(E+4)),h.setAttribute("fill",p),h.setAttribute("rx","4"),h.setAttribute("ry","4");const d=1,o=8,l=b(this.lines.right,`${c}-distance-right-line-start`);l.setAttribute("x",String(e.x+e.w-d/2)),l.setAttribute("y",String(e.y+e.h/2-o/2)),l.setAttribute("width",String(d)),l.setAttribute("height",String(o)),l.setAttribute("fill",p);const u=b(this.lines.right,`${c}-distance-right-line-end`);u.setAttribute("x",String(t.x-d/2)),u.setAttribute("y",String(e.y+e.h/2-o/2)),u.setAttribute("width",String(d)),u.setAttribute("height",String(o)),u.setAttribute("fill",p);const a=b(this.lines.right,`${c}-distance-right-dash-line`);e.y<t.y?(a.setAttribute("x1",String(t.x)),a.setAttribute("x2",String(t.x)),a.setAttribute("y1",String(e.y)),a.setAttribute("y2",String(t.y)),a.setAttribute("stroke",p),a.setAttribute("stroke-width","1"),a.setAttribute("stroke-dasharray","4 4"),a.setAttribute("style","display: block;")):e.y+e.h>t.y+t.h?(a.setAttribute("x1",String(t.x)),a.setAttribute("x2",String(t.x)),a.setAttribute("y1",String(t.y+t.h)),a.setAttribute("y2",String(e.y+e.h)),a.setAttribute("stroke",p),a.setAttribute("stroke-width","1"),a.setAttribute("stroke-dasharray","4 4"),a.setAttribute("style","display: block;")):a.setAttribute("style","display: none;")}if(this.top.node&&this.top.node.id!==i.selected.dataset.id){if(i.align.isVAlign){const g=X(this.top.length);g!==this.top.length&&(i.selected.style.top=A(parseFloat(i.selected.style.top)-this.top.length+g),this.top.length=g,i.align.reRender(i),i.border.reRender(i))}const t=y.from(this.top.node),e=y.from(i.selected),s=b(this.lines.top,`${c}-distance-top-line`);s.setAttribute("x1",String(e.x+e.w/2)),s.setAttribute("x2",String(e.x+e.w/2)),s.setAttribute("y1",String(e.y)),s.setAttribute("y2",String(t.y+t.h)),s.setAttribute("stroke",p),s.setAttribute("stroke-width",String(G));const r=b(this.lines.top,`${c}-distance-top-text`);r.textContent=`${H(this.top.length,!0)}`,r.setAttribute("x",String(e.x+e.w/2+(r.getComputedTextLength()+10)/2+3)),r.setAttribute("y",String((e.y+t.y+t.h)/2+1)),r.setAttribute("fill","#FFFFFF"),r.setAttribute("font-size",String(E)),r.setAttribute("text-anchor","middle"),r.setAttribute("alignment-baseline","middle");const h=b(this.lines.top,`${c}-distance-top-text-bg`);h.setAttribute("x",String(e.x+e.w/2+3)),h.setAttribute("y",String((e.y+t.y+t.h)/2-(E+4)/2)),h.setAttribute("width",String(r.getComputedTextLength()+10)),h.setAttribute("height",String(E+4)),h.setAttribute("fill",p),h.setAttribute("rx","4"),h.setAttribute("ry","4");const d=8,o=1,l=b(this.lines.top,`${c}-distance-top-line-start`);l.setAttribute("x",String(e.x+e.w/2-d/2)),l.setAttribute("y",String(t.y+t.h-o/2)),l.setAttribute("width",String(d)),l.setAttribute("height",String(o)),l.setAttribute("fill",p);const u=b(this.lines.top,`${c}-distance-top-line-end`);u.setAttribute("x",String(e.x+e.w/2-d/2)),u.setAttribute("y",String(e.y-o/2)),u.setAttribute("width",String(d)),u.setAttribute("height",String(o)),u.setAttribute("fill",p);const a=b(this.lines.top,`${c}-distance-top-dash-line`);e.x<t.x?(a.setAttribute("x1",String(e.x)),a.setAttribute("x2",String(t.x)),a.setAttribute("y1",String(t.y+t.h)),a.setAttribute("y2",String(t.y+t.h)),a.setAttribute("stroke",p),a.setAttribute("stroke-width","1"),a.setAttribute("stroke-dasharray","4 4"),a.setAttribute("style","display: block;")):e.x+e.w>t.x+t.w?(a.setAttribute("x1",String(t.x+t.w)),a.setAttribute("x2",String(e.x+e.w)),a.setAttribute("y1",String(t.y+t.h)),a.setAttribute("y2",String(t.y+t.h)),a.setAttribute("stroke",p),a.setAttribute("stroke-width","1"),a.setAttribute("stroke-dasharray","4 4"),a.setAttribute("style","display: block;")):a.setAttribute("style","display: none;")}if(this.bottom.node&&this.bottom.node.id!==i.selected.dataset.id){if(i.align.isVAlign){const S=X(this.bottom.length);S!==this.bottom.length&&(i.selected.style.top=A(parseFloat(i.selected.style.top)+this.bottom.length-S),this.bottom.length=S,i.align.reRender(i),i.border.reRender(i))}const t=y.from(this.bottom.node),e=y.from(i.selected),s=b(this.lines.bottom,`${c}-distance-bottom-line`);s.setAttribute("x1",String(e.x+e.w/2)),s.setAttribute("x2",String(e.x+e.w/2)),s.setAttribute("y1",String(e.y+e.h)),s.setAttribute("y2",String(t.y)),s.setAttribute("stroke",p),s.setAttribute("stroke-width",String(G));const r=b(this.lines.bottom,`${c}-distance-bottom-text`);r.textContent=`${H(this.bottom.length,!0)}`;const h=e.x+e.w/2+(r.getComputedTextLength()+10)/2+3;r.setAttribute("x",String(h)),r.setAttribute("y",String((e.y+e.h+t.y)/2+1)),r.setAttribute("fill","#FFFFFF"),r.setAttribute("font-size",String(E)),r.setAttribute("text-anchor","middle"),r.setAttribute("alignment-baseline","middle");const d=b(this.lines.bottom,`${c}-distance-bottom-text-bg`);d.setAttribute("x",String(e.x+e.w/2+3)),d.setAttribute("y",String((e.y+e.h+t.y)/2-(E+4)/2)),d.setAttribute("width",String(r.getComputedTextLength()+10)),d.setAttribute("height",String(E+4)),d.setAttribute("fill",p),d.setAttribute("rx","4"),d.setAttribute("ry","4");const o=8,l=1,u=b(this.lines.bottom,`${c}-distance-bottom-line-start`);u.setAttribute("x",String(e.x+e.w/2-o/2)),u.setAttribute("y",String(e.y+e.h-l/2)),u.setAttribute("width",String(o)),u.setAttribute("height",String(l)),u.setAttribute("fill",p);const a=b(this.lines.bottom,`${c}-distance-bottom-line-end`);a.setAttribute("x",String(e.x+e.w/2-o/2)),a.setAttribute("y",String(t.y-l/2)),a.setAttribute("width",String(o)),a.setAttribute("height",String(l)),a.setAttribute("fill",p);const g=b(this.lines.bottom,`${c}-distance-bottom-dash-line`);e.x<t.x?(g.setAttribute("x1",String(e.x)),g.setAttribute("x2",String(t.x)),g.setAttribute("y1",String(t.y)),g.setAttribute("y2",String(t.y)),g.setAttribute("stroke",p),g.setAttribute("stroke-width","1"),g.setAttribute("stroke-dasharray","4 4"),g.setAttribute("style","display: block;")):e.x+e.w>t.x+t.w?(g.setAttribute("x1",String(t.x+t.w)),g.setAttribute("x2",String(e.x+e.w)),g.setAttribute("y1",String(t.y)),g.setAttribute("y2",String(t.y)),g.setAttribute("stroke",p),g.setAttribute("stroke-width","1"),g.setAttribute("stroke-dasharray","4 4"),g.setAttribute("style","display: block;")):g.setAttribute("style","display: none;")}i.align.isHAlign&&(q(this.left.length,this.right.length)?(this.lines.left.style="display: block;",this.lines.right.style="display: block;"):this.left.length>this.right.length?this.lines.right.style="display: block;":this.lines.left.style="display: block;"),i.align.isVAlign&&(q(this.top.length,this.bottom.length)?(this.lines.top.style="display: block;",this.lines.bottom.style="display: block;"):this.top.length>this.bottom.length?this.lines.bottom.style="display: block;":this.lines.top.style="display: block;")}}}class $t{constructor(i){x(this,"g");this.g=f("g"),this.g.setAttribute("class",`${c}-gap`),i.append(this.g)}clear(){this.g.innerHTML=""}reRender(i){if(!i.selected)return;this.clear();const{left:t,right:e,top:s,bottom:r}=i.distance,h=y.from(i.selected);if(t.node&&e.node){const d=y.from(e.node),o=y.from(t.node),l=(d.x-o.x-o.w-h.w)/2;Math.abs(h.x-o.x-o.w-l)<=3&&(i.selected.style.left=A(o.x+o.w+l),h.sync())}if(s.node&&r.node){const d=y.from(r.node),o=y.from(s.node),l=(d.y-o.y-o.h-h.h)/2;Math.abs(h.y-o.y-o.h-l)<=3&&(i.selected.style.top=A(o.y+o.h+l),h.sync())}i.align.reRender(i),i.distance.reRender(i),i.border.reRender(i)}}const kt=(n,i)=>{const t=f("svg");t.setAttribute("class",`${c}-svg`);const e=n.getBoundingClientRect();return t.setAttribute("width",A(e.width)),t.setAttribute("height",A(e.height)),t.style="position: absolute; inset: 0;",n.className+=` ${c}-container`,i.forEach(s=>{s.className+=` ${c}-movable-node`,s.setAttribute("data-id",lt()),/%$/.test(s.style.top)&&(s.style.top=A(e.width*parseFloat(s.style.top)/100)),/%$/.test(s.style.left)&&(s.style.left=A(e.height*parseFloat(s.style.left)/100)),/%$/.test(s.style.width)&&(s.style.width=A(e.width*parseFloat(s.style.width)/100)),/%$/.test(s.style.height)&&(s.style.height=A(e.height*parseFloat(s.style.height)/100))}),{container:n,nodes:i,svg:t,selected:null,setSelected(s){if(this.selected=s,!s){this.border.hidden();return}this.border.reRender(this),this.searchError()},searchError(){if(!this.selected)return;const s=y.from(this.selected);s.error=!1;for(let r=0;r<this.nodes.length;r++){const h=this.nodes[r];if(h===this.selected)continue;const d=y.from(h);s.isIntersect(d)?(s.error=!0,d.error=!0,this.align.hidden(),this.distance.hidden()):d.error=!1}},gap:new $t(t),align:new ut(t),distance:new Et(t),border:new yt(t),resize:new xt(t,i),selector:new St(t)}};class Lt{constructor(i,t){x(this,"store");this.store=kt(i,t),nt(this.store)}mount(){this.store.container.append(this.store.svg)}unmount(){this.store.svg.remove()}align(i){const{selected:t,container:e}=this.store;if(!t)return;const s=e.getBoundingClientRect(),r=y.from(t);switch(i){case"start":t.style.left=A(0);break;case"center":t.style.left=A(s.width/2-r.w/2);break;case"end":t.style.left=A(s.width-r.w);break}}}return Lt});
