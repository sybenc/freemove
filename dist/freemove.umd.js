(function(f,o){typeof exports=="object"&&typeof module<"u"?module.exports=o():typeof define=="function"&&define.amd?define(o):(f=typeof globalThis<"u"?globalThis:f||self,f.createFreeMove=o())})(this,function(){"use strict";var B=Object.defineProperty;var I=(f,o,v)=>o in f?B(f,o,{enumerable:!0,configurable:!0,writable:!0,value:v}):f[o]=v;var w=(f,o,v)=>I(f,typeof o!="symbol"?o+"":o,v);class o{constructor({x:t,y:r,h:c,w:u,node:e}){w(this,"x");w(this,"y");w(this,"w");w(this,"h");w(this,"node");this.x=t,this.y=r,this.h=c,this.w=u,this.node=e}isInSide(t){return t.x>=this.x&&t.x<=this.x+this.w&&t.y>=this.y&&t.y<=this.y+this.h}isEquel(t){return this.h===t.h&&this.w===t.w&&this.x===t.x&&this.y===t.y&&this.node===t.node}isIntersect(t){const r=this.x+3,c=this.y+3,u=this.x+this.w-3,e=this.y+this.h-3,d=t.x,s=t.y,y=t.x+t.w,l=t.y+t.h;return!(u<d||r>y||e<s||c>l)}getAlignLinePostion(){return{vl:this.x,vc:this.x+this.w/2,vr:this.x+this.w,ht:this.y,hc:this.y+this.h/2,hb:this.y+this.h}}static from(t){return new o({x:parseFloat(t.style.left),y:parseFloat(t.style.top),w:parseFloat(t.style.width),h:parseFloat(t.style.height),node:t})}}const v=3;function g(i){return typeof i=="number"?`${i}px`:String(i)}const S=1.5,E="#EA3",L=["vl","vc","vr","ht","hc","hb"];function _(i){const t=[];return L.forEach(r=>{const c=document.createElementNS("http://www.w3.org/2000/svg","line");c.setAttribute("class",`__freemove-alignLine-${r}`),c.setAttribute("stroke",E),c.setAttribute("stroke-width",String(S)),c.style.display="none",t.push(c)}),t}function k(i){const t={ht:[],hc:[],hb:[],vl:[],vc:[],vr:[]};function r(){let e=o.from(i.selected);t.hb=[],t.hc=[],t.ht=[],t.vc=[],t.vl=[],t.vr=[],i.nodes.forEach(d=>{const s=o.from(d);if(e.isIntersect(s))return;const y=e.getAlignLinePostion();L.forEach(l=>{let a=1e4,n=1e4,b;/^h/.test(l)&&(e.x>s.x+s.w?(a=e.x+e.w,n=s.x):e.x+e.w<s.x?(a=e.x,n=s.x+s.w):(a=Math.min(e.x,s.x),n=Math.max(e.x+e.w,s.x+s.w)),[s.y,s.y+s.h/2,s.y+s.h].forEach(x=>{b=Math.abs(y[l]-x),b<=v&&t[l].push({type:l,source:a,target:n,absorbDistance:b,absorbPosition:x,nodeRects:[s]})})),/^v/.test(l)&&(e.y>s.y+s.h?(a=e.y+e.h,n=s.y):e.y+e.h<s.y?(a=e.y,n=s.y+s.h):(a=Math.min(e.y,s.y),n=Math.max(e.y+e.h,s.y+s.h)),[s.x,s.x+s.w/2,s.x+s.w].forEach(x=>{b=Math.abs(y[l]-x),b<=v&&t[l].push({type:l,source:a,target:n,absorbDistance:b,absorbPosition:x,nodeRects:[s]})}))})}),t.hb.length&&t.hc.length&&t.ht.length}function c(e){if(!i.selected||!e)return;const{absorbPosition:d,type:s}=e;switch(s){case"ht":i.selected.style.top=g(d);break;case"hc":i.selected.style.top=g(d-parseFloat(i.selected.style.height)/2);break;case"hb":i.selected.style.top=g(d-parseFloat(i.selected.style.height));break;case"vl":i.selected.style.left=g(d);break;case"vc":i.selected.style.left=g(d-parseFloat(i.selected.style.width)/2);break;case"vr":i.selected.style.left=g(d-parseFloat(i.selected.style.width));break}r()}function u(){if(!i.selected)return;const e=o.from(i.selected);Object.values(t).flat().forEach(s=>{const{source:y,target:l,type:a}=s,n=i.alignLine.g.getElementsByClassName(`__freemove-alignLine-${a}`)[0];if(/^h/.test(a))switch(n==null||n.setAttribute("x1",String(y)),n==null||n.setAttribute("x2",String(l)),a){case"ht":n.setAttribute("y1",String(e.y)),n.setAttribute("y2",String(e.y));break;case"hc":n.setAttribute("y1",String(e.y+e.h/2)),n.setAttribute("y2",String(e.y+e.h/2));break;case"hb":n.setAttribute("y1",String(e.y+e.h)),n.setAttribute("y2",String(e.y+e.h));break}if(/^v/.test(a))switch(n==null||n.setAttribute("y1",String(y)),n==null||n.setAttribute("y2",String(l)),a){case"vl":n.setAttribute("x1",String(e.x)),n.setAttribute("x2",String(e.x));break;case"vc":n.setAttribute("x1",String(e.x+e.w/2)),n.setAttribute("x2",String(e.x+e.w/2));break;case"vr":n.setAttribute("x1",String(e.x+e.w)),n.setAttribute("x2",String(e.x+e.w));break}n==null||n.setAttribute("style","display: 'block")})}r(),[...t.ht,...t.hc,...t.hb].forEach(e=>{c(e)}),[...t.vl,...t.vc,...t.vr].forEach(e=>{c(e)}),u()}class R{constructor(t){w(this,"g");this.g=document.createElementNS("http://www.w3.org/2000/svg","g"),this.g.setAttribute("class","__freemove-alignLine"),t.append(this.g)}get nodes(){return this.g}clear(){this.g.innerHTML=""}reRender(t){t.selected&&(this.clear(),this.g.append(..._()),k(t))}}const F=(i,t)=>{const r=document.createElementNS("http://www.w3.org/2000/svg","svg");r.setAttribute("class","__freemove-svg");const c=i.getBoundingClientRect();return r.setAttribute("width",g(c.width)),r.setAttribute("height",g(c.height)),r.style="position: absolute; inset: 0;",i.className+=" __freemove-container",t.forEach(u=>u.className+=" __freemove-movable-node"),{container:i,nodes:t,svg:r,selected:null,alignLine:new R(r),moveDelta:[0,0],setSelected(u){this.selected=u}}};let h;function M(i,t){return h=F(i,t),h.svg.addEventListener("pointerdown",r=>{const c=h.container.getBoundingClientRect();r.preventDefault();let u=null;for(const p of h.nodes){const m=o.from(p);if(m.isInSide({x:r.offsetX,y:r.offsetY})){u=m;break}}if(!u)return;const e=u.node;if(h.setSelected(u.node),h.alignLine.reRender(h),e.classList.contains("__freemove-container")||!e.classList.contains("__freemove-movable-node"))return;const d=e.getBoundingClientRect();let s=r.clientX-d.left,y=r.clientY-d.top,l=null,a=null,n=null;function b(p){l||(l=requestAnimationFrame(()=>{let m=p.clientX-c.left-s,A=p.clientY-c.top-y;const N=h.container.clientWidth-e.offsetWidth,T=h.container.clientHeight-e.offsetHeight;m=Math.max(0,Math.min(m,N)),A=Math.max(0,Math.min(A,T)),h.moveDelta=[a!==null?m-a:0,n!==null?A-n:0],e.style.left=g(m),e.style.top=g(A),h.alignLine.reRender(h),a=m,n=A,l=null}))}function x(){document.removeEventListener("pointermove",b),document.removeEventListener("pointerup",x),h.alignLine.clear(),h.setSelected(null),l!==null&&(cancelAnimationFrame(l),l=null)}document.addEventListener("pointermove",b),document.addEventListener("pointerup",x)}),h.svg}return M});
