(function(I,g){typeof exports=="object"&&typeof module<"u"?module.exports=g():typeof define=="function"&&define.amd?define(g):(I=typeof globalThis<"u"?globalThis:I||self,I.FreeMove=g())})(this,function(){"use strict";var St=Object.defineProperty;var mt=(I,g,H)=>g in I?St(I,g,{enumerable:!0,configurable:!0,writable:!0,value:H}):I[g]=H;var E=(I,g,H)=>mt(I,typeof g!="symbol"?g+"":g,H);const g="__freemove";class ${constructor({x:i,y:t,h:c,w:n,node:h}){E(this,"x");E(this,"y");E(this,"w");E(this,"h");E(this,"id");E(this,"node");this.x=i,this.y=t,this.h=c,this.w=n,this.node=h,this.id=h.dataset.id}isInSide(i){return i.x>=this.x&&i.x<=this.x+this.w&&i.y>=this.y&&i.y<=this.y+this.h}isIntersect(i){const t=this.x+3,c=this.y+3,n=this.x+this.w-3,h=this.y+this.h-3,u=i.x,A=i.y,y=i.x+i.w,a=i.y+i.h;return!(n<u||t>y||h<A||c>a)}getAlignLinePostion(){return{vl:this.x,vc:this.x+this.w/2,vr:this.x+this.w,ht:this.y,hc:this.y+this.h/2,hb:this.y+this.h}}static from(i){return new $({x:i.offsetLeft,y:i.offsetTop,w:i.offsetWidth,h:i.offsetHeight,node:i})}static error(i,t){}}function S(r){return typeof r=="number"?`${r}px`:String(r)}function Z(r,i,t=.1){return Math.abs(r-i)<=t}function M(r,i){return r.getElementsByClassName(i)[0]}function w(r){return document.createElementNS("http://www.w3.org/2000/svg",r)}function U(r,i){if(!r.selected)return;const t=r.container.getBoundingClientRect();r.align.reRender(r);const c=r.selected.getBoundingClientRect();let n=i.clientX-c.left,h=i.clientY-c.top,u=null;function A(a){u||(u=requestAnimationFrame(()=>{if(!r.selected)return;let s=a.clientX-t.left-n,o=a.clientY-t.top-h;const e=r.container.clientWidth-r.selected.offsetWidth,d=r.container.clientHeight-r.selected.offsetHeight;s=Math.max(0,Math.min(s,e)),o=Math.max(0,Math.min(o,d)),r.selected.style.left=S(s),r.selected.style.top=S(o),r.align.reRender(r),r.border.reRender(r),r.gap.reRender(r),u=null}))}function y(){document.removeEventListener("pointermove",A),document.removeEventListener("pointerup",y),r.align.hidden(),u!==null&&(cancelAnimationFrame(u),u=null)}document.addEventListener("pointermove",A),document.addEventListener("pointerup",y)}function Q(r,i){if(!r.selected)return;const t=r.container.getBoundingClientRect(),n=i.target.dataset.direction;if(!n)return;const h=$.from(r.selected);let u=i.clientX,A=i.clientY,y=h.w,a=h.h,s=h.x,o=h.y;const e=t.width,d=t.height;function x(l){let f=l.clientX-u,m=l.clientY-A,v=y,b=a,L=s,O=o;n.includes("right")&&(v=y+f),n.includes("left")&&(v=y-f,L=s+f),n.includes("bottom")&&(b=a+m),n.includes("top")&&(b=a-m,O=o+m),L<0&&(v+=L,L=0),O<0&&(b+=O,O=0),L+v>e&&(v=e-L),O+b>d&&(b=d-O),v=Math.max(v,10),b=Math.max(b,10),r.resize.reRender(r,v,b,n,s,o,y,a),r.border.reRender(r)}function p(){r.resize.hidden(),document.removeEventListener("pointermove",x),document.removeEventListener("pointerup",p)}document.addEventListener("pointermove",x),document.addEventListener("pointerup",p)}function J(r,i){const t=r.container.getBoundingClientRect(),c=i.clientX-t.left,n=i.clientY-t.top;function h(A){const y=A.clientX-t.left,a=A.clientY-t.top;r.selector.reRender(r,c,n,y,a)}function u(){r.selector.hiddenSelector(),r.selector.showPreview(),document.removeEventListener("pointermove",h),document.removeEventListener("pointerup",u)}document.addEventListener("pointermove",h),document.addEventListener("pointerup",u)}function K(r){r.svg.addEventListener("pointerdown",i=>{i.preventDefault();const t=i.target;if(t.classList[0].includes(`${g}-border-point-`)){const c=t.dataset.ownerId;for(let n=0;n<r.nodes.length;n++)c===r.nodes[n].dataset.ownerId&&r.setSelected(r.nodes[n]);r.selected&&Q(r,i);return}if(t.classList.contains(`${g}-svg`)){let c=null;for(const n of r.nodes){const h=$.from(n);if(h.isInSide({x:i.offsetX,y:i.offsetY})){c=h;break}}c&&c.node.classList.contains(`${g}-movable-node`)&&(r.selector.hiddenPreview(),r.setSelected(c.node),U(r,i)),c||(r.border.hidden(),J(r,i))}})}function V(r){const i=new Map;function t(a){var o;const s=[];a.toSorted((e,d)=>e.x-d.x).forEach(e=>{s.push({value:e.x,type:"min",nodeRect:e}),s.push({value:e.x+e.w,type:"max",nodeRect:e})}),s.sort((e,d)=>e.value-d.value);for(let e=0;e<s.length-1;e++){const d=[],x=[];if(s[e].type==="max"&&s[e+1].type==="min"){for(let f=0;f<=e&&s[e].value===s[e-f].value;f++)d.push(s[e-f]);for(let f=e+1;f<=s.length&&s[e+1].value===s[f].value;f++)x.push(s[f]);const p=x[0].value-d[0].value,l=d[0].nodeRect.x;if(p>0){const f=Math.min(...d.map(b=>b.nodeRect.y),...x.map(b=>b.nodeRect.y)),m=Math.max(...d.map(b=>b.nodeRect.y+b.nodeRect.h),...x.map(b=>b.nodeRect.y+b.nodeRect.h)),v={x:l,y:f,w:p,h:m-f,rect1:d.map(b=>b.nodeRect),rect2:x.map(b=>b.nodeRect)};i.has(p)?(o=i.get(p))==null||o.push(v):i.set(p,[v])}}}}function c(){i.forEach((a,s)=>{const o=new Map;a.forEach(e=>{o.has(e.x)?o.get(e.x).push(e):o.set(e.x,[e])}),o.forEach((e,d)=>{const x=[],p=[],l=new Set,f=new Set;e==null||e.forEach(b=>{x.push(b.y),p.push(b.y+b.h),b.rect1.forEach(L=>l.add(L)),b.rect2.forEach(L=>f.add(L))});const m=Math.min(...x),v=Math.max(...p);o.set(d,[{x:d,y:m,h:v-m,w:s,rect1:Array.from(l),rect2:Array.from(f)}])}),i.set(s,Array.from(o.values()).flat())})}const n=[],h=$.from(r.selected);r.nodes.forEach(a=>{const s=$.from(a);n.push(s)}),n.sort((a,s)=>a.x-s.x);const u=[],A=[];let y=1/0;return n.forEach(a=>{if(a.y>=h.y&&a.y<=h.y+h.h||a.y+a.h/2>=h.y&&a.y+a.h/2<=h.y+h.h||a.y+a.h>=h.y&&a.y+a.h<=h.y+h.h){if(h.x+h.w<a.x){const o=Math.abs(h.x+h.w-a.x);y>o&&(y=o,r.distance.x.type="right",r.distance.x.node=a.node)}if(h.x>a.x+a.w){const o=Math.abs(h.x-a.x-a.w);y>o&&(y=o,r.distance.x.type="left",r.distance.x.node=a.node)}u.push(a)}else A.push(a)}),t(u),A.forEach(a=>{u.push(a),t(u)}),c(),i}function tt(r){const i=new Map;function t(a){var o;const s=[];a.toSorted((e,d)=>e.y-d.y).forEach(e=>{s.push({value:e.y,type:"min",nodeRect:e}),s.push({value:e.y+e.h,type:"max",nodeRect:e})}),s.sort((e,d)=>e.value-d.value);for(let e=0;e<s.length-1;e++){const d=[],x=[];if(s[e].type==="max"&&s[e+1].type==="min"){for(let f=0;f<=e&&s[e].value===s[e-f].value;f++)d.push(s[e-f]);for(let f=e+1;f<=s.length&&s[e+1].value===s[f].value;f++)x.push(s[f]);const p=x[0].value-d[0].value,l=d[0].nodeRect.y;if(p>0){const f=Math.min(...d.map(b=>b.nodeRect.x),...x.map(b=>b.nodeRect.x)),m=Math.max(...d.map(b=>b.nodeRect.x+b.nodeRect.w),...x.map(b=>b.nodeRect.x+b.nodeRect.w)),v={x:f,y:l,w:m-f,h:p,rect1:d.map(b=>b.nodeRect),rect2:x.map(b=>b.nodeRect)};i.has(p)?(o=i.get(p))==null||o.push(v):i.set(p,[v])}}}}function c(){i.forEach((a,s)=>{const o=new Map;a.forEach(e=>{o.has(e.y)?o.get(e.y).push(e):o.set(e.y,[e])}),o.forEach((e,d)=>{const x=[],p=[],l=new Set,f=new Set;e==null||e.forEach(b=>{x.push(b.x),p.push(b.x+b.w),b.rect1.forEach(L=>l.add(L)),b.rect2.forEach(L=>f.add(L))});const m=Math.min(...x),v=Math.max(...p);o.set(d,[{x:m,y:d,h:s,w:v-m,rect1:Array.from(l),rect2:Array.from(f)}])}),i.set(s,Array.from(o.values()).flat())})}const n=[],h=$.from(r.selected);r.nodes.forEach(a=>{const s=$.from(a);n.push(s)}),n.sort((a,s)=>a.y-s.y);const u=[],A=[];let y=1/0;return n.forEach(a=>{if(a.x>=h.x&&a.x<=h.x+h.w||a.x+a.w/2>=h.x&&a.x+a.w/2<=h.x+h.w||a.x+a.w>=h.x&&a.x+a.w<=h.x+h.w){if(h.y+h.h<a.y){const o=Math.abs(h.y+h.h-a.y);y>o&&(y=o,r.distance.y.type="bottom",r.distance.y.node=a.node)}if(h.y>a.y+a.h){const o=Math.abs(h.y-a.y-a.h);y>o&&(y=o,r.distance.y.type="top",r.distance.y.node=a.node)}u.push(a)}else A.push(a)}),t(u),A.forEach(a=>{u.push(a),t(u)}),c(),i}class et{constructor(i){E(this,"g");this.g=w("g"),this.g.setAttribute("class",`${g}-gap`),i.append(this.g)}clear(){this.g.innerHTML=""}reRender(i){V(i),tt(i)}}const it="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let st=(r=21)=>{let i="",t=crypto.getRandomValues(new Uint8Array(r|=0));for(;r--;)i+=it[t[r]&63];return i};const rt=1,nt="#EA3",G=["vl","vc","vr","ht","hc","hb"];function ct(r,i){const t=r.container.getBoundingClientRect(),c={ht:[],hc:[],hb:[],vl:[],vc:[],vr:[]};let n=!1;function h(){const s=$.from(r.selected),o=r.nodes.filter(e=>e!==r.selected).map(e=>$.from(e));G.forEach(e=>c[e]=[]),o.forEach(e=>{if(s.isIntersect(e))return;const d=s.getAlignLinePostion();G.forEach(x=>{let p=1e4,l=1e4,f;/^h/.test(x)&&(s.x>e.x+e.w?(p=s.x+s.w,l=e.x):s.x+s.w<e.x?(p=s.x,l=e.x+e.w):(p=Math.min(s.x,e.x),l=Math.max(s.x+s.w,e.x+e.w)),[e.y,e.y+e.h/2,e.y+e.h].forEach(m=>{f=Math.abs(d[x]-m),f<=3&&c[x].push({type:x,source:p,target:l,absorbDistance:f,absorbPosition:m,nodeRects:[e]})})),/^v/.test(x)&&(s.y>e.y+e.h?(p=s.y+s.h,l=e.y):s.y+s.h<e.y?(p=s.y,l=e.y+e.h):(p=Math.min(s.y,e.y),l=Math.max(s.y+s.h,e.y+e.h)),[e.x,e.x+e.w/2,e.x+e.w].forEach(m=>{f=Math.abs(d[x]-m),f<=3&&c[x].push({type:x,source:p,target:l,absorbDistance:f,absorbPosition:m,nodeRects:[e]})}))})}),G.forEach(e=>{const d=new Map;c[e].forEach(l=>{const f=d.get(l.absorbDistance)||[];f.push(l),d.set(l.absorbDistance,f)});let x=1/0,p=0;d.forEach(l=>{l.forEach(f=>{x=Math.min(x,f.source,f.target),p=Math.max(p,f.source,f.target)})}),d.forEach(l=>{l.forEach(f=>{f.source=x,f.target=p})}),c[e]=Array.from(d.values()).flat()})}function u(s){const{absorbPosition:o,type:e}=s,d=r.selected;switch(e){case"ht":d.style.top=S(o);break;case"hc":d.style.top=S(o-parseFloat(d.style.height)/2);break;case"hb":d.style.top=S(o-parseFloat(d.style.height));break;case"vl":d.style.left=S(o);break;case"vc":d.style.left=S(o-parseFloat(d.style.width)/2);break;case"vr":d.style.left=S(o-parseFloat(d.style.width));break}h(),r.border.reRender(r)}function A(){if(!r.selected)return;const s=$.from(r.selected),o=t.width/2;Math.abs(s.x+s.w/2-o)<=3&&(r.selected.style.left=S(o-s.w/2),n=!0),h(),r.border.reRender(r)}function y(){if(!r.selected)return;const s=$.from(r.selected);if(Object.values(c).flat().forEach(e=>{const{source:d,target:x,type:p}=e,l=i[p];if(/^h/.test(p))switch(l==null||l.setAttribute("x1",String(d)),l==null||l.setAttribute("x2",String(x)),p){case"ht":l.setAttribute("y1",String(s.y)),l.setAttribute("y2",String(s.y));break;case"hc":l.setAttribute("y1",String(s.y+s.h/2)),l.setAttribute("y2",String(s.y+s.h/2));break;case"hb":l.setAttribute("y1",String(s.y+s.h)),l.setAttribute("y2",String(s.y+s.h));break}if(/^v/.test(p))switch(l==null||l.setAttribute("y1",String(d)),l==null||l.setAttribute("y2",String(x)),p){case"vl":l.setAttribute("x1",String(s.x)),l.setAttribute("x2",String(s.x));break;case"vc":l.setAttribute("x1",String(s.x+s.w/2)),l.setAttribute("x2",String(s.x+s.w/2));break;case"vr":l.setAttribute("x1",String(s.x+s.w)),l.setAttribute("x2",String(s.x+s.w));break}l==null||l.setAttribute("style","display: 'block")}),n){const e=i.vertical;e.setAttribute("x1",String(t.width/2)),e.setAttribute("y1",String(0)),e.setAttribute("x2",String(t.width/2)),e.setAttribute("y2",String(t.height)),e==null||e.setAttribute("style","display: 'block")}}h(),Object.values(c).flat().forEach(s=>{u(s)}),A();let a=1/0;G.forEach(s=>{c[s].forEach(o=>{o.absorbDistance<a&&(a=o.absorbDistance)})}),G.forEach(s=>{c[s]=c[s].filter(o=>Z(o.absorbDistance,a,.01))}),y()}class at{constructor(i){E(this,"g");E(this,"lines");this.g=w("g"),this.g.setAttribute("class",`${g}-align`),this.lines={},[...G,"vertical"].forEach(t=>{const c=w("line");c.setAttribute("class",`${g}-align-${t}`),c.setAttribute("stroke",nt),c.setAttribute("stroke-width",String(rt)),c.style.display="none",this.g.append(c),this.lines[t]=c}),i.append(this.g)}hidden(){Object.values(this.lines).forEach(i=>{i.style.display="none"})}reRender(i){i.selected&&(this.hidden(),ct(i,this.lines))}}const z=1,P="#000",C=6,W=["left","top","right","bottom"],F=["left-top","top","right-top","right","right-bottom","bottom","left-bottom","left"],ht=["nwse-resize","ns-resize","nesw-resize","ew-resize","nwse-resize","ns-resize","nesw-resize","ew-resize"];function ot(){const r=[],i=[];return W.forEach(t=>{const c=w("line");c.setAttribute("class",`${g}-border-line-${t}`),c.setAttribute("stroke",P),c.setAttribute("stroke-width",S(z)),i.push(c)}),F.forEach((t,c)=>{const n=w("rect");n.setAttribute("class",`${g}-border-point-${t}`),n.setAttribute("fill","white"),n.setAttribute("stroke",P),n.setAttribute("stroke-width",S(z)),n.setAttribute("width",S(C)),n.setAttribute("height",S(C)),n.setAttribute("style",`cursor: ${ht[c]}`),n.setAttribute("data-direction",t),r.push(n)}),[r,i]}function lt(r,i){const t=$.from(i);W.forEach(c=>{const n=M(r,`${g}-border-line-${c}`);switch(c){case"left":n.setAttribute("x1",String(t.x)),n.setAttribute("y1",String(t.y-z/2)),n.setAttribute("x2",String(t.x)),n.setAttribute("y2",String(t.y+t.h+z/2));break;case"right":n.setAttribute("x1",String(t.x+t.w)),n.setAttribute("y1",String(t.y-z/2)),n.setAttribute("x2",String(t.x+t.w)),n.setAttribute("y2",String(t.y+t.h+z/2));break;case"top":n.setAttribute("x1",String(t.x-z/2)),n.setAttribute("y1",String(t.y)),n.setAttribute("x2",String(t.x+t.w+z/2)),n.setAttribute("y2",String(t.y));break;case"bottom":n.setAttribute("x1",String(t.x-z/2)),n.setAttribute("y1",String(t.y+t.h)),n.setAttribute("x2",String(t.x+t.w+z/2)),n.setAttribute("y2",String(t.y+t.h));break}}),F.forEach((c,n)=>{const h=M(r,`${g}-border-point-${c}`);h.setAttribute("data-owner-id",i.dataset.id);const u=C/2;switch(c){case"left-top":h.setAttribute("x",String(t.x-u)),h.setAttribute("y",String(t.y-u));break;case"top":h.setAttribute("x",String(t.x+t.w/2-u)),h.setAttribute("y",String(t.y-u));break;case"right-top":h.setAttribute("x",String(t.x+t.w-u)),h.setAttribute("y",String(t.y-u));break;case"right":h.setAttribute("x",String(t.x+t.w-u)),h.setAttribute("y",String(t.y+t.h/2-u));break;case"right-bottom":h.setAttribute("x",String(t.x+t.w-u)),h.setAttribute("y",String(t.y+t.h-u));break;case"bottom":h.setAttribute("x",String(t.x+t.w/2-u)),h.setAttribute("y",String(t.y+t.h-u));break;case"left-bottom":h.setAttribute("x",String(t.x-u)),h.setAttribute("y",String(t.y+t.h-u));break;case"left":h.setAttribute("x",String(t.x-u)),h.setAttribute("y",String(t.y+t.h/2-u));break}})}class ut{constructor(i){E(this,"g");E(this,"points");E(this,"lines");this.g=w("g"),this.g.setAttribute("class",`${g}-border`),i.append(this.g);const[t,c]=ot();this.points=t,this.lines=c,this.g.append(...c,...t),this.g.style.display="none"}hidden(){this.g.style.display="none"}reRender(i){i.selected&&(this.g.style.display="block",lt(this.g,i.selected))}}const T=1,B="#2A63F4",D=8,N=10,j=10;function X(r){const i=r.nodes.map(n=>$.from(n)),t=new Map,c=new Map;return i.forEach(n=>{var A,y;const h={type:"width",nodeRect:n},u={type:"height",nodeRect:n};t.has(n.w)?(A=t.get(n.w))==null||A.push(h):t.set(n.w,[h]),c.has(n.h)?(y=c.get(n.h))==null||y.push(u):c.set(n.h,[u])}),{widthMap:t,heightMap:c}}function dt(r){r.nodes.forEach(i=>{const t=$.from(i),c=r.resize.g.querySelector(`[data-ower-id="${t.id}"]`),n=M(c,`${g}-resize-line-group-width-line`),h=M(c,`${g}-resize-line-group-width-line-start`),u=M(c,`${g}-resize-line-group-width-line-end`),A=M(c,`${g}-resize-line-group-width-text`),y=M(c,`${g}-resize-line-group-height-line`),a=M(c,`${g}-resize-line-group-height-text`),s=M(c,`${g}-resize-line-group-height-line-start`),o=M(c,`${g}-resize-line-group-height-line-end`);n.setAttribute("x1",String(t.x)),n.setAttribute("y1",String(t.y-D)),n.setAttribute("x2",String(t.x+t.w)),n.setAttribute("y2",String(t.y-D)),h.setAttribute("x",String(t.x-T/2)),h.setAttribute("y",String(t.y-D-N/2)),h.setAttribute("width",String(T)),h.setAttribute("height",String(N)),h.setAttribute("fill",String(B)),u.setAttribute("x",String(t.x+t.w-T/2)),u.setAttribute("y",String(t.y-D-N/2)),u.setAttribute("width",String(T)),u.setAttribute("height",String(N)),u.setAttribute("fill",String(B)),A.textContent=`${t.w}`,A.setAttribute("x",String(t.x+t.w/2)),A.setAttribute("y",String(t.y-D-8)),A.setAttribute("fill",String(B)),A.setAttribute("font-size",String(j)),A.setAttribute("text-anchor","middle"),A.setAttribute("alignment-baseline","middle"),y.setAttribute("x1",String(t.x-D)),y.setAttribute("y1",String(t.y)),y.setAttribute("x2",String(t.x-D)),y.setAttribute("y2",String(t.y+t.h)),s.setAttribute("x",String(t.x-D-N/2)),s.setAttribute("y",String(t.y-T/2)),s.setAttribute("width",String(N)),s.setAttribute("height",String(T)),s.setAttribute("fill",String(B)),o.setAttribute("x",String(t.x-D-N/2)),o.setAttribute("y",String(t.y+t.h-T/2)),o.setAttribute("width",String(N)),o.setAttribute("height",String(T)),o.setAttribute("fill",String(B)),a.textContent=`${t.h}`,a.setAttribute("x",String(t.x-D-8)),a.setAttribute("y",String(t.y+t.h/2)),a.setAttribute("fill",String(B)),a.setAttribute("font-size",String(j)),a.setAttribute("text-anchor","middle"),a.setAttribute("alignment-baseline","middle"),a.setAttribute("transform",`rotate(-90 ${t.x-D-8} ${t.y+t.h/2})`),[n,y].forEach(e=>{e.setAttribute("stroke",B),e.setAttribute("stroke-width",String(T))})})}class gt{constructor(i,t){E(this,"g");E(this,"lines");this.g=w("g"),this.g.setAttribute("class",`${g}-resize`);const c=[];t.forEach(n=>{const h=$.from(n),u=w("g");u.setAttribute("class",`${g}-resize-line`),u.setAttribute("data-ower-id",h.id);const A=w("g");A.setAttribute("class",`${g}-resize-line-group-width`);const y=w("line");y.setAttribute("class",`${g}-resize-line-group-width-line`);const a=w("text");a.setAttribute("class",`${g}-resize-line-group-width-text`);const s=w("rect");s.setAttribute("class",`${g}-resize-line-group-width-line-start`);const o=w("rect");o.setAttribute("class",`${g}-resize-line-group-width-line-end`),A.append(y,a,s,o);const e=w("g");e.setAttribute("class",`${g}-resize-line-group-height`);const d=w("line");d.setAttribute("class",`${g}-resize-line-group-height-line`);const x=w("text");x.setAttribute("class",`${g}-resize-line-group-height-text`);const p=w("rect");p.setAttribute("class",`${g}-resize-line-group-height-line-start`);const l=w("rect");l.setAttribute("class",`${g}-resize-line-group-height-line-end`),e.append(d,x,p,l),u.append(A,e),c.push(u)}),this.lines=c,this.g.append(...this.lines),i.append(this.g),this.hidden()}hidden(){this.lines.forEach(i=>{Array.from(i.children).forEach(t=>{t.style.display="none"})})}reRender(i,t,c,n,h,u,A,y){var Y,q;if(!i.selected)return;this.hidden();const{widthMap:a,heightMap:s}=X(i),o=[],e=[];a.forEach((k,_)=>{var R;k.length===1&&k[0].nodeRect.id===((R=i.selected)==null?void 0:R.dataset.id)||Math.abs(t-_)<=3&&o.push(_)}),s.forEach((k,_)=>{var R;k.length===1&&k[0].nodeRect.id===((R=i.selected)==null?void 0:R.dataset.id)||Math.abs(c-_)<=3&&e.push(_)});const d=o.length===0?t:Math.max(...o),x=e.length===0?c:Math.max(...e),p=Math.max(d,10),l=Math.max(x,10);if(n.includes("left")){const k=h+A;i.selected.style.left=S(k-p)}else i.selected.style.left=S(h);if(i.selected.style.width=S(p),n.includes("top")){const k=u+y;i.selected.style.top=S(k-l)}else i.selected.style.top=S(u);i.selected.style.height=S(l);const f=parseFloat(i.selected.style.width),m=parseFloat(i.selected.style.height),{widthMap:v,heightMap:b}=X(i);(Y=v.get(f))==null||Y.forEach(k=>{const _=this.g.querySelector(`[data-ower-id="${k.nodeRect.id}"]`),R=M(_,`${g}-resize-line-group-width`);R.style.display="block"}),(q=b.get(m))==null||q.forEach(k=>{const _=this.g.querySelector(`[data-ower-id="${k.nodeRect.id}"]`),R=M(_,`${g}-resize-line-group-height`);R.style.display="block"});const L=this.g.querySelector(`[data-ower-id="${i.selected.dataset.id}"]`),O=M(L,`${g}-resize-line-group-width`),wt=M(L,`${g}-resize-line-group-height`);wt.style.display="block",O.style.display="block",dt(i),i.border.reRender(i)}}function ft(r,i,t,c){return t-r>0&&c-i>0?"4":t-r<0&&c-i>0?"3":t-r<0&&c-i<0?"2":t-r>0&&c-i<0?"1":"0"}class bt{constructor(i){E(this,"g");E(this,"selectorRect");E(this,"previewRect");E(this,"selectedGroup",[]);this.g=w("g"),this.g.setAttribute("class",`${g}-selector`),this.selectorRect=w("rect"),this.selectorRect.setAttribute("class",`${g}-selector-rect`),this.selectorRect.setAttribute("stroke","#919191"),this.selectorRect.setAttribute("stroke-width","1px"),this.selectorRect.setAttribute("fill","rgba(255,255,255,0.3)"),this.selectorRect.style.display="none",this.previewRect=w("rect"),this.previewRect.setAttribute("class",`${g}-selector-preview`),this.previewRect.setAttribute("stroke","#000"),this.previewRect.setAttribute("stroke-width","1px"),this.previewRect.setAttribute("fill","transparent"),this.previewRect.style.display="none",this.g.append(this.selectorRect,this.previewRect),i.append(this.g)}hiddenSelector(){this.selectorRect.style.display="none"}showSelector(){this.selectorRect.style.display="block"}hiddenPreview(){this.previewRect.style.display="none"}showPreview(){this.previewRect.style.display="block"}reRender(i,t,c,n,h){this.showSelector(),this.hiddenPreview(),this.selectedGroup=[];const u=ft(t,c,n,h),A=Math.abs(t-n),y=Math.abs(c-h);this.selectorRect.setAttribute("width",String(A)),this.selectorRect.setAttribute("height",String(y));let a=t,s=c;switch(u){case"3":{a=a-A;break}case"2":{a=a-A,s=s-y;break}case"1":{s=s-y;break}}this.selectorRect.setAttribute("x",String(a)),this.selectorRect.setAttribute("y",String(s)),i.nodes.forEach(f=>{$.from(f).isIntersect({x:a,y:s,w:A,h:y})&&this.selectedGroup.push(f)});const o=[],e=[],d=[],x=[];this.selectedGroup.forEach(f=>{const{x:m,y:v,w:b,h:L}=$.from(f);o.push(m),e.push(v),d.push(m+b),x.push(v+L)});const p=Math.min(...o),l=Math.min(...e);this.previewRect.setAttribute("x",String(o.length?p:0)),this.previewRect.setAttribute("y",String(e.length?l:0)),this.previewRect.setAttribute("width",String(d.length?Math.max(...d)-p:0)),this.previewRect.setAttribute("height",String(x.length?Math.max(...x)-l:0))}}const pt=["left","right","top","bottom"];class yt{constructor(i){E(this,"g");E(this,"distanceGroups");E(this,"x");E(this,"y");this.g=w("g"),this.g.setAttribute("class",`${g}-distance`),this.distanceGroups={};const t=c=>{const n=w("g");n.setAttribute("class",`${g}-distance-${c}`);const h=w("line");h.setAttribute("class",`${g}-distance-${c}-line`);const u=w("text");u.setAttribute("class",`${g}-distance-${c}-text`);const A=w("rect");A.setAttribute("class",`${g}-distance-${c}-text-bg`);const y=w("rect");y.setAttribute("class",`${g}-distance-${c}-line-start`);const a=w("rect");return a.setAttribute("class",`${g}-distance-${c}-line-end`),n.appendChild(h),n.appendChild(u),n.appendChild(A),n.appendChild(y),n.appendChild(a),n};this.x={type:"left",node:null},this.y={type:"top",node:null},pt.forEach(c=>{const n=t(c);this.distanceGroups[c]=n}),this.g.append(...Object.values(this.distanceGroups)),i.append(this.g)}hidden(){Object.values(this.distanceGroups).forEach(i=>{i.style.display="none"})}reRender(i){}}const xt=(r,i)=>{const t=w("svg");t.setAttribute("class",`${g}-svg`);const c=r.getBoundingClientRect();return t.setAttribute("width",S(c.width)),t.setAttribute("height",S(c.height)),t.style="position: absolute; inset: 0;",r.className+=` ${g}-container`,i.forEach(n=>{n.className+=` ${g}-movable-node`,n.setAttribute("data-id",st()),/%$/.test(n.style.x)&&(n.style.x=S(c.width*parseInt(n.style.x)/100)),/%$/.test(n.style.y)&&(n.style.y=S(c.height*parseInt(n.style.y)/100)),/%$/.test(n.style.width)&&(n.style.width=S(c.width*parseInt(n.style.width)/100)),/%$/.test(n.style.height)&&(n.style.height=S(c.height*parseInt(n.style.height)/100))}),{container:r,nodes:i,svg:t,selected:null,setSelected(n){if(this.selected=n,!n){this.border.hidden();return}this.border.reRender(this)},align:new at(t),border:new ut(t),resize:new gt(t,i),selector:new bt(t),gap:new et(t),distance:new yt(t)}};class At{constructor(i,t){E(this,"store");this.store=xt(i,t),K(this.store)}mount(){this.store.container.append(this.store.svg)}unmount(){this.store.svg.remove()}align(i){const{selected:t,container:c}=this.store;if(!t)return;const n=c.getBoundingClientRect(),h=$.from(t);switch(i){case"start":t.style.left=S(0);break;case"center":t.style.left=S(n.width/2-h.w/2);break;case"end":t.style.left=S(n.width-h.w);break}}}return At});
