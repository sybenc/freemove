(function(y,d){typeof exports=="object"&&typeof module<"u"?module.exports=d():typeof define=="function"&&define.amd?define(d):(y=typeof globalThis<"u"?globalThis:y||self,y.createFreeMove=d())})(this,function(){"use strict";var U=Object.defineProperty;var V=(y,d,m)=>d in y?U(y,d,{enumerable:!0,configurable:!0,writable:!0,value:m}):y[d]=m;var w=(y,d,m)=>V(y,typeof d!="symbol"?d+"":d,m);const d="__freemove";class A{constructor({x:t,y:o,h:c,w:r,node:e}){w(this,"x");w(this,"y");w(this,"w");w(this,"h");w(this,"node");this.x=t,this.y=o,this.h=c,this.w=r,this.node=e}isInSide(t){return t.x>=this.x&&t.x<=this.x+this.w&&t.y>=this.y&&t.y<=this.y+this.h}isEquel(t){return this.h===t.h&&this.w===t.w&&this.x===t.x&&this.y===t.y&&this.node===t.node}isIntersect(t){const o=this.x+3,c=this.y+3,r=this.x+this.w-3,e=this.y+this.h-3,l=t.x,s=t.y,g=t.x+t.w,a=t.y+t.h;return!(r<l||o>g||e<s||c>a)}getAlignLinePostion(){return{vl:this.x,vc:this.x+this.w/2,vr:this.x+this.w,ht:this.y,hc:this.y+this.h/2,hb:this.y+this.h}}static from(t){return new A({x:t.offsetLeft,y:t.offsetTop,w:t.offsetWidth,h:t.offsetHeight,node:t})}}function u(i){return typeof i=="number"?`${i}px`:String(i)}function N(i,t){if(!i.selected)return;const o=i.container.getBoundingClientRect();i.alignLine.reRender(i);const c=i.selected.getBoundingClientRect();let r=t.clientX-c.left,e=t.clientY-c.top,l=null,s=null,g=null;function a(n){l||(l=requestAnimationFrame(()=>{if(!i.selected)return;let b=n.clientX-o.left-r,f=n.clientY-o.top-e;const v=i.container.clientWidth-i.selected.offsetWidth,S=i.container.clientHeight-i.selected.offsetHeight;b=Math.max(0,Math.min(b,v)),f=Math.max(0,Math.min(f,S)),i.moveDelta=[s!==null?b-s:0,g!==null?f-g:0],i.selected.style.left=u(b),i.selected.style.top=u(f),i.alignLine.reRender(i),i.seletedBorder.reRender(i),s=b,g=f,l=null}))}function h(){document.removeEventListener("pointermove",a),document.removeEventListener("pointerup",h),i.alignLine.clear(),l!==null&&(cancelAnimationFrame(l),l=null)}document.addEventListener("pointermove",a),document.addEventListener("pointerup",h)}function $(i,t){if(!i.selected)return;const o=i.container.getBoundingClientRect(),r=t.target.dataset.direction;if(!r)return;const e=i.selected.getBoundingClientRect();let l=t.clientX,s=t.clientY,g=e.width,a=e.height,h=e.left-o.left,n=e.top-o.top;function b(v){let S=v.clientX-l,L=v.clientY-s,R=g,k=a,D=h,I=n;r.includes("right")&&(R=Math.max(10,g+S)),r.includes("left")&&(R=Math.max(10,g-S),D=h+S),r.includes("bottom")&&(k=Math.max(10,a+L)),r.includes("top")&&(k=Math.max(10,a-L),I=n+L),i.selected.style.width=u(R),i.selected.style.height=u(k),i.selected.style.left=u(D),i.selected.style.top=u(I),i.seletedBorder.reRender(i)}function f(){document.removeEventListener("pointermove",b),document.removeEventListener("pointerup",f)}document.addEventListener("pointermove",b),document.addEventListener("pointerup",f)}function M(i){i.svg.addEventListener("pointerdown",t=>{t.preventDefault();const o=t.target;if(o.classList[0].includes(`${d}-selected-border-point-`)){const c=o.dataset.ownerId;for(let r=0;r<i.nodes.length;r++)c===i.nodes[r].dataset.ownerId&&i.setSelected(i.nodes[r]);i.selected&&$(i,t);return}if(console.log(1111),o.classList.contains(`${d}-svg`)){let c=null;for(const r of i.nodes){const e=A.from(r);if(e.isInSide({x:t.offsetX,y:t.offsetY})){c=e;break}}c&&c.node.classList.contains(`${d}-movable-node`)&&(i.setSelected(c.node),N(i,t))}})}const _="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let C=(i=21)=>{let t="",o=crypto.getRandomValues(new Uint8Array(i|=0));for(;i--;)t+=_[o[i]&63];return t};const P=1,F="#EA3",p=["vl","vc","vr","ht","hc","hb"];function O(i){const t=[];return p.forEach(o=>{const c=document.createElementNS("http://www.w3.org/2000/svg","line");c.setAttribute("class",`${d}-alignLine-${o}`),c.setAttribute("stroke",F),c.setAttribute("stroke-width",String(P)),c.style.display="none",t.push(c)}),t}function X(i){const t={ht:[],hc:[],hb:[],vl:[],vc:[],vr:[]};function o(){let e=A.from(i.selected);t.hb=[],t.hc=[],t.ht=[],t.vc=[],t.vl=[],t.vr=[],i.nodes.forEach(l=>{const s=A.from(l);if(e.isIntersect(s))return;const g=e.getAlignLinePostion();p.forEach(a=>{let h=1e4,n=1e4,b;/^h/.test(a)&&(e.x>s.x+s.w?(h=e.x+e.w,n=s.x):e.x+e.w<s.x?(h=e.x,n=s.x+s.w):(h=Math.min(e.x,s.x),n=Math.max(e.x+e.w,s.x+s.w)),[s.y,s.y+s.h/2,s.y+s.h].forEach(f=>{b=Math.abs(g[a]-f),b<=3&&t[a].push({type:a,source:h,target:n,absorbDistance:b,absorbPosition:f,nodeRects:[s]})})),/^v/.test(a)&&(e.y>s.y+s.h?(h=e.y+e.h,n=s.y):e.y+e.h<s.y?(h=e.y,n=s.y+s.h):(h=Math.min(e.y,s.y),n=Math.max(e.y+e.h,s.y+s.h)),[s.x,s.x+s.w/2,s.x+s.w].forEach(f=>{b=Math.abs(g[a]-f),b<=3&&t[a].push({type:a,source:h,target:n,absorbDistance:b,absorbPosition:f,nodeRects:[s]})}))})})}function c(e){if(!i.selected||!e)return;const{absorbPosition:l,type:s}=e;switch(s){case"ht":i.selected.style.top=u(l);break;case"hc":i.selected.style.top=u(l-parseFloat(i.selected.style.height)/2);break;case"hb":i.selected.style.top=u(l-parseFloat(i.selected.style.height));break;case"vl":i.selected.style.left=u(l);break;case"vc":i.selected.style.left=u(l-parseFloat(i.selected.style.width)/2);break;case"vr":i.selected.style.left=u(l-parseFloat(i.selected.style.width));break}o(),i.seletedBorder.reRender(i);let g=1/0;p.forEach(a=>{t[a].forEach(h=>{h.absorbDistance<g&&(g=h.absorbDistance)})}),p.forEach(a=>{t[a].forEach(h=>{h.absorbDistance-g>.1&&(t[a]=[])})})}function r(){if(!i.selected)return;const e=A.from(i.selected);Object.values(t).flat().forEach(s=>{const{source:g,target:a,type:h}=s,n=i.alignLine.g.getElementsByClassName(`${d}-alignLine-${h}`)[0];if(/^h/.test(h))switch(n==null||n.setAttribute("x1",String(g)),n==null||n.setAttribute("x2",String(a)),h){case"ht":n.setAttribute("y1",String(e.y)),n.setAttribute("y2",String(e.y));break;case"hc":n.setAttribute("y1",String(e.y+e.h/2)),n.setAttribute("y2",String(e.y+e.h/2));break;case"hb":n.setAttribute("y1",String(e.y+e.h)),n.setAttribute("y2",String(e.y+e.h));break}if(/^v/.test(h))switch(n==null||n.setAttribute("y1",String(g)),n==null||n.setAttribute("y2",String(a)),h){case"vl":n.setAttribute("x1",String(e.x)),n.setAttribute("x2",String(e.x));break;case"vc":n.setAttribute("x1",String(e.x+e.w/2)),n.setAttribute("x2",String(e.x+e.w/2));break;case"vr":n.setAttribute("x1",String(e.x+e.w)),n.setAttribute("x2",String(e.x+e.w));break}n==null||n.setAttribute("style","display: 'block")})}o(),[...t.ht,...t.hc,...t.hb].forEach(e=>{c(e)}),[...t.vl,...t.vc,...t.vr].forEach(e=>{c(e)}),r()}class H{constructor(t){w(this,"g");this.g=document.createElementNS("http://www.w3.org/2000/svg","g"),this.g.setAttribute("class",`${d}-alignLine`),t.append(this.g)}clear(){this.g.innerHTML=""}reRender(t){t.selected&&(this.clear(),this.g.append(...O()),X(t))}}const x=1,B="#000",E=6,Y=["left","top","right","bottom"],z=["left-top","top","right-top","right","right-bottom","bottom","left-bottom","left"],W=["nwse-resize","ns-resize","nesw-resize","ew-resize","nwse-resize","ns-resize","nesw-resize","ew-resize"];function T(i){const t=A.from(i.selected),o=[];return Y.forEach((c,r)=>{const e=document.createElementNS("http://www.w3.org/2000/svg","line");switch(e.setAttribute("class",`${d}-selected-border-line-${c}`),e.setAttribute("stroke",B),e.setAttribute("stroke-width",u(x)),c){case"left":e.setAttribute("x1",String(t.x)),e.setAttribute("y1",String(t.y-x/2)),e.setAttribute("x2",String(t.x)),e.setAttribute("y2",String(t.y+t.h+x/2));break;case"right":e.setAttribute("x1",String(t.x+t.w)),e.setAttribute("y1",String(t.y-x/2)),e.setAttribute("x2",String(t.x+t.w)),e.setAttribute("y2",String(t.y+t.h+x/2));break;case"top":e.setAttribute("x1",String(t.x-x/2)),e.setAttribute("y1",String(t.y)),e.setAttribute("x2",String(t.x+t.w+x/2)),e.setAttribute("y2",String(t.y));break;case"bottom":e.setAttribute("x1",String(t.x-x/2)),e.setAttribute("y1",String(t.y+t.h)),e.setAttribute("x2",String(t.x+t.w+x/2)),e.setAttribute("y2",String(t.y+t.h));break}o.push(e)}),z.forEach((c,r)=>{const e=document.createElementNS("http://www.w3.org/2000/svg","rect");e.setAttribute("class",`${d}-selected-border-point-${c}`),e.setAttribute("fill","white"),e.setAttribute("stroke",B),e.setAttribute("stroke-width",u(x)),e.setAttribute("width",u(E)),e.setAttribute("height",u(E)),e.setAttribute("style",`cursor: ${W[r]}`),e.setAttribute("data-direction",c),e.setAttribute("data-owner-id",i.selected.dataset.id);const l=E/2;switch(c){case"left-top":e.setAttribute("x",String(t.x-l)),e.setAttribute("y",String(t.y-l));break;case"top":e.setAttribute("x",String(t.x+t.w/2-l)),e.setAttribute("y",String(t.y-l));break;case"right-top":e.setAttribute("x",String(t.x+t.w-l)),e.setAttribute("y",String(t.y-l));break;case"right":e.setAttribute("x",String(t.x+t.w-l)),e.setAttribute("y",String(t.y+t.h/2-l));break;case"right-bottom":e.setAttribute("x",String(t.x+t.w-l)),e.setAttribute("y",String(t.y+t.h-l));break;case"bottom":e.setAttribute("x",String(t.x+t.w/2-l)),e.setAttribute("y",String(t.y+t.h-l));break;case"left-bottom":e.setAttribute("x",String(t.x-l)),e.setAttribute("y",String(t.y+t.h-l));break;case"left":e.setAttribute("x",String(t.x-l)),e.setAttribute("y",String(t.y+t.h/2-l));break}o.push(e)}),o}class G{constructor(t){w(this,"g");this.g=document.createElementNS("http://www.w3.org/2000/svg","g"),this.g.setAttribute("class",`${d}-seleted-border`),t.append(this.g)}clear(){this.g.innerHTML=""}reRender(t){t.selected&&(this.clear(),this.g.append(...T(t)),T(t))}}const j=(i,t)=>{const o=document.createElementNS("http://www.w3.org/2000/svg","svg");o.setAttribute("class",`${d}-svg`);const c=i.getBoundingClientRect();return o.setAttribute("width",u(c.width)),o.setAttribute("height",u(c.height)),o.style="position: absolute; inset: 0;",i.className+=` ${d}-container`,t.forEach(r=>{r.className+=` ${d}-movable-node`,r.setAttribute("data-id",C()),/%$/.test(r.style.x)&&(r.style.x=u(c.width*parseInt(r.style.x)/100)),/%$/.test(r.style.y)&&(r.style.y=u(c.height*parseInt(r.style.y)/100)),/%$/.test(r.style.width)&&(r.style.width=u(c.width*parseInt(r.style.width)/100)),/%$/.test(r.style.height)&&(r.style.height=u(c.height*parseInt(r.style.height)/100))}),{container:i,nodes:t,svg:o,selected:null,alignLine:new H(o),seletedBorder:new G(o),moveDelta:[0,0],setSelected(r){if(this.selected=r,!r){this.seletedBorder.clear();return}this.seletedBorder.reRender(this)}}};function q(i,t){const o=j(i,t);return M(o),o.svg}return q});
