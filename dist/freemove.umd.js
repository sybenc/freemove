(function(y,u){typeof exports=="object"&&typeof module<"u"?module.exports=u():typeof define=="function"&&define.amd?define(u):(y=typeof globalThis<"u"?globalThis:y||self,y.createFreeMove=u())})(this,function(){"use strict";var U=Object.defineProperty;var V=(y,u,m)=>u in y?U(y,u,{enumerable:!0,configurable:!0,writable:!0,value:m}):y[u]=m;var w=(y,u,m)=>V(y,typeof u!="symbol"?u+"":u,m);const u="__freemove";class A{constructor({x:t,y:a,h:l,w:r,node:e}){w(this,"x");w(this,"y");w(this,"w");w(this,"h");w(this,"node");this.x=t,this.y=a,this.h=l,this.w=r,this.node=e}isInSide(t){return t.x>=this.x&&t.x<=this.x+this.w&&t.y>=this.y&&t.y<=this.y+this.h}isEquel(t){return this.h===t.h&&this.w===t.w&&this.x===t.x&&this.y===t.y&&this.node===t.node}isIntersect(t){const a=this.x+3,l=this.y+3,r=this.x+this.w-3,e=this.y+this.h-3,c=t.x,n=t.y,d=t.x+t.w,h=t.y+t.h;return!(r<c||a>d||e<n||l>h)}getAlignLinePostion(){return{vl:this.x,vc:this.x+this.w/2,vr:this.x+this.w,ht:this.y,hc:this.y+this.h/2,hb:this.y+this.h}}static from(t){return new A({x:t.offsetLeft,y:t.offsetTop,w:t.offsetWidth,h:t.offsetHeight,node:t})}}function f(s){return typeof s=="number"?`${s}px`:String(s)}function I(s,t){if(!s.selected)return;const a=s.container.getBoundingClientRect();s.alignLine.reRender(s);const l=s.selected.getBoundingClientRect();let r=t.clientX-l.left,e=t.clientY-l.top,c=null,n=null,d=null;function h(i){c||(c=requestAnimationFrame(()=>{if(!s.selected)return;let g=i.clientX-a.left-r,b=i.clientY-a.top-e;const E=s.container.clientWidth-s.selected.offsetWidth,p=s.container.clientHeight-s.selected.offsetHeight;g=Math.max(0,Math.min(g,E)),b=Math.max(0,Math.min(b,p)),s.moveDelta=[n!==null?g-n:0,d!==null?b-d:0],s.selected.style.left=f(g),s.selected.style.top=f(b),s.alignLine.reRender(s),s.seletedBorder.reRender(s),n=g,d=b,c=null}))}function o(){document.removeEventListener("pointermove",h),document.removeEventListener("pointerup",o),s.alignLine.clear(),c!==null&&(cancelAnimationFrame(c),c=null)}document.addEventListener("pointermove",h),document.addEventListener("pointerup",o)}function N(s,t){if(!s.selected)return;const a=s.container.getBoundingClientRect(),r=t.target.dataset.direction;if(!r)return;const e=s.selected.getBoundingClientRect();let c=t.clientX,n=t.clientY,d=e.width,h=e.height,o=e.left-a.left,i=e.top-a.top;function g(E){let p=E.clientX-c,L=E.clientY-n,R=d,k=h,D=o,M=i;r.includes("right")&&(R=Math.max(10,d+p)),r.includes("left")&&(R=Math.max(10,d-p),D=o+p),r.includes("bottom")&&(k=Math.max(10,h+L)),r.includes("top")&&(k=Math.max(10,h-L),M=i+L),s.selected.style.width=f(R),s.selected.style.height=f(k),s.selected.style.left=f(D),s.selected.style.top=f(M),s.seletedBorder.reRender(s)}function b(){document.removeEventListener("pointermove",g),document.removeEventListener("pointerup",b)}document.addEventListener("pointermove",g),document.addEventListener("pointerup",b)}function $(s){s.svg.addEventListener("pointerdown",t=>{t.preventDefault();const a=t.target;if(a.classList[0].includes(`${u}-selected-border-point-`)){const l=a.dataset.ownerId;for(let r=0;r<s.nodes.length;r++)l===s.nodes[r].dataset.ownerId&&s.setSelected(s.nodes[r]);s.selected&&N(s,t);return}if(console.log(1111),a.classList.contains(`${u}-svg`)){let l=null;for(const r of s.nodes){const e=A.from(r);if(e.isInSide({x:t.offsetX,y:t.offsetY})){l=e;break}}l&&l.node.classList.contains(`${u}-movable-node`)&&(s.setSelected(l.node),I(s,t))}})}const _="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let C=(s=21)=>{let t="",a=crypto.getRandomValues(new Uint8Array(s|=0));for(;s--;)t+=_[a[s]&63];return t};const O=1,P="#EA3",S=["vl","vc","vr","ht","hc","hb"];function F(s){const t=[];return S.forEach(a=>{const l=document.createElementNS("http://www.w3.org/2000/svg","line");l.setAttribute("class",`${u}-alignLine-${a}`),l.setAttribute("stroke",P),l.setAttribute("stroke-width",String(O)),l.style.display="none",t.push(l)}),t}function X(s){const t={ht:[],hc:[],hb:[],vl:[],vc:[],vr:[]};function a(){let e=A.from(s.selected);t.hb=[],t.hc=[],t.ht=[],t.vc=[],t.vl=[],t.vr=[],s.nodes.forEach(c=>{const n=A.from(c);if(e.isIntersect(n))return;const d=e.getAlignLinePostion();S.forEach(h=>{let o=1e4,i=1e4,g;/^h/.test(h)&&(e.x>n.x+n.w?(o=e.x+e.w,i=n.x):e.x+e.w<n.x?(o=e.x,i=n.x+n.w):(o=Math.min(e.x,n.x),i=Math.max(e.x+e.w,n.x+n.w)),[n.y,n.y+n.h/2,n.y+n.h].forEach(b=>{g=Math.abs(d[h]-b),g<=3&&t[h].push({type:h,source:o,target:i,absorbDistance:g,absorbPosition:b,nodeRects:[n]})})),/^v/.test(h)&&(e.y>n.y+n.h?(o=e.y+e.h,i=n.y):e.y+e.h<n.y?(o=e.y,i=n.y+n.h):(o=Math.min(e.y,n.y),i=Math.max(e.y+e.h,n.y+n.h)),[n.x,n.x+n.w/2,n.x+n.w].forEach(b=>{g=Math.abs(d[h]-b),g<=3&&t[h].push({type:h,source:o,target:i,absorbDistance:g,absorbPosition:b,nodeRects:[n]})}))})}),S.forEach(c=>{const n=new Map;t[c].forEach(o=>{var i;n.has(o.absorbDistance)?(i=n.get(o.absorbDistance))==null||i.push(o):n.set(o.absorbDistance,[o])});let d=1/0,h=0;n.forEach(o=>{o.forEach(i=>{d=Math.min(i.source,d),d=Math.min(i.target,d),h=Math.max(i.source,h),h=Math.max(i.target,h)})}),n.forEach(o=>{o.forEach(i=>{i.source=d,i.target=h})}),t[c]=Array.from(n.values()).flat()})}function l(e){if(!s.selected||!e)return;const{absorbPosition:c,type:n}=e;switch(n){case"ht":s.selected.style.top=f(c);break;case"hc":s.selected.style.top=f(c-parseFloat(s.selected.style.height)/2);break;case"hb":s.selected.style.top=f(c-parseFloat(s.selected.style.height));break;case"vl":s.selected.style.left=f(c);break;case"vc":s.selected.style.left=f(c-parseFloat(s.selected.style.width)/2);break;case"vr":s.selected.style.left=f(c-parseFloat(s.selected.style.width));break}a(),s.seletedBorder.reRender(s);let d=1/0;S.forEach(h=>{t[h].forEach(o=>{o.absorbDistance<d&&(d=o.absorbDistance)})}),S.forEach(h=>{t[h].forEach(o=>{o.absorbDistance-d>.1&&(t[h]=[])})})}function r(){if(!s.selected)return;const e=A.from(s.selected);Object.values(t).flat().forEach(n=>{const{source:d,target:h,type:o}=n,i=s.alignLine.g.getElementsByClassName(`${u}-alignLine-${o}`)[0];if(/^h/.test(o))switch(i==null||i.setAttribute("x1",String(d)),i==null||i.setAttribute("x2",String(h)),o){case"ht":i.setAttribute("y1",String(e.y)),i.setAttribute("y2",String(e.y));break;case"hc":i.setAttribute("y1",String(e.y+e.h/2)),i.setAttribute("y2",String(e.y+e.h/2));break;case"hb":i.setAttribute("y1",String(e.y+e.h)),i.setAttribute("y2",String(e.y+e.h));break}if(/^v/.test(o))switch(i==null||i.setAttribute("y1",String(d)),i==null||i.setAttribute("y2",String(h)),o){case"vl":i.setAttribute("x1",String(e.x)),i.setAttribute("x2",String(e.x));break;case"vc":i.setAttribute("x1",String(e.x+e.w/2)),i.setAttribute("x2",String(e.x+e.w/2));break;case"vr":i.setAttribute("x1",String(e.x+e.w)),i.setAttribute("x2",String(e.x+e.w));break}i==null||i.setAttribute("style","display: 'block")})}a(),Object.values(t).flat().forEach(e=>{l(e)}),r()}class H{constructor(t){w(this,"g");this.g=document.createElementNS("http://www.w3.org/2000/svg","g"),this.g.setAttribute("class",`${u}-alignLine`),t.append(this.g)}clear(){this.g.innerHTML=""}reRender(t){t.selected&&(this.clear(),this.g.append(...F()),X(t))}}const x=1,B="#000",v=6,Y=["left","top","right","bottom"],z=["left-top","top","right-top","right","right-bottom","bottom","left-bottom","left"],W=["nwse-resize","ns-resize","nesw-resize","ew-resize","nwse-resize","ns-resize","nesw-resize","ew-resize"];function T(s){const t=A.from(s.selected),a=[];return Y.forEach((l,r)=>{const e=document.createElementNS("http://www.w3.org/2000/svg","line");switch(e.setAttribute("class",`${u}-selected-border-line-${l}`),e.setAttribute("stroke",B),e.setAttribute("stroke-width",f(x)),l){case"left":e.setAttribute("x1",String(t.x)),e.setAttribute("y1",String(t.y-x/2)),e.setAttribute("x2",String(t.x)),e.setAttribute("y2",String(t.y+t.h+x/2));break;case"right":e.setAttribute("x1",String(t.x+t.w)),e.setAttribute("y1",String(t.y-x/2)),e.setAttribute("x2",String(t.x+t.w)),e.setAttribute("y2",String(t.y+t.h+x/2));break;case"top":e.setAttribute("x1",String(t.x-x/2)),e.setAttribute("y1",String(t.y)),e.setAttribute("x2",String(t.x+t.w+x/2)),e.setAttribute("y2",String(t.y));break;case"bottom":e.setAttribute("x1",String(t.x-x/2)),e.setAttribute("y1",String(t.y+t.h)),e.setAttribute("x2",String(t.x+t.w+x/2)),e.setAttribute("y2",String(t.y+t.h));break}a.push(e)}),z.forEach((l,r)=>{const e=document.createElementNS("http://www.w3.org/2000/svg","rect");e.setAttribute("class",`${u}-selected-border-point-${l}`),e.setAttribute("fill","white"),e.setAttribute("stroke",B),e.setAttribute("stroke-width",f(x)),e.setAttribute("width",f(v)),e.setAttribute("height",f(v)),e.setAttribute("style",`cursor: ${W[r]}`),e.setAttribute("data-direction",l),e.setAttribute("data-owner-id",s.selected.dataset.id);const c=v/2;switch(l){case"left-top":e.setAttribute("x",String(t.x-c)),e.setAttribute("y",String(t.y-c));break;case"top":e.setAttribute("x",String(t.x+t.w/2-c)),e.setAttribute("y",String(t.y-c));break;case"right-top":e.setAttribute("x",String(t.x+t.w-c)),e.setAttribute("y",String(t.y-c));break;case"right":e.setAttribute("x",String(t.x+t.w-c)),e.setAttribute("y",String(t.y+t.h/2-c));break;case"right-bottom":e.setAttribute("x",String(t.x+t.w-c)),e.setAttribute("y",String(t.y+t.h-c));break;case"bottom":e.setAttribute("x",String(t.x+t.w/2-c)),e.setAttribute("y",String(t.y+t.h-c));break;case"left-bottom":e.setAttribute("x",String(t.x-c)),e.setAttribute("y",String(t.y+t.h-c));break;case"left":e.setAttribute("x",String(t.x-c)),e.setAttribute("y",String(t.y+t.h/2-c));break}a.push(e)}),a}class j{constructor(t){w(this,"g");this.g=document.createElementNS("http://www.w3.org/2000/svg","g"),this.g.setAttribute("class",`${u}-seleted-border`),t.append(this.g)}clear(){this.g.innerHTML=""}reRender(t){t.selected&&(this.clear(),this.g.append(...T(t)),T(t))}}const G=(s,t)=>{const a=document.createElementNS("http://www.w3.org/2000/svg","svg");a.setAttribute("class",`${u}-svg`);const l=s.getBoundingClientRect();return a.setAttribute("width",f(l.width)),a.setAttribute("height",f(l.height)),a.style="position: absolute; inset: 0;",s.className+=` ${u}-container`,t.forEach(r=>{r.className+=` ${u}-movable-node`,r.setAttribute("data-id",C()),/%$/.test(r.style.x)&&(r.style.x=f(l.width*parseInt(r.style.x)/100)),/%$/.test(r.style.y)&&(r.style.y=f(l.height*parseInt(r.style.y)/100)),/%$/.test(r.style.width)&&(r.style.width=f(l.width*parseInt(r.style.width)/100)),/%$/.test(r.style.height)&&(r.style.height=f(l.height*parseInt(r.style.height)/100))}),{container:s,nodes:t,svg:a,selected:null,alignLine:new H(a),seletedBorder:new j(a),moveDelta:[0,0],setSelected(r){if(this.selected=r,!r){this.seletedBorder.clear();return}this.seletedBorder.reRender(this)}}};function q(s,t){const a=G(s,t);return $(a),a.svg}return q});
