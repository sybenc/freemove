(function(M,o){typeof exports=="object"&&typeof module<"u"?module.exports=o():typeof define=="function"&&define.amd?define(o):(M=typeof globalThis<"u"?globalThis:M||self,M.FreeMove=o())})(this,function(){"use strict";var Ft=Object.defineProperty;var Mt=(M,o,Y)=>o in M?Ft(M,o,{enumerable:!0,configurable:!0,writable:!0,value:Y}):M[o]=Y;var x=(M,o,Y)=>Mt(M,typeof o!="symbol"?o+"":o,Y);const o="__freemove";class y{constructor({x:e,y:t,h:i,w:n,node:r}){x(this,"x");x(this,"y");x(this,"w");x(this,"h");x(this,"id");x(this,"node");this.x=e,this.y=t,this.h=i,this.w=n,this.node=r,this.id=r.dataset.id}sync(){this.x=parseFloat(this.node.style.left),this.y=parseFloat(this.node.style.top),this.w=parseFloat(this.node.style.width),this.h=parseFloat(this.node.style.height)}set error(e){this.node.setAttribute("data-error",String(e))}get error(){return!!this.node.getAttribute("data-error")}isInSide(e){return e.x>=this.x&&e.x<=this.x+this.w&&e.y>=this.y&&e.y<=this.y+this.h}isIntersect(e){const t=this.x+0,i=this.y+0,n=this.x+this.w-0,r=this.y+this.h-0,l=e.x,d=e.y,c=e.x+e.w,a=e.y+e.h;return!(n<l||t>c||r<d||i>a)}static from(e){return new y({x:parseFloat(e.style.left),y:parseFloat(e.style.top),w:parseFloat(e.style.width),h:parseFloat(e.style.height),node:e})}}function A(s){return typeof s=="number"?`${s}px`:String(s)}function q(s,e,t=.1){return Math.abs(s-e)<=t}function b(s,e){return s.getElementsByClassName(e)[0]}function f(s){return document.createElementNS("http://www.w3.org/2000/svg",s)}function P(s,e=!1){return e?Math.round(parseFloat(s.toFixed(1))):Number.isInteger(s)?s.toFixed(0):s.toFixed(1)}function it(s,e){if(!s.selected)return;const t=s.canvas.getBoundingClientRect();s.selected.dataset.error==="false"&&(s.align.reRender(s),s.distance.reRender(s),s.gap.reRender(s)),s.border.reRender(s);const i=s.selected.getBoundingClientRect();let n=(e.clientX-i.left)/s.scale,r=(e.clientY-i.top)/s.scale,l=null;function d(a){l||(l=requestAnimationFrame(()=>{if(!s.selected)return;let g=(a.clientX-t.left)/s.scale-n,h=(a.clientY-t.top)/s.scale-r;const u=s.canvas.clientWidth-s.selected.offsetWidth,S=s.canvas.clientHeight-s.selected.offsetHeight;g=Math.max(0,Math.min(g,u)),h=Math.max(0,Math.min(h,S)),s.selected.style.left=A(g),s.selected.style.top=A(h),s.searchError(),s.selected.dataset.error==="false"&&(s.align.reRender(s),s.distance.reRender(s),s.gap.reRender(s)),s.border.reRender(s),l=null}))}function c(){document.removeEventListener("pointermove",d),document.removeEventListener("pointerup",c),s.align.hidden(),s.distance.hidden(),s.gap.clear(),l!==null&&(cancelAnimationFrame(l),l=null)}document.addEventListener("pointermove",d),document.addEventListener("pointerup",c)}function st(s,e){if(!s.selected)return;const t=s.canvas.getBoundingClientRect(),n=e.target.dataset.direction;if(!n)return;const r=y.from(s.selected);let l=e.clientX,d=e.clientY,c=r.w,a=r.h,g=r.x,h=r.y;const u=t.width,S=t.height;function m(L){let N=(L.clientX-l)/s.scale,D=(L.clientY-d)/s.scale,k=c,E=a,F=g,I=h;n.includes("right")&&(k=c+N),n.includes("left")&&(k=c-N,F=g+N),n.includes("bottom")&&(E=a+D),n.includes("top")&&(E=a-D,I=h+D),F<0&&(k+=F,F=0),I<0&&(E+=I,I=0),F+k>u/s.scale&&(k=u/s.scale-F),I+E>S/s.scale&&(E=S/s.scale-I),k=Math.max(k,10),E=Math.max(E,10),s.resize.reRender(s,k,E,n,g,h,c,a),s.border.reRender(s)}function $(){s.resize.hidden(),document.removeEventListener("pointermove",m),document.removeEventListener("pointerup",$)}document.addEventListener("pointermove",m),document.addEventListener("pointerup",$)}function nt(s,e){const t=s.canvas.getBoundingClientRect(),i=(e.clientX-t.left)/s.scale,n=(e.clientY-t.top)/s.scale;function r(d){const c=(d.clientX-t.left)/s.scale,a=(d.clientY-t.top)/s.scale;s.selector.reRender(s,i,n,c,a),s.selector.showPreview()}function l(){s.selector.hiddenSelector(),document.removeEventListener("pointermove",r),document.removeEventListener("pointerup",l)}document.addEventListener("pointermove",r),document.addEventListener("pointerup",l)}function rt(s){s.svg.addEventListener("pointerdown",e=>{e.preventDefault();const t=e.target;if(t.classList[0].includes(`${o}-border-point-`)){const i=t.dataset.ownerId;for(let n=0;n<s.nodes.length;n++)i===s.nodes[n].dataset.ownerId&&s.setSelected(s.nodes[n]);s.selected&&st(s,e);return}if(t.classList.contains(`${o}-svg`)){let i=null;for(const n of s.nodes){const r=y.from(n);if(r.isInSide({x:e.offsetX,y:e.offsetY})){i=r;break}}i&&i.node.classList.contains(`${o}-movable-node`)&&(s.selector.hiddenPreview(),s.setSelected(i.node),s.searchError(),it(s,e)),i||(s.border.hidden(),s.selected=null,nt(s,e))}}),s.board.addEventListener("wheel",e=>{e.preventDefault();const[t,i]=s.scaleRange;function n(){s.canvas.style.transform=`translate(${s.translateX}px, ${s.translateY}px) scale(${s.scale})`,s.canvas.style.transformOrigin="0 0",s.border.reRender(s)}if(e.ctrlKey){const r=s.canvas.getBoundingClientRect(),l=e.clientX-r.left,d=e.clientY-r.top,c=l/s.scale,a=d/s.scale;let g=e.deltaY*-.01,h=s.scale+g;h=Math.max(t,Math.min(i,h)),s.scale=h;const u=l/s.scale,S=d/s.scale,m=(u-c)*s.scale,$=(S-a)*s.scale;s.translateX+=m,s.translateY+=$,s.scale=h,n()}else s.translateX-=e.deltaX,s.translateY-=e.deltaY,n()})}const lt="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let at=(s=21)=>{let e="",t=crypto.getRandomValues(new Uint8Array(s|=0));for(;s--;)e+=lt[t[s]&63];return e};const U=1,ct="red",X=["vl","vc","vr","ht","hc","hb"];function ht(s){return{vl:s.x,vc:s.x+s.w/2,vr:s.x+s.w,ht:s.y,hc:s.y+s.h/2,hb:s.y+s.h}}function O(s,e){const t=y.from(s.selected),i=s.nodes.filter(n=>n!==s.selected).map(n=>y.from(n));X.forEach(n=>e.alternateNodes[n]=[]),i.forEach(n=>{if(t.isIntersect(n))return;const r=ht(t);X.forEach(l=>{let d=1e4,c=1e4,a;/^h/.test(l)&&(t.x>n.x+n.w?(d=t.x+t.w,c=n.x):t.x+t.w<n.x?(d=t.x,c=n.x+n.w):(d=Math.min(t.x,n.x),c=Math.max(t.x+t.w,n.x+n.w)),[n.y,n.y+n.h/2,n.y+n.h].forEach(g=>{a=Math.abs(r[l]-g),a<=3&&e.alternateNodes[l].push({type:l,source:d,target:c,absorbDistance:a,absorbPosition:g,nodeRects:[n]})})),/^v/.test(l)&&(t.y>n.y+n.h?(d=t.y+t.h,c=n.y):t.y+t.h<n.y?(d=t.y,c=n.y+n.h):(d=Math.min(t.y,n.y),c=Math.max(t.y+t.h,n.y+n.h)),[n.x,n.x+n.w/2,n.x+n.w].forEach(g=>{a=Math.abs(r[l]-g),a<=3&&e.alternateNodes[l].push({type:l,source:d,target:c,absorbDistance:a,absorbPosition:g,nodeRects:[n]})}))})}),X.forEach(n=>{const r=new Map;e.alternateNodes[n].forEach(c=>{const a=r.get(c.absorbDistance)||[];a.push(c),r.set(c.absorbDistance,a)});let l=1/0,d=0;r.forEach(c=>{c.forEach(a=>{l=Math.min(l,a.source,a.target),d=Math.max(d,a.source,a.target)})}),r.forEach(c=>{c.forEach(a=>{a.source=l,a.target=d})}),e.alternateNodes[n]=Array.from(r.values()).flat()})}function ot(s,e,t){const{absorbPosition:i,type:n}=t,r=s.selected;switch(n){case"ht":r.style.top=A(i);break;case"hc":r.style.top=A(i-parseFloat(r.style.height)/2);break;case"hb":r.style.top=A(i-parseFloat(r.style.height));break;case"vl":r.style.left=A(i);break;case"vc":r.style.left=A(i-parseFloat(r.style.width)/2);break;case"vr":r.style.left=A(i-parseFloat(r.style.width));break}O(s,e),s.border.reRender(s)}function dt(s,e){if(!s.selected)return;const t=s.canvas.getBoundingClientRect(),i=y.from(s.selected),n=t.width/s.scale/2;Math.abs(i.x+i.w/2-n)<=3&&(s.selected.style.left=A(n-i.w/2),e.showContainerAlignLine=!0),O(s,e),s.border.reRender(s)}function gt(s,e){if(!s.selected)return;const t=s.canvas.getBoundingClientRect(),i=y.from(s.selected),n=Object.values(e.alternateNodes).flat();if([...e.alternateNodes.hb,...e.alternateNodes.hc,...e.alternateNodes.ht].length===0?e.isHAlign=!1:e.isHAlign=!0,[...e.alternateNodes.vc,...e.alternateNodes.vl,...e.alternateNodes.vr].length===0?e.isVAlign=!1:e.isVAlign=!0,n.forEach(r=>{const{source:l,target:d,type:c}=r,a=e.lines[c];if(/^h/.test(c))switch(a==null||a.setAttribute("x1",String(l)),a==null||a.setAttribute("x2",String(d)),c){case"ht":a.setAttribute("y1",String(i.y)),a.setAttribute("y2",String(i.y));break;case"hc":a.setAttribute("y1",String(i.y+i.h/2)),a.setAttribute("y2",String(i.y+i.h/2));break;case"hb":a.setAttribute("y1",String(i.y+i.h)),a.setAttribute("y2",String(i.y+i.h));break}if(/^v/.test(c))switch(a==null||a.setAttribute("y1",String(l)),a==null||a.setAttribute("y2",String(d)),c){case"vl":a.setAttribute("x1",String(i.x)),a.setAttribute("x2",String(i.x));break;case"vc":a.setAttribute("x1",String(i.x+i.w/2)),a.setAttribute("x2",String(i.x+i.w/2));break;case"vr":a.setAttribute("x1",String(i.x+i.w)),a.setAttribute("x2",String(i.x+i.w));break}a.setAttribute("stroke-width",String(U/s.scale)),a==null||a.setAttribute("style","display: 'block")}),e.showContainerAlignLine){const r=e.lines.vertical;r.setAttribute("x1",String(t.width/s.scale/2)),r.setAttribute("y1",String(0)),r.setAttribute("x2",String(t.width/s.scale/2)),r.setAttribute("y2",String(t.height/s.scale)),r.setAttribute("stroke-width",String(U/s.scale)),r==null||r.setAttribute("style","display: 'block")}}class ut{constructor(e){x(this,"g");x(this,"lines");x(this,"isHAlign",!1);x(this,"isVAlign",!1);x(this,"alternateNodes",{ht:[],hc:[],hb:[],vl:[],vc:[],vr:[]});x(this,"showContainerAlignLine",!1);this.g=f("g"),this.g.setAttribute("class",`${o}-align`),this.lines={},[...X,"vertical"].forEach(t=>{const i=f("line");i.setAttribute("class",`${o}-align-${t}`),i.setAttribute("stroke",ct),i.style.display="none",this.g.append(i),this.lines[t]=i}),e.append(this.g)}hidden(){Object.values(this.lines).forEach(e=>{e.style.display="none"})}reRender(e){if(!e.selected)return;this.hidden(),this.alternateNodes={ht:[],hc:[],hb:[],vl:[],vc:[],vr:[]},this.showContainerAlignLine=!1,O(e,this),Object.values(this.alternateNodes).flat().forEach(i=>{ot(e,this,i)}),dt(e,this);let t=1/0;X.forEach(i=>{this.alternateNodes[i].forEach(n=>{n.absorbDistance<t&&(t=n.absorbDistance)})}),X.forEach(i=>{this.alternateNodes[i]=this.alternateNodes[i].filter(n=>q(n.absorbDistance,t,.01))}),gt(e,this)}}const z=1,K="#000",j=6,Q=["left","top","right","bottom"],_=["left-top","top","right-top","right","right-bottom","bottom","left-bottom","left"],bt=["nwse-resize","ns-resize","nesw-resize","ew-resize","nwse-resize","ns-resize","nesw-resize","ew-resize"];function At(){const s=[],e=[];return Q.forEach(t=>{const i=f("line");i.setAttribute("class",`${o}-border-line-${t}`),i.setAttribute("stroke",K),e.push(i)}),_.forEach((t,i)=>{const n=f("rect");n.setAttribute("class",`${o}-border-point-${t}`),n.setAttribute("fill","white"),n.setAttribute("stroke",K),n.setAttribute("style",`cursor: ${bt[i]}`),n.setAttribute("data-direction",t),s.push(n)}),[s,e]}function yt(s,e){const t=y.from(e.selected);Q.forEach(i=>{const n=b(s,`${o}-border-line-${i}`);switch(n.setAttribute("stroke-width",A(z/e.scale)),i){case"left":n.setAttribute("x1",String(t.x)),n.setAttribute("y1",String(t.y-z/e.scale/2)),n.setAttribute("x2",String(t.x)),n.setAttribute("y2",String(t.y+t.h+z/e.scale/2));break;case"right":n.setAttribute("x1",String(t.x+t.w)),n.setAttribute("y1",String(t.y-z/e.scale/2)),n.setAttribute("x2",String(t.x+t.w)),n.setAttribute("y2",String(t.y+t.h+z/e.scale/2));break;case"top":n.setAttribute("x1",String(t.x-z/e.scale/2)),n.setAttribute("y1",String(t.y)),n.setAttribute("x2",String(t.x+t.w+z/e.scale/2)),n.setAttribute("y2",String(t.y));break;case"bottom":n.setAttribute("x1",String(t.x-z/e.scale/2)),n.setAttribute("y1",String(t.y+t.h)),n.setAttribute("x2",String(t.x+t.w+z/e.scale/2)),n.setAttribute("y2",String(t.y+t.h));break}}),_.forEach((i,n)=>{const r=b(s,`${o}-border-point-${i}`);r.setAttribute("data-owner-id",e.selected.dataset.id),r.setAttribute("stroke-width",A(z/e.scale)),r.setAttribute("width",A(j/e.scale)),r.setAttribute("height",A(j/e.scale));const l=j/e.scale/2;switch(i){case"left-top":r.setAttribute("x",String(t.x-l)),r.setAttribute("y",String(t.y-l));break;case"top":r.setAttribute("x",String(t.x+t.w/2-l)),r.setAttribute("y",String(t.y-l));break;case"right-top":r.setAttribute("x",String(t.x+t.w-l)),r.setAttribute("y",String(t.y-l));break;case"right":r.setAttribute("x",String(t.x+t.w-l)),r.setAttribute("y",String(t.y+t.h/2-l));break;case"right-bottom":r.setAttribute("x",String(t.x+t.w-l)),r.setAttribute("y",String(t.y+t.h-l));break;case"bottom":r.setAttribute("x",String(t.x+t.w/2-l)),r.setAttribute("y",String(t.y+t.h-l));break;case"left-bottom":r.setAttribute("x",String(t.x-l)),r.setAttribute("y",String(t.y+t.h-l));break;case"left":r.setAttribute("x",String(t.x-l)),r.setAttribute("y",String(t.y+t.h/2-l));break}})}class ft{constructor(e){x(this,"g");x(this,"points");x(this,"lines");this.g=f("g"),this.g.setAttribute("class",`${o}-border`),e.append(this.g);const[t,i]=At();this.points=t,this.lines=i,this.g.append(...i,...t),this.g.style.display="none"}hidden(){this.g.style.display="none"}reRender(e){e.selected&&(this.g.style.display="block",yt(this.g,e))}}const C=1,W="#2A63F4",R=8,T=10,J=10;function Z(s){const e=s.nodes.map(n=>y.from(n)),t=new Map,i=new Map;return e.forEach(n=>{var d,c;const r={type:"width",nodeRect:n},l={type:"height",nodeRect:n};t.has(n.w)?(d=t.get(n.w))==null||d.push(r):t.set(n.w,[r]),i.has(n.h)?(c=i.get(n.h))==null||c.push(l):i.set(n.h,[l])}),{widthMap:t,heightMap:i}}function xt(s){s.nodes.forEach(e=>{const t=y.from(e),i=s.resize.g.querySelector(`[data-ower-id="${t.id}"]`),n=b(i,`${o}-resize-line-group-width-line`),r=b(i,`${o}-resize-line-group-width-line-start`),l=b(i,`${o}-resize-line-group-width-line-end`),d=b(i,`${o}-resize-line-group-width-text`),c=b(i,`${o}-resize-line-group-height-line`),a=b(i,`${o}-resize-line-group-height-text`),g=b(i,`${o}-resize-line-group-height-line-start`),h=b(i,`${o}-resize-line-group-height-line-end`);n.setAttribute("x1",String(t.x)),n.setAttribute("y1",String(t.y-R)),n.setAttribute("x2",String(t.x+t.w)),n.setAttribute("y2",String(t.y-R)),r.setAttribute("x",String(t.x-C/s.scale/2)),r.setAttribute("y",String(t.y-R-T/s.scale/2)),r.setAttribute("width",String(C/s.scale)),r.setAttribute("height",String(T)),r.setAttribute("fill",String(W)),l.setAttribute("x",String(t.x+t.w-C/s.scale/2)),l.setAttribute("y",String(t.y-R-T/s.scale/2)),l.setAttribute("width",String(C/s.scale)),l.setAttribute("height",String(T)),l.setAttribute("fill",String(W)),d.textContent=`${P(t.w)}`,d.setAttribute("x",String(t.x+t.w/2)),d.setAttribute("y",String(t.y-R-8)),d.setAttribute("fill",String(W)),d.setAttribute("font-size",String(J/s.scale)),d.setAttribute("text-anchor","middle"),d.setAttribute("alignment-baseline","middle"),c.setAttribute("x1",String(t.x-R)),c.setAttribute("y1",String(t.y)),c.setAttribute("x2",String(t.x-R)),c.setAttribute("y2",String(t.y+t.h)),g.setAttribute("x",String(t.x-R-T/s.scale/2)),g.setAttribute("y",String(t.y-C/s.scale/2)),g.setAttribute("width",String(T)),g.setAttribute("height",String(C/s.scale)),g.setAttribute("fill",String(W)),h.setAttribute("x",String(t.x-R-T/s.scale/2)),h.setAttribute("y",String(t.y+t.h-C/s.scale/2)),h.setAttribute("width",String(T)),h.setAttribute("height",String(C/s.scale)),h.setAttribute("fill",String(W)),a.textContent=`${P(t.h)}`,a.setAttribute("x",String(t.x-R-8)),a.setAttribute("y",String(t.y+t.h/2)),a.setAttribute("fill",String(W)),a.setAttribute("font-size",String(J/s.scale)),a.setAttribute("text-anchor","middle"),a.setAttribute("alignment-baseline","middle"),a.setAttribute("transform",`rotate(-90 ${t.x-R-8} ${t.y+t.h/2})`),[n,c].forEach(u=>{u.setAttribute("stroke",W),u.setAttribute("stroke-width",String(C/s.scale))})})}class pt{constructor(e,t){x(this,"g");x(this,"lines");this.g=f("g"),this.g.setAttribute("class",`${o}-resize`);const i=[];t.forEach(n=>{const r=y.from(n),l=f("g");l.setAttribute("class",`${o}-resize-line`),l.setAttribute("data-ower-id",r.id);const d=f("g");d.setAttribute("class",`${o}-resize-line-group-width`);const c=f("line");c.setAttribute("class",`${o}-resize-line-group-width-line`);const a=f("text");a.setAttribute("class",`${o}-resize-line-group-width-text`);const g=f("rect");g.setAttribute("class",`${o}-resize-line-group-width-line-start`);const h=f("rect");h.setAttribute("class",`${o}-resize-line-group-width-line-end`),d.append(c,a,g,h);const u=f("g");u.setAttribute("class",`${o}-resize-line-group-height`);const S=f("line");S.setAttribute("class",`${o}-resize-line-group-height-line`);const m=f("text");m.setAttribute("class",`${o}-resize-line-group-height-text`);const $=f("rect");$.setAttribute("class",`${o}-resize-line-group-height-line-start`);const L=f("rect");L.setAttribute("class",`${o}-resize-line-group-height-line-end`),u.append(S,m,$,L),l.append(d,u),i.push(l)}),this.lines=i,this.g.append(...this.lines),e.append(this.g),this.hidden()}hidden(){this.lines.forEach(e=>{Array.from(e.children).forEach(t=>{t.style.display="none"})})}reRender(e,t,i,n,r,l,d,c){var tt,et;if(!e.selected)return;this.hidden();const{widthMap:a,heightMap:g}=Z(e),h=[],u=[];a.forEach((v,B)=>{var H;v.length===1&&v[0].nodeRect.id===((H=e.selected)==null?void 0:H.dataset.id)||Math.abs(t-B)<=3&&h.push(B)}),g.forEach((v,B)=>{var H;v.length===1&&v[0].nodeRect.id===((H=e.selected)==null?void 0:H.dataset.id)||Math.abs(i-B)<=3&&u.push(B)});const S=h.length===0?t:Math.max(...h),m=u.length===0?i:Math.max(...u),$=Math.max(S,10),L=Math.max(m,10);if(n.includes("left")){const v=r+d;e.selected.style.left=A(v-$)}else e.selected.style.left=A(r);if(e.selected.style.width=A($),n.includes("top")){const v=l+c;e.selected.style.top=A(v-L)}else e.selected.style.top=A(l);e.selected.style.height=A(L);const N=parseFloat(e.selected.style.width),D=parseFloat(e.selected.style.height),{widthMap:k,heightMap:E}=Z(e);(tt=k.get(N))==null||tt.forEach(v=>{const B=this.g.querySelector(`[data-ower-id="${v.nodeRect.id}"]`),H=b(B,`${o}-resize-line-group-width`);H.style.display="block"}),(et=E.get(D))==null||et.forEach(v=>{const B=this.g.querySelector(`[data-ower-id="${v.nodeRect.id}"]`),H=b(B,`${o}-resize-line-group-height`);H.style.display="block"});const F=this.g.querySelector(`[data-ower-id="${e.selected.dataset.id}"]`),I=b(F,`${o}-resize-line-group-width`),Lt=b(F,`${o}-resize-line-group-height`);Lt.style.display="block",I.style.display="block",xt(e),e.border.reRender(e)}}function St(s,e,t,i){return t-s>0&&i-e>0?"4":t-s<0&&i-e>0?"3":t-s<0&&i-e<0?"2":t-s>0&&i-e<0?"1":"0"}class wt{constructor(e){x(this,"g");x(this,"selectorRect");x(this,"previewRect");x(this,"selectedGroup",[]);this.g=f("g"),this.g.setAttribute("class",`${o}-selector`),this.selectorRect=f("rect"),this.selectorRect.setAttribute("class",`${o}-selector-rect`),this.selectorRect.setAttribute("stroke","#919191"),this.selectorRect.setAttribute("stroke-width","1px"),this.selectorRect.setAttribute("fill","rgba(255,255,255,0.3)"),this.selectorRect.style.display="none",this.previewRect=f("rect"),this.previewRect.setAttribute("class",`${o}-selector-preview`),this.previewRect.setAttribute("stroke","#000"),this.previewRect.setAttribute("stroke-width","1px"),this.previewRect.setAttribute("fill","transparent"),this.previewRect.style.display="none",this.g.append(this.selectorRect,this.previewRect),e.append(this.g)}hiddenSelector(){this.selectorRect.style.display="none"}showSelector(){this.selectorRect.style.display="block"}hiddenPreview(){this.previewRect.style.display="none"}showPreview(){this.previewRect.style.display="block"}reRender(e,t,i,n,r){this.showSelector(),this.hiddenPreview(),this.selectedGroup=[];const l=St(t,i,n,r),d=Math.abs(t-n),c=Math.abs(i-r);this.selectorRect.setAttribute("width",String(d)),this.selectorRect.setAttribute("height",String(c));let a=t,g=i;switch(l){case"3":{a=a-d;break}case"2":{a=a-d,g=g-c;break}case"1":{g=g-c;break}}this.selectorRect.setAttribute("x",String(a)),this.selectorRect.setAttribute("y",String(g)),e.nodes.forEach(N=>{y.from(N).isIntersect({x:a,y:g,w:d,h:c})&&this.selectedGroup.push(N)});const h=[],u=[],S=[],m=[];this.selectedGroup.forEach(N=>{const{x:D,y:k,w:E,h:F}=y.from(N);h.push(D),u.push(k),S.push(D+E),m.push(k+F)});const $=Math.min(...h),L=Math.min(...u);this.previewRect.setAttribute("x",String(h.length?$:0)),this.previewRect.setAttribute("y",String(u.length?L:0)),this.previewRect.setAttribute("width",String(S.length?Math.max(...S)-$:0)),this.previewRect.setAttribute("height",String(m.length?Math.max(...m)-L:0))}}const p="#3875F6",G=1,w=10,mt=["left","right","top","bottom"];function $t(s){if(!s.selected||!s.nodes||s.nodes.length===0)return;s.distance.left={length:1/0,node:null},s.distance.right={length:1/0,node:null},s.distance.top={length:1/0,node:null},s.distance.bottom={length:1/0,node:null};const e=[],t=y.from(s.selected);s.nodes.forEach(i=>{if(t.node===i)return;const n=y.from(i);e.push(n)}),e.forEach(i=>{if(i.isIntersect(t))return;if(i.y<=t.y+t.h&&i.y+i.h>=t.y){if(t.x+t.w<i.x){const l=Math.abs(t.x+t.w-i.x);s.distance.right.length>l&&(s.distance.right.length=l,s.distance.right.node=i.node)}if(t.x>i.x+i.w){const l=Math.abs(t.x-i.x-i.w);s.distance.left.length>l&&(s.distance.left.length=l,s.distance.left.node=i.node)}}if(i.x<=t.x+t.w&&i.x+i.w>=t.x){if(t.y+t.h<i.y){const l=Math.abs(t.y+t.h-i.y);s.distance.bottom.length>l&&(s.distance.bottom.length=l,s.distance.bottom.node=i.node)}if(t.y>i.y+i.h){const l=Math.abs(t.y-i.y-i.h);s.distance.top.length>l&&(s.distance.top.length=l,s.distance.top.node=i.node)}}})}function V(s){const e=[4,8,12,16];for(const t of e)if(t-2<=s&&t+2>=s)return t;return s}class kt{constructor(e){x(this,"g");x(this,"lines");x(this,"left");x(this,"right");x(this,"top");x(this,"bottom");this.g=f("g"),this.g.setAttribute("class",`${o}-distance`),this.lines={};const t=i=>{const n=f("g");n.setAttribute("class",`${o}-distance-${i}`);const r=f("line");r.setAttribute("class",`${o}-distance-${i}-line`);const l=f("line");l.setAttribute("class",`${o}-distance-${i}-dash-line`);const d=f("text");d.setAttribute("class",`${o}-distance-${i}-text`);const c=f("rect");c.setAttribute("class",`${o}-distance-${i}-text-bg`);const a=f("rect");a.setAttribute("class",`${o}-distance-${i}-line-start`);const g=f("rect");return g.setAttribute("class",`${o}-distance-${i}-line-end`),n.appendChild(r),n.appendChild(l),n.appendChild(c),n.appendChild(d),n.appendChild(a),n.appendChild(g),n};this.left={length:1/0,node:null},this.right={length:1/0,node:null},this.top={length:1/0,node:null},this.bottom={length:1/0,node:null},mt.forEach(i=>{const n=t(i);this.lines[i]=n}),this.g.append(...Object.values(this.lines)),e.append(this.g)}hidden(){Object.values(this.lines).forEach(e=>{e.setAttribute("style","display: none;")})}reRender(e){if(e.selected){if(this.hidden(),$t(e),this.left.node&&this.left.node.id!==e.selected.dataset.id){if(e.align.isHAlign&&!e.align.isVAlign){const u=V(this.left.length);u!==this.left.length&&(e.selected.style.left=A(parseFloat(e.selected.style.left)-this.left.length+u),this.left.length=u,e.align.reRender(e),e.border.reRender(e))}const t=y.from(this.left.node),i=y.from(e.selected),n=b(this.lines.left,`${o}-distance-left-line`);n.setAttribute("x1",String(t.x+t.w)),n.setAttribute("x2",String(i.x)),n.setAttribute("y1",String(i.y+i.h/2)),n.setAttribute("y2",String(i.y+i.h/2)),n.setAttribute("stroke",p),n.setAttribute("stroke-width",String(G/e.scale));const r=b(this.lines.left,`${o}-distance-left-text`);r.textContent=`${P(i.x-t.x-t.w,!0)}`,r.setAttribute("x",String((t.x+t.w+i.x)/2)),r.setAttribute("y",String(i.y+i.h/2-(w+4)/2/e.scale-2/e.scale)),r.setAttribute("fill","#FFFFFF"),r.setAttribute("font-size",String(w/e.scale)),r.setAttribute("text-anchor","middle"),r.setAttribute("alignment-baseline","middle");const l=b(this.lines.left,`${o}-distance-left-text-bg`);l.setAttribute("x",String((t.x+t.w+i.x)/2-(r.getComputedTextLength()+10)/2)),l.setAttribute("y",String(i.y+i.h/2-w/e.scale/2-12/e.scale)),l.setAttribute("width",String(r.getComputedTextLength()+10)),l.setAttribute("height",String((w+4)/e.scale)),l.setAttribute("fill",p),l.setAttribute("rx","4"),l.setAttribute("ry","4");const d=1,c=8,a=b(this.lines.left,`${o}-distance-left-line-start`);a.setAttribute("x",String(t.x+t.w-d/2)),a.setAttribute("y",String(i.y+i.h/2-c/2)),a.setAttribute("width",String(d)),a.setAttribute("height",String(c)),a.setAttribute("fill",p);const g=b(this.lines.left,`${o}-distance-left-line-end`);g.setAttribute("x",String(i.x-d/2)),g.setAttribute("y",String(i.y+i.h/2-c/2)),g.setAttribute("width",String(d)),g.setAttribute("height",String(c)),g.setAttribute("fill",p);const h=b(this.lines.left,`${o}-distance-left-dash-line`);i.y<t.y?(h.setAttribute("x1",String(t.x+t.w)),h.setAttribute("x2",String(t.x+t.w)),h.setAttribute("y1",String(i.y)),h.setAttribute("y2",String(t.y)),h.setAttribute("stroke",p),h.setAttribute("stroke-width","1"),h.setAttribute("stroke-dasharray","4 4"),h.setAttribute("style","display: block;")):i.y+i.h>t.y+t.h?(h.setAttribute("x1",String(t.x+t.w)),h.setAttribute("x2",String(t.x+t.w)),h.setAttribute("y1",String(t.y+t.h)),h.setAttribute("y2",String(i.y+i.h)),h.setAttribute("stroke",p),h.setAttribute("stroke-width","1"),h.setAttribute("stroke-dasharray","4 4"),h.setAttribute("style","display: block;")):h.setAttribute("style","display: none;")}if(this.right.node&&this.right.node.id!==e.selected.dataset.id){if(e.align.isHAlign&&!e.align.isVAlign){const u=V(this.right.length);u!==this.right.length&&(e.selected.style.left=A(parseFloat(e.selected.style.left)+this.right.length-u),this.right.length=u,e.align.reRender(e),e.border.reRender(e))}const t=y.from(this.right.node),i=y.from(e.selected),n=b(this.lines.right,`${o}-distance-right-line`);n.setAttribute("x1",String(i.x+i.w)),n.setAttribute("x2",String(t.x)),n.setAttribute("y1",String(i.y+i.h/2)),n.setAttribute("y2",String(i.y+i.h/2)),n.setAttribute("stroke",p),n.setAttribute("stroke-width",String(G/e.scale));const r=b(this.lines.right,`${o}-distance-right-text`);r.textContent=`${P(t.x-i.x-i.w,!0)}`,r.setAttribute("x",String((i.x+i.w+t.x)/2)),r.setAttribute("y",String(i.y+i.h/2-(w+4)/2/e.scale-2/e.scale)),r.setAttribute("fill","#FFFFFF"),r.setAttribute("font-size",String(w/e.scale)),r.setAttribute("text-anchor","middle"),r.setAttribute("alignment-baseline","middle");const l=b(this.lines.right,`${o}-distance-right-text-bg`);l.setAttribute("x",String((i.x+i.w+t.x)/2-(r.getComputedTextLength()+10)/2)),l.setAttribute("y",String(i.y+i.h/2-w/e.scale/2-12/e.scale)),l.setAttribute("width",String(r.getComputedTextLength()+10)),l.setAttribute("height",String((w+4)/e.scale)),l.setAttribute("fill",p),l.setAttribute("rx","4"),l.setAttribute("ry","4");const d=1,c=8,a=b(this.lines.right,`${o}-distance-right-line-start`);a.setAttribute("x",String(i.x+i.w-d/2)),a.setAttribute("y",String(i.y+i.h/2-c/2)),a.setAttribute("width",String(d)),a.setAttribute("height",String(c)),a.setAttribute("fill",p);const g=b(this.lines.right,`${o}-distance-right-line-end`);g.setAttribute("x",String(t.x-d/2)),g.setAttribute("y",String(i.y+i.h/2-c/2)),g.setAttribute("width",String(d)),g.setAttribute("height",String(c)),g.setAttribute("fill",p);const h=b(this.lines.right,`${o}-distance-right-dash-line`);i.y<t.y?(h.setAttribute("x1",String(t.x)),h.setAttribute("x2",String(t.x)),h.setAttribute("y1",String(i.y)),h.setAttribute("y2",String(t.y)),h.setAttribute("stroke",p),h.setAttribute("stroke-width","1"),h.setAttribute("stroke-dasharray","4 4"),h.setAttribute("style","display: block;")):i.y+i.h>t.y+t.h?(h.setAttribute("x1",String(t.x)),h.setAttribute("x2",String(t.x)),h.setAttribute("y1",String(t.y+t.h)),h.setAttribute("y2",String(i.y+i.h)),h.setAttribute("stroke",p),h.setAttribute("stroke-width","1"),h.setAttribute("stroke-dasharray","4 4"),h.setAttribute("style","display: block;")):h.setAttribute("style","display: none;")}if(this.top.node&&this.top.node.id!==e.selected.dataset.id){if(e.align.isVAlign&&!e.align.isHAlign){const u=V(this.top.length);u!==this.top.length&&(e.selected.style.top=A(parseFloat(e.selected.style.top)-this.top.length+u),this.top.length=u,e.align.reRender(e),e.border.reRender(e))}const t=y.from(this.top.node),i=y.from(e.selected),n=b(this.lines.top,`${o}-distance-top-line`);n.setAttribute("x1",String(i.x+i.w/2)),n.setAttribute("x2",String(i.x+i.w/2)),n.setAttribute("y1",String(i.y)),n.setAttribute("y2",String(t.y+t.h)),n.setAttribute("stroke",p),n.setAttribute("stroke-width",String(G/e.scale));const r=b(this.lines.top,`${o}-distance-top-text`);r.textContent=`${P(i.y-t.h-t.y,!0)}`,r.setAttribute("x",String(i.x+i.w/2+(r.getComputedTextLength()+10)/2+3/e.scale)),r.setAttribute("y",String((i.y+t.y+t.h)/2+1/e.scale)),r.setAttribute("fill","#FFFFFF"),r.setAttribute("font-size",String(w/e.scale)),r.setAttribute("text-anchor","middle"),r.setAttribute("alignment-baseline","middle");const l=b(this.lines.top,`${o}-distance-top-text-bg`);l.setAttribute("x",String(i.x+i.w/2+3/e.scale)),l.setAttribute("y",String((i.y+t.y+t.h)/2-(w/e.scale+4)/2)),l.setAttribute("width",String(r.getComputedTextLength()+10)),l.setAttribute("height",String(w/e.scale+4)),l.setAttribute("fill",p),l.setAttribute("rx","4"),l.setAttribute("ry","4");const d=8,c=1,a=b(this.lines.top,`${o}-distance-top-line-start`);a.setAttribute("x",String(i.x+i.w/2-d/2)),a.setAttribute("y",String(t.y+t.h-c/2)),a.setAttribute("width",String(d)),a.setAttribute("height",String(c)),a.setAttribute("fill",p);const g=b(this.lines.top,`${o}-distance-top-line-end`);g.setAttribute("x",String(i.x+i.w/2-d/2)),g.setAttribute("y",String(i.y-c/2)),g.setAttribute("width",String(d)),g.setAttribute("height",String(c)),g.setAttribute("fill",p);const h=b(this.lines.top,`${o}-distance-top-dash-line`);i.x<t.x?(h.setAttribute("x1",String(i.x)),h.setAttribute("x2",String(t.x)),h.setAttribute("y1",String(t.y+t.h)),h.setAttribute("y2",String(t.y+t.h)),h.setAttribute("stroke",p),h.setAttribute("stroke-width","1"),h.setAttribute("stroke-dasharray","4 4"),h.setAttribute("style","display: block;")):i.x+i.w>t.x+t.w?(h.setAttribute("x1",String(t.x+t.w)),h.setAttribute("x2",String(i.x+i.w)),h.setAttribute("y1",String(t.y+t.h)),h.setAttribute("y2",String(t.y+t.h)),h.setAttribute("stroke",p),h.setAttribute("stroke-width","1"),h.setAttribute("stroke-dasharray","4 4"),h.setAttribute("style","display: block;")):h.setAttribute("style","display: none;")}if(this.bottom.node&&this.bottom.node.id!==e.selected.dataset.id){if(e.align.isVAlign&&!e.align.isHAlign){const S=V(this.bottom.length);S!==this.bottom.length&&(e.selected.style.top=A(parseFloat(e.selected.style.top)+this.bottom.length-S),this.bottom.length=S,e.align.reRender(e),e.border.reRender(e))}const t=y.from(this.bottom.node),i=y.from(e.selected),n=b(this.lines.bottom,`${o}-distance-bottom-line`);n.setAttribute("x1",String(i.x+i.w/2)),n.setAttribute("x2",String(i.x+i.w/2)),n.setAttribute("y1",String(i.y+i.h)),n.setAttribute("y2",String(t.y)),n.setAttribute("stroke",p),n.setAttribute("stroke-width",String(G/e.scale));const r=b(this.lines.bottom,`${o}-distance-bottom-text`);r.textContent=`${P(t.y-i.y-i.h,!0)}`;const l=i.x+i.w/2+(r.getComputedTextLength()+10)/2+3/e.scale;r.setAttribute("x",String(l)),r.setAttribute("y",String((i.y+i.h+t.y)/2+1/e.scale)),r.setAttribute("fill","#FFFFFF"),r.setAttribute("font-size",String(w/e.scale)),r.setAttribute("text-anchor","middle"),r.setAttribute("alignment-baseline","middle");const d=b(this.lines.bottom,`${o}-distance-bottom-text-bg`);d.setAttribute("x",String(i.x+i.w/2+3/e.scale)),d.setAttribute("y",String((i.y+i.h+t.y)/2-(w/e.scale+4)/2)),d.setAttribute("width",String(r.getComputedTextLength()+10)),d.setAttribute("height",String(w/e.scale+4)),d.setAttribute("fill",p),d.setAttribute("rx","4"),d.setAttribute("ry","4");const c=8,a=1,g=b(this.lines.bottom,`${o}-distance-bottom-line-start`);g.setAttribute("x",String(i.x+i.w/2-c/2)),g.setAttribute("y",String(i.y+i.h-a/2)),g.setAttribute("width",String(c)),g.setAttribute("height",String(a)),g.setAttribute("fill",p);const h=b(this.lines.bottom,`${o}-distance-bottom-line-end`);h.setAttribute("x",String(i.x+i.w/2-c/2)),h.setAttribute("y",String(t.y-a/2)),h.setAttribute("width",String(c)),h.setAttribute("height",String(a)),h.setAttribute("fill",p);const u=b(this.lines.bottom,`${o}-distance-bottom-dash-line`);i.x<t.x?(u.setAttribute("x1",String(i.x)),u.setAttribute("x2",String(t.x)),u.setAttribute("y1",String(t.y)),u.setAttribute("y2",String(t.y)),u.setAttribute("stroke",p),u.setAttribute("stroke-width","1"),u.setAttribute("stroke-dasharray","4 4"),u.setAttribute("style","display: block;")):i.x+i.w>t.x+t.w?(u.setAttribute("x1",String(t.x+t.w)),u.setAttribute("x2",String(i.x+i.w)),u.setAttribute("y1",String(t.y)),u.setAttribute("y2",String(t.y)),u.setAttribute("stroke",p),u.setAttribute("stroke-width","1"),u.setAttribute("stroke-dasharray","4 4"),u.setAttribute("style","display: block;")):u.setAttribute("style","display: none;")}e.align.isHAlign&&(q(this.left.length,this.right.length)?(this.lines.left.style="display: block;",this.lines.right.style="display: block;"):this.left.length>this.right.length?this.lines.right.style="display: block;":this.lines.left.style="display: block;"),e.align.isVAlign&&(q(this.top.length,this.bottom.length)?(this.lines.top.style="display: block;",this.lines.bottom.style="display: block;"):this.top.length>this.bottom.length?this.lines.bottom.style="display: block;":this.lines.top.style="display: block;")}}}class vt{constructor(e){x(this,"g");this.g=f("g"),this.g.setAttribute("class",`${o}-gap`),e.append(this.g)}clear(){this.g.innerHTML=""}reRender(e){if(!e.selected)return;this.clear();const{left:t,right:i,top:n,bottom:r}=e.distance,l=y.from(e.selected);if(t.node&&i.node&&e.align.isHAlign&&!e.align.isVAlign){const d=y.from(i.node),c=y.from(t.node),a=(d.x-c.x-c.w-l.w)/2;Math.abs(l.x-c.x-c.w-a)<=3&&(e.selected.style.left=A(c.x+c.w+a),l.sync())}if(n.node&&r.node&&!e.align.isHAlign&&e.align.isVAlign){const d=y.from(r.node),c=y.from(n.node),a=(d.y-c.y-c.h-l.h)/2;Math.abs(l.y-c.y-c.h-a)<=3&&(e.selected.style.top=A(c.y+c.h+a),l.sync())}e.align.reRender(e),e.distance.reRender(e),e.border.reRender(e)}}const Et=(s,e)=>{const t=f("svg");t.setAttribute("class",`${o}-svg`);const i=s.getBoundingClientRect(),n=e.getBoundingClientRect();s.className+=` ${o}-board`,e.className+=` ${o}-canvas`,e.style.left=A((i.width-n.width)/2),e.style.top=A((i.height-n.height)/2),t.setAttribute("width",A(n.width)),t.setAttribute("height",A(n.height));const r=Array.from(e.getElementsByTagName("div"));return r.forEach(l=>{l.className+=` ${o}-movable-node`,l.setAttribute("data-id",at()),/%$/.test(l.style.top)&&(l.style.top=A(n.width*parseFloat(l.style.top)/100)),/%$/.test(l.style.left)&&(l.style.left=A(n.height*parseFloat(l.style.left)/100)),/%$/.test(l.style.width)&&(l.style.width=A(n.width*parseFloat(l.style.width)/100)),/%$/.test(l.style.height)&&(l.style.height=A(n.height*parseFloat(l.style.height)/100))}),{board:s,canvas:e,nodes:r,svg:t,selected:null,scale:1,scaleRange:[.5,2],translateX:0,translateY:0,setSelected(l){if(this.selected=l,!l){this.border.hidden();return}this.border.reRender(this),this.searchError()},searchError(){if(!this.selected)return;const l=y.from(this.selected);l.error=!1;for(let d=0;d<this.nodes.length;d++){const c=this.nodes[d];if(c===this.selected)continue;const a=y.from(c);l.isIntersect(a)?(l.error=!0,a.error=!0,this.align.hidden(),this.distance.hidden()):a.error=!1}},syncNodes(){this.nodes=Array.from(e.getElementsByTagName("div"))},gap:new vt(t),align:new ut(t),distance:new kt(t),border:new ft(t),resize:new pt(t,r),selector:new wt(t)}};class Rt{constructor(e,t){x(this,"store");this.store=Et(e,t),rt(this.store)}mount(){this.store.canvas.append(this.store.svg)}unmount(){this.store.svg.remove()}align(e){const{selected:t,canvas:i}=this.store;if(!t)return;const n=i.getBoundingClientRect(),r=y.from(t);switch(e){case"start":t.style.left=A(0);break;case"center":t.style.left=A(n.width/2-r.w/2);break;case"end":t.style.left=A(n.width-r.w);break}}}return Rt});
